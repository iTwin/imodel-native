<?xml version="1.0" encoding="UTF-8"?>
<ECSchema schemaName="WSCache" alias="wsc" version="02.00" xmlns="http://www.bentley.com/schemas/Bentley.ECXML.3.1">
    <ECSchemaReference name="CoreCustomAttributes" version="01.00" alias="CoreCA"/>
    <ECSchemaReference name="ECDbFileInfo" version="02.00" alias="ecdbf"/>
    <ECSchemaReference name="ECDbMap" version="02.00" alias="ecdbmap"/>

    <ECEntityClass typeName="Node" modifier="Abstract">
        <ECCustomAttributes>
            <ClassMap xmlns="ECDbMap.02.00">
                <MapStrategy>TablePerHierarchy</MapStrategy>
            </ClassMap>
        </ECCustomAttributes>
    </ECEntityClass>

    <ECEntityClass typeName="Root">
        <BaseClass>Node</BaseClass>
        <ECCustomAttributes>
            <DbIndexList xmlns="ECDbMap.02.00">
                <Indexes>
                    <DbIndex>
                        <Name>WSC_Index_RootName</Name>
                        <IsUnique>True</IsUnique>
                        <Properties>
                            <string>Name</string>
                        </Properties>
                    </DbIndex>
                </Indexes>
            </DbIndexList>
        </ECCustomAttributes>
        <ECProperty propertyName="Name" typeName="string"/>
        <ECProperty propertyName="Persistence" typeName="int"/>
        <ECProperty propertyName="SyncDate" typeName="dateTime">
            <ECCustomAttributes>
                <DateTimeInfo xmlns="CoreCustomAttributes.01.00">
                    <DateTimeKind>Utc</DateTimeKind>
                </DateTimeInfo>
            </ECCustomAttributes>
        </ECProperty>
    </ECEntityClass>

    <ECEntityClass typeName="NavigationBase">
        <BaseClass>Node</BaseClass>
    </ECEntityClass>

    <ECEntityClass typeName="Sequence">
        <ECProperty propertyName="LastChangeNumber" typeName="long"/>
        <ECProperty propertyName="LastCachedFileIndex" typeName="long"/>
    </ECEntityClass>

    <ECEntityClass typeName="InstanceBackup">
        <ECNavigationProperty propertyName="InfoId" relationshipName="ChangeInfoToInstanceBackup" direction="backward" />
        <ECProperty propertyName="Instance" typeName="string"/>
    </ECEntityClass>

    <ECEntityClass typeName="ChangeInfo">
        <BaseClass>Node</BaseClass>
        <ECProperty propertyName="ChangeStatus" typeName="int"/>
        <ECProperty propertyName="SyncStatus" typeName="int"/>
        <ECProperty propertyName="ChangeNumber" typeName="long"/>
        <ECProperty propertyName="Revision" typeName="long"/>
        <ECProperty propertyName="IsLocal" typeName="boolean"/>
    </ECEntityClass>

    <ECEntityClass typeName="CachedFileInfo">
        <BaseClass>ChangeInfo</BaseClass>
        <ECProperty propertyName="CacheTag" typeName="string"/>
        <ECProperty propertyName="CacheDate" typeName="dateTime">
            <ECCustomAttributes>
                <DateTimeInfo xmlns="CoreCustomAttributes.01.00">
                    <DateTimeKind>Utc</DateTimeKind>
                </DateTimeInfo>
            </ECCustomAttributes>
        </ECProperty>
        <ECProperty propertyName="UpdateDate" typeName="dateTime">
            <ECCustomAttributes>
                <DateTimeInfo xmlns="CoreCustomAttributes.01.00">
                    <DateTimeKind>Utc</DateTimeKind>
                </DateTimeInfo>
            </ECCustomAttributes>
        </ECProperty>
    </ECEntityClass>

    <ECEntityClass typeName="CachedObjectInfo">
        <BaseClass>ChangeInfo</BaseClass>
        <ECCustomAttributes>
            <DbIndexList xmlns="ECDbMap.02.00">
                <Indexes>
                    <DbIndex>
                        <Name>WSC_Index_ClassIdAndRemoteId</Name>
                        <IsUnique>True</IsUnique>
                        <Properties>
                            <string>ClassId</string>
                            <string>RemoteId</string>
                        </Properties>
                    </DbIndex>
                    <DbIndex>
                        <Name>WSC_Index_ClassIdAndInstanceId</Name>
                        <IsUnique>True</IsUnique>
                        <Properties>
                            <string>ClassId</string>
                            <string>InstanceId</string>
                        </Properties>
                    </DbIndex>
                </Indexes>
            </DbIndexList>
        </ECCustomAttributes>
        <ECProperty propertyName="ClassId" typeName="long"/>
        <ECProperty propertyName="InstanceId" typeName="long"/>
        <ECProperty propertyName="RemoteId" typeName="string"/>
        <ECProperty propertyName="InstanceState" typeName="int"/>
        <ECProperty propertyName="CacheTag" typeName="string"/>
        <ECProperty propertyName="CacheDate" typeName="dateTime">
            <ECCustomAttributes>
                <DateTimeInfo xmlns="CoreCustomAttributes.01.00">
                    <DateTimeKind>Utc</DateTimeKind>
                </DateTimeInfo>
            </ECCustomAttributes>
        </ECProperty>
    </ECEntityClass>

    <ECEntityClass typeName="CachedRelationshipInfo">
        <BaseClass>CachedObjectInfo</BaseClass>
        <ECCustomAttributes>
            <DbIndexList xmlns="ECDbMap.02.00">
                <Indexes>
                    <DbIndex>
                        <Name>WSC_Index_ClassIdAndNonUniqueRemoteId</Name>
                        <IsUnique>False</IsUnique>
                        <Properties>
                            <string>ClassId</string>
                            <string>RelRemoteId</string>
                        </Properties>
                    </DbIndex>
                    <DbIndex>
                        <Name>WSC_Index_LocalRelationshipIdentifier</Name>
                        <IsUnique>True</IsUnique>
                        <Properties>
                            <string>ClassId</string>
                            <string>SourceClassId</string>
                            <string>SourceInstanceId</string>
                            <string>TargetClassId</string>
                            <string>TargetInstanceId</string>
                        </Properties>
                    </DbIndex>
                </Indexes>
            </DbIndexList>
        </ECCustomAttributes>
        <ECProperty propertyName="RelRemoteId" typeName="string"/>
        <ECProperty propertyName="SourceClassId" typeName="long"/>
        <ECProperty propertyName="SourceInstanceId" typeName="long"/>
        <ECProperty propertyName="TargetClassId" typeName="long"/>
        <ECProperty propertyName="TargetInstanceId" typeName="long"/>
    </ECEntityClass>

    <ECEntityClass typeName="CachedResponseInfo">
        <BaseClass>Node</BaseClass>
        <ECCustomAttributes>
            <DbIndexList xmlns="ECDbMap.02.00">
                <Indexes>
                    <DbIndex>
                        <Name>WSC_Index_QueryName</Name>
                        <IsUnique>False</IsUnique>
                        <Properties>
                            <string>Name</string>
                        </Properties>
                    </DbIndex>
                </Indexes>
            </DbIndexList>
        </ECCustomAttributes>
        <ECProperty propertyName="Name" typeName="string"/>
        <ECProperty propertyName="AccessDate" typeName="dateTime">
            <ECCustomAttributes>
                <DateTimeInfo xmlns="CoreCustomAttributes.01.00">
                    <DateTimeKind>Utc</DateTimeKind>
                </DateTimeInfo>
            </ECCustomAttributes>
        </ECProperty>
        <ECProperty propertyName="IsCompleted" typeName="boolean"/>
    </ECEntityClass>

    <ECEntityClass typeName="CachedResponsePageInfo">
        <BaseClass>Node</BaseClass>
        <ECProperty propertyName="CacheDate" typeName="dateTime">
            <ECCustomAttributes>
                <DateTimeInfo xmlns="CoreCustomAttributes.01.00">
                    <DateTimeKind>Utc</DateTimeKind>
                </DateTimeInfo>
            </ECCustomAttributes>
        </ECProperty>
        <ECProperty propertyName="CacheTag" typeName="string"/>
        <ECProperty propertyName="Index" typeName="long"/>
    </ECEntityClass>

    <ECRelationshipClass typeName="RootToNode" strength="holding" modifier="Sealed">
        <Source multiplicity="(0..*)" polymorphic="false" roleLabel="Root" >
            <Class class="Root"/>
        </Source>
        <Target multiplicity="(0..*)" polymorphic="false" abstractConstraint="Node" roleLabel="Node">
            <Class class="CachedObjectInfo"/>
            <Class class="CachedRelationshipInfo"/>
            <Class class="NavigationBase"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="RootToNodeWeak" strength="referencing" modifier="Sealed">
        <Source multiplicity="(0..*)" polymorphic="false" roleLabel="Root">
            <Class class="Root"/>
        </Source>
        <Target multiplicity="(0..*)" polymorphic="false" abstractConstraint="Node" roleLabel="Weak Node">
            <Class class="CachedObjectInfo"/>
            <Class class="CachedRelationshipInfo"/>
            <Class class="NavigationBase"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="ResponseToParent" strength="referencing" strengthDirection="backward" modifier="Sealed">
        <Source multiplicity="(0..*)" polymorphic="false" roleLabel="Response">
            <Class class="CachedResponseInfo"/>
        </Source>
        <Target multiplicity="(1..1)" polymorphic="true" roleLabel="Parent">
            <Class class="Node"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="ResponseToHolder" strength="holding" strengthDirection="backward" modifier="Sealed">
        <Source multiplicity="(0..*)" polymorphic="false" roleLabel="Response">
            <Class class="CachedResponseInfo"/>
        </Source>
        <Target multiplicity="(1..1)" polymorphic="true" roleLabel="Holder">
            <Class class="Node"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="ResponseToResponsePage" strength="holding" modifier="Sealed">
        <Source multiplicity="(1..1)" polymorphic="false" roleLabel="Response">
            <Class class="CachedResponseInfo"/>
        </Source>
        <Target multiplicity="(0..*)" polymorphic="false" roleLabel="Response Page">
            <Class class="CachedResponsePageInfo"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="ResponseToAdditionalInstance" strength="referencing" modifier="Sealed">
        <Source multiplicity="(0..*)" polymorphic="false" roleLabel="Response">
            <Class class="CachedResponseInfo" />
        </Source>
        <Target multiplicity="(0..*)" polymorphic="false" roleLabel="Additional Instance">
            <Class class="CachedObjectInfo" />
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="ResponsePageToResult" strength="holding" modifier="Sealed">
        <Source multiplicity="(0..*)" polymorphic="false" roleLabel="Response Page">
            <Class class="CachedResponsePageInfo"/>
        </Source>
        <Target multiplicity="(0..*)" polymorphic="false" abstractConstraint="CachedObjectInfo" roleLabel="Result">
            <Class class="CachedObjectInfo"/>
            <Class class="CachedRelationshipInfo"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="ResponsePageToResultWeak" strength="referencing" modifier="Sealed">
        <Source multiplicity="(0..*)" polymorphic="false" roleLabel="Response Page">
            <Class class="CachedResponsePageInfo"/>
        </Source>
        <Target multiplicity="(0..*)" polymorphic="false" abstractConstraint="ChangeInfo" roleLabel="Result">
            <Class class="CachedObjectInfo"/>
            <Class class="CachedRelationshipInfo"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="ChangeInfoToInstanceBackup" strength="embedding" modifier="Sealed">
        <Source multiplicity="(1..1)" polymorphic="true" roleLabel="ChangeInfo">
            <Class class="ChangeInfo"/>
        </Source>
        <Target multiplicity="(0..1)" polymorphic="false" roleLabel="InstanceBackup">
            <Class class="InstanceBackup"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="ObjectInfoToCachedFileInfo" strength="holding" modifier="Sealed">
        <Source multiplicity="(1..1)" polymorphic="false" roleLabel="ObjectInfo">
            <Class class="CachedObjectInfo"/>
        </Source>
        <Target multiplicity="(0..1)" polymorphic="false" roleLabel="CachedFileInfo">
            <Class class="CachedFileInfo"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="CachedFileInfoToFileInfo" strength="holding" modifier="Sealed">
        <Source multiplicity="(0..1)" polymorphic="false" roleLabel="CachedFileInfo">
            <Class class="CachedFileInfo"/>
        </Source>
        <Target multiplicity="(0..1)" polymorphic="false" roleLabel="FileInfo">
            <Class class="ecdbf:ExternalFileInfo"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="CachedFileInfoToFileInfoOwnership" strength="holding" modifier="Sealed">
        <Source multiplicity="(0..1)" polymorphic="false" roleLabel="CachedFileInfo">
            <Class class="CachedFileInfo"/>
        </Source>
        <Target multiplicity="(0..1)" polymorphic="false" roleLabel="FileInfoOwnership">
            <Class class="ecdbf:FileInfoOwnership"/>
        </Target>
    </ECRelationshipClass>

    <ECEntityClass typeName="ExtendedData">
        <ECProperty propertyName="Content" typeName="string"/>
    </ECEntityClass>

    <ECRelationshipClass typeName="NodeToExtendedData" strength="embedding" modifier="Sealed">
        <Source multiplicity="(0..1)" polymorphic="true" roleLabel="Node">
            <Class class="Node"/>
        </Source>
        <Target multiplicity="(0..1)" polymorphic="false" roleLabel="ExtendedData">
            <Class class="ExtendedData"/>
        </Target>
    </ECRelationshipClass>

</ECSchema>
