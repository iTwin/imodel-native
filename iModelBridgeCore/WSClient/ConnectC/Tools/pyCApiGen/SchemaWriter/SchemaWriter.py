import datetime
import os.path


class SchemaWriter(object):
    _COMMENT_AutoGen = "//--------------------------------------------------------------------------------------+\n"   \
                       "// <auto-generated>\n"                                                                         \
                       "//     This code was generated by the pyCApiGen tool on {0}.\n"                                 \
                       "//\n"                                                                                          \
                       "//     Changes to this file may cause incorrect behavior and will be lost if\n"                \
                       "//     the code is regenerated.\n"                                                             \
                       "// </auto-generated>\n"                                                                        \
                       "//--------------------------------------------------------------------------------------+\n"   \


    _COMMENT_Copyright = "/*--------------------------------------------------------------------------------------+\n" \
                         "|\n"                                                                                         \
                         "|     $Source: ConnectC/Tools/pyCApiGen/SchemaWriter/SchemaWriter.py $\n"                                       \
                         "|\n"                                                                                         \
                         "|  $Copyright: (c) 2016 Bentley Systems, Incorporated. All rights reserved. $\n"              \
                         "|\n"                                                                                         \
                         "+--------------------------------------------------------------------------------------*/\n" \


    def __init__(self, ecschema, filename, api, status_codes):
        self._ecschema = ecschema
        directory_name = os.path.dirname(filename)
        if not os.path.exists(directory_name):
            os.makedirs(directory_name)
        self._file = open(filename, "w")
        self._api = api
        self._status_codes = status_codes
        self._COMMENT_AutoGen = self._COMMENT_AutoGen.format(datetime.date.today().strftime("%B %d, %Y"))
        self._COMMENT_Copyright = self._COMMENT_Copyright.format(os.path.basename(self._file.name), datetime.date.today().strftime("%Y"))

    def _write_spacing(self):
        self._file.write('\n')

    def _write_header_comments(self, is_header=False, should_include_in_api=None):
        self._file.write(self._COMMENT_Copyright)
        if is_header:
            self._file.write('#pragma once\n')
        if should_include_in_api is True:
            self._file.write('//__PUBLISH_SECTION_START__\n')
        elif should_include_in_api is False:
            self._file.write('//__BENTLEY_INTERNAL_ONLY__\n')
        self._file.write(self._COMMENT_AutoGen)

    def _close_file(self):
        self._file.flush()
        self._file.close()
