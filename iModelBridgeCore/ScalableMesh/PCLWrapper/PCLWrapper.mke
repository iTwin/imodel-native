#--------------------------------------------------------------------------------------
#
#     $Source: PCLWrapper/PCLWrapper.mke $
#
#   $Copyright: (c) 2019 Bentley Systems, Incorporated. All rights reserved. $
#
#--------------------------------------------------------------------------------------
# Lots of problems in a third-party library that we aren't going to fix. 
HAVE_PERMISSION_TO_COMPILE_AT_W3=1

appName = PCLWrapper
moduleName = PCLWrapper

PolicyFile = $(SrcRoot)ScalableMesh\PCLWrapper\mki\AssertPCLWrapperPolicy.mki

%include mdl.mki

publicApiDir  = $(baseDir)PublicAPI/

AppConfigurationMKI = $(baseDir)PCLWrapper.mki
%include $(AppConfigurationMKI)

#----------------------------------------------------------------------
#       Create output directories
#----------------------------------------------------------------------
always:
    !~@mkdir $(o)

#----------------------------------------------------------------------
#   Symlink APIs
#----------------------------------------------------------------------
always:
   ~linkdir "$(BuildContext)PublicAPI/PCLWrapper=$(publicApiDir)"

#----------------------------------------------------------------------
#     Compile precompiled header
#----------------------------------------------------------------------
CCPchOpts = -Yc"PCLWrapperPch.h" -Zm800 -Fp$(o)PCLWrapperPch.pch
$(o)PCLWrapperPch$(oext)                : $(baseDir)PCLWrapperPch.cpp $(MultiCompileDepends)


#----------------------------------------------------------------------
#     Multi Compile
#----------------------------------------------------------------------
%include MultiCppCompileRule.mki

$(o)NormalCalculator$(oext)           : $(baseDir)NormalCalculator.cpp  \
                                        $(publicApiDir)INormalCalculator.h \
                                        ${MultiCompileDepends}

$(o)RansacUtility$(oext)           : $(baseDir)RansacUtility.cpp  \
                                        $(publicApiDir)IRansacUtility.h \
                                        ${MultiCompileDepends}

$(o)Status$(oext)                     : $(baseDir)Status.cpp  \
                                        $(baseDir)Status.h  \
                                        $(publicApiDir)IStatus.h \
                                        ${MultiCompileDepends}

$(o)Icp$(oext)                        : $(baseDir)Icp.cpp  \
                                        $(baseDir)Icp.h \
                                        $(publicApiDir)IIcp.h \
                                        ${MultiCompileDepends}


%include MultiCppCompileGo.mki


#----------------------------------------------------------------------
# Define macros for files included in our link
#----------------------------------------------------------------------
nonUniformObjs = \
    $(PCHHeaderObject)
    
linkLibs = \
    $(ContextSubpartsLibs)pclCommon$(libext) \
    $(ContextSubpartsLibs)pclOctree$(libext) \
    $(ContextSubpartsLibs)pclSampleConsensus$(libext) \
    $(ContextSubpartsLibs)pclKdtree$(libext) \
    $(ContextSubpartsLibs)pclSearch$(libext) \
    $(ContextSubpartsLibs)pclFilters$(libext) \
    $(ContextSubpartsLibs)pclSegmentation$(libext) \
    $(ContextSubpartsLibs)pclFeatures$(libext) \
    $(ContextSubpartsLibs)pclSurface$(libext) \
    $(ContextSubpartsLibs)pclRegistration$(libext) \
    $(ContextSubpartsLibs)pclKeypoints$(libext) \
    $(ContextSubpartsLibs)pclTracking$(libext) \
%if defined(BUILD_USING_VS2013)
    $(ContextSubpartsLibs)libboost_atomic-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_chrono-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_context-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_coroutine-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_date_time-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_exception-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_filesystem-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_graph-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_iostreams-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_locale-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_log_setup-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_log-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_c99-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_c99f-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_c99l-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_tr1-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_tr1f-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_tr1l-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_prg_exec_monitor-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_program_options-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_random-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_regex-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_serialization-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_signals-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_system-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_test_exec_monitor-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_thread-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_timer-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_unit_test_framework-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_wave-vc120-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_wserialization-vc120-mt-1_57$(libext) \
%elif defined(BUILD_USING_VS2015)
    $(ContextSubpartsLibs)libboost_atomic-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_chrono-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_context-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_coroutine-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_date_time-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_exception-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_filesystem-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_graph-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_iostreams-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_locale-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_log_setup-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_log-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_c99-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_c99f-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_c99l-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_tr1-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_tr1f-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_math_tr1l-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_prg_exec_monitor-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_program_options-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_random-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_regex-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_serialization-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_signals-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_system-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_test_exec_monitor-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_thread-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_timer-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_unit_test_framework-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_wave-vc140-mt-1_57$(libext) \
    $(ContextSubpartsLibs)libboost_wserialization-vc140-mt-1_57$(libext) \
%endif


#----------------------------------------------------------------------
#   DLM definition
#----------------------------------------------------------------------
DLM_NAME                = $(appName)
DLM_OBJECT_FILES        = $(MultiCompileObjectList)
DLM_OBJECT_PCH          = $(o)PCLWrapperPCH$(oext)

LINKER_LIBRARIES        = $(linkLibs)

%include $(sharedMki)LinkLibrary.mki
