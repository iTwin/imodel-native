#----------------------------------------------------------------------
#
#     $Source: Tests/ATP/ScalableMeshATPexe.mke $
#
#  $Copyright: (c) 2016 Bentley Systems, Incorporated. All rights reserved. $
#
#----------------------------------------------------------------------
baseDir         = $(_MakeFilePath)../../
PolicyFile      = $(SrcRoot)scalablemesh/mki/AssertScalableMeshPolicy.mki
SolutionPolicyMki=$(baseDir)ScalableMesh.mki
consoleAppUnicode = 1
%include mdl.mki

appName = ScalableMeshATPexe
baseDir = $(_MakeFilePath)

o = $(OutputRootDir)Build/ScalableMesh/$(appName)/
always:
    ~mkdir $(o)

ScalableMeshDir = $(SrcRoot)ScalableMesh/

CCompOpts + -DUNICODE

MultiCompileDepends = $(_MakeFileSpec)
%include MultiCppCompileRule.mki

#NEEDS_WORK_SM : TEMP_SM_ATP For ATP purpose
nameToDefine=SCALABLE_MESH_ATP
%include cdefapnd.mki

$(o)MrDTMUtil.obj: $(baseDir)TiledTriangulation/MrDTMUtil.cpp $(baseDir)TiledTriangulation/MrDTMUtil.h ${MultiCompileDepends}

$(o)MrDTMFace.obj: $(baseDir)TiledTriangulation/MrDTMFace.cpp $(baseDir)TiledTriangulation/MrDTMFace.h ${MultiCompileDepends}

$(o)TiledTriangulatorValidator.obj: $(baseDir)TiledTriangulation/TiledTriangulatorValidator.cpp $(baseDir)TiledTriangulation/TiledTriangulatorValidator.h ${MultiCompileDepends}

$(o)TiledTriangulatorUtil.obj: $(baseDir)TiledTriangulation/TiledTriangulatorUtil.cpp $(baseDir)TiledTriangulation/TiledTriangulatorUtil.h ${MultiCompileDepends}

$(o)ATPFileFinder.obj: $(baseDir)Common/ATPFileFinder.cpp ${MultiCompileDepends}

$(o)DrapeLineTool.obj: $(baseDir)Tool/DrapeLineTool.cpp $(baseDir)Tool/DrapeLineTool.h ${MultiCompileDepends}

$(o)VolumeCalculationTool.obj: $(baseDir)Tool/VolumeCalculationTool.cpp $(baseDir)Tool/VolumeCalculationTool.h ${MultiCompileDepends}

$(o)ATPUtils.obj: $(baseDir)Common/ATPUtils.cpp ${MultiCompileDepends}

$(o)ATPDefinitions.obj: $(baseDir)Common/ATPDefinitions.cpp ${MultiCompileDepends}

$(o)ATPGeneration.obj: $(baseDir)Common/ATPGeneration.cpp ${MultiCompileDepends}

$(o)Initialize.obj: $(baseDir)Initialize.cpp ${MultiCompileDepends}

$(o)ScalableMeshATPexe.obj: $(baseDir)ScalableMeshATPexe.cpp ${MultiCompileDepends}




%include MultiCppCompileGo.mki

#----------------------------------------------------------------------
#   Link the executable
#----------------------------------------------------------------------

EXE_DEST     = $(o)
EXE_NAME     = $(appname)
EXE_OBJS     = $(MultiCompileObjectList)
LINKER_LIBRARIES  = $(ContextSubpartsLibs)BentleyAllocator.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)Bentley.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)ECObjects.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)BentleyGeom.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)DgnPlatform.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)BaseGeoCoord.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)DgnView.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)DgnGeoCoord.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)ScalableMesh.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)TerrainModelCore.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)IppGraLibs.lib
LINKER_LIBRARIES  + $(ContextSubpartsLibs)IppUtlLibs.lib


LINKER_LIBRARIES_DELAYLOADED  + $(ContextSubpartsLibs)RmgrTools.lib
LINKER_LIBRARIES_DELAYLOADED  + $(ContextSubpartsLibs)RasterCore.lib
LINKER_LIBRARIES_DELAYLOADED  + $(ContextSubpartsLibs)PointCloud.lib
LINKER_LIBRARIES_DELAYLOADED  + $(ContextSubpartsLibs)BeXml.lib
LINKER_LIBRARIES_DELAYLOADED  + $(ContextSubpartsLibs)DgnView.lib

EXE_TMP_DIR  = $(o)

%include $(sharedMki)linktool.mki

always:
    ~linkfile "$(BuildContext)Delivery/$(appname)$(exeext)=$(o)$(appname)$(exeext)"

