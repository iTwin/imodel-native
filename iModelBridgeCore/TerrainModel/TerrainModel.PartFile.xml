<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="..\bsicommon\build\PartFile.xsd" >

    <Part Name="ExternalDependencies">
        <SubPart PartName="BentleyDll" PartFile="iModelCore/Bentley/Bentley" Repository="imodel02" />
    </Part>

    <Part Name="HeaderFiles" BMakeFile="TerrainModel.prewire.mke" >
        <SubPart PartName="Base" PartFile="iModelCore/Bentley/Bentley" Repository="imodel02" />
        <SubPart PartName="HeaderFiles"  PartFile="iModelCore/GeomLibs/geomlibs"                            Repository="imodel02" />
        <Bindings>
            <PublicAPI Domain="TerrainModel" />
        </Bindings>
    </Part>

    <Part Name="Core" BMakeFile="core\core.mke">
        <SubPart PartName="HeaderFiles"/>
        <SubPart PartName="GeomDlls" PartFile="iModelCore/GeomLibs/geomlibs" Repository="imodel02" />
        <Bindings>
            <Files ProductDirectoryName="TerrainModelNativeAssemblies">Delivery/$(shlibprefix)TerrainModelCore$(shlibext)</Files>
            <Libs ProductDirectoryName="TerrainModelNativeCoreLibs" Required="false"> Delivery/$(libprefix)TerrainModelCore$(libext)</Libs>
        </Bindings>
    </Part>

    <!--<Part Name="inroadstm" BMakeFile="formats\inroadstm\inroadstm.mke">
        <SubPart PartName="GeomDlls" PartFile="iModelCore/GeomLibs/geomlibs" Repository="imodel02" />
        <Bindings>
            <Files ProductDirectoryName="TerrainModelNativeAssemblies">Delivery/$(shlibprefix)inroadstm$(shlibext)</Files>
            <Libs> Delivery/$(libprefix)inroadstm$(libext)</Libs>
        </Bindings>
    </Part>-->

    <Part Name="Formats" BMakeFile="formats\formats.mke">
        <!--<SubPart PartName="InRoadsTM" LibType="Static" />-->
        <SubPart PartName="Core" />
        <SubPart PartName="BeXmlDll"         PartFile="BeLibxml2"  Repository="libsrc-libxml2" />
        <SubPart PartName="GeoCoord"   PartFile="iModelCore/GeoCoord/GeoCoord"   Repository="imodel02" />	
        <SubPart PartName="IppUtlDll"  PartFile="iModelBridgeCore/Imagepp/ImagePP" Repository="imodel02" />
        <SubPart PartName="IppGraDll"  PartFile="iModelBridgeCore/Imagepp/ImagePP" Repository="imodel02" />
        <Bindings>
            <Files ProductDirectoryName="TerrainModelNativeAssemblies" >Delivery\$(shlibprefix)TerrainModelFormats$(shlibext)</Files>
            <Libs>Delivery\$(libprefix)TerrainModelFormats$(libext)</Libs>
        </Bindings>
    </Part>

    <Part Name="AutomaticGroundDetection" BMakeFile="AutomaticGroundDetection\AutomaticGroundDetection.mke">      
      <SubPart PartName="Core" />
      <SubPart PartName="Formats" />      
      <SubPart PartName="GeoCoord"   PartFile="iModelCore/GeoCoord/GeoCoord"   Repository="imodel02" />
      <!--<SubPart PartName="Boost_1_5_7_0_Lib_Static" PartFile="iModelBridgeCore/TerrainModel/Boost_1_5_7_0_Lib" Repository="boost_1.57.0_lib" />-->
      <Bindings>
        <Assemblies ProductDirectoryName="AutomaticGroundDetection" Required="false">Delivery\$(shlibprefix)AutomaticGroundDetection$(shlibext)</Assemblies>
        <Assemblies ProductDirectoryName="PPNativeAssemblies" >Delivery\$(shlibprefix)AutomaticGroundDetection$(shlibext)</Assemblies>        
        <Libs>Delivery\$(libprefix)AutomaticGroundDetection$(libext)</Libs>
      </Bindings>
    </Part>

    <Part Name="STM" BMakeFile="stm\stm.mke">
        <SubPart PartName="Core" />
        <SubPart PartName="ImagePP" PartFile="iModelBridgeCore/Imagepp/ImagePP" Repository="imodel02" />
        <!-- Bindings>
      <Assemblies ProductDirectoryName="TerrainModelNativeAssemblies">Delivery\$(shlibprefix)TerrainModelDrainage$(shlibext)</Assemblies>
      <Libs>Delivery\$(libprefix)TerrainModelDrainage$(libext)</Libs>
    </Bindings -->
    </Part>

    <!--Part Name="Drainage" BMakeFile="drainage\drainage.mke">
        <SubPart PartName="Core" />
        <Bindings>
            <Files ProductDirectoryName="TerrainModelNativeAssemblies">Delivery\$(shlibprefix)TerrainModelDrainage$(shlibext)</Files>
            <Libs>Delivery\$(libprefix)TerrainModelDrainage$(libext)</Libs>
        </Bindings>
    </Part-->

    <Part Name="TerrainModelNET" BMakeFile="terrainModelNET\terrainModelNET.mke">
        <SubPart PartName="Core"/>
        <SubPart PartName="BentleyGeometryNetAssembly" PartFile="BentleyGeometryNet" Repository="BentleyGeometryNET"/>
        <Bindings>
            <Assemblies ProductDirectoryName="TerrainModelNetAssemblies">Delivery/Bentley.TerrainModelNET.dll</Assemblies>
        </Bindings>
    </Part>

    <Part Name="FormatsNET" BMakeFile="FormatsNET\FormatsNET.mke">
        <SubPart PartName="Core"/>
        <SubPart PartName="Formats"/>
        <SubPart PartName="TerrainModelNET"/>
        <SubPart PartName="GeoCoordManaged"              PartFile="iModelCore/GeoCoord/GeoCoord"           Repository="imodel02" />
        <SubPart PartName="BentleyGeometryNetAssembly" PartFile="BentleyGeometryNet" Repository="BentleyGeometryNET"/>
        <Bindings>
            <Assemblies ProductDirectoryName="TerrainModelNetAssemblies">Delivery/Bentley.TerrainModelNET.Formats.dll</Assemblies>
        </Bindings>
    </Part>

    <Part Name="ScalableTerrainModel" BMakeFile="ScalableTerrainModel\ScalableTerrainModel.mke">
        <SubPart PartName="GeomDlls"        PartFile="iModelCore/GeomLibs/geomlibs"                             Repository="imodel02"/>
        <SubPart PartName="ImagePP"         PartFile="iModelBridgeCore/Imagepp/ImagePP"                              Repository="imodel02" />
        <SubPart PartName="Core"            PartFile="iModelBridgeCore/TerrainModel/TerrainModel"                         Repository="imodel02"/>
        <SubPart PartName="Formats"         PartFile="iModelBridgeCore/TerrainModel/TerrainModel"                         Repository="imodel02"/>
        <Bindings>
            <Libs>delivery/$(shlibprefix)ScalableTerrainModel$(libext)</Libs>    
            <Assemblies ProductDirectoryName="TerrainModelNativeAssemblies">delivery/$(shlibprefix)ScalableTerrainModel$(shlibext)</Assemblies> 
            <PublicAPI Domain="ScalableTerrainModel" />
        </Bindings>
    </Part>

    <Part Name="ConsoleApps" BMakeFile="consoleApps\consoleApps.mke" >
        <SubPart PartName="Core" />
        <SubPart PartName="Formats" />
        <Bindings>
            <Files ProductDirectoryName="TerrainModelNativeAssemblies">Delivery/bctin.exe</Files>
            <Files ProductDirectoryName="TerrainModelNativeAssemblies">Delivery/bcload.exe</Files>
            <Files ProductDirectoryName="TerrainModelNativeAssemblies">Delivery/bcclip.exe</Files>
            <Files ProductDirectoryName="TerrainModelNativeAssemblies">Delivery/bcdrainage.exe</Files>
            <Files ProductDirectoryName="TerrainModelNativeAssemblies">Delivery/bcVolume.exe</Files>
        </Bindings>
    </Part>

    <Part Name="TestDependencies">
        <SubPart PartName="nunit_2.5.10" PartFile="${SrcRoot}bsicommon\CvsPartFiles\bsitools" Repository="bsitools-nunit_2.5.10" />
        <SubPart PartName="HeaderFiles" />
    </Part>

    <Part Name="TerrainModelTestData"  BMakeFile="Tests\TerrainModelTests.prewire.mke" >
        <RequiredRepository>TerrainModelTestData</RequiredRepository>
        <RequiredRepository>TerrainModelLightTestData</RequiredRepository>
        <Bindings>
            <Directory ProductDirectoryName="TerrainModelTestData" SourceName="TestData" />
        </Bindings>
    </Part>

    <Part Name="RunTerrainModelNetTests" BMakeFile="Tests\TerrainModelNetTests\RunTerrainModelTests.mke">

    </Part>

    <Part Name="RunTerrainModelTests" BMakeFile="Tests\TerrainModelTests\RunBentleyTest.mke">
        <SubPart PartName="TerrainModelTestData" />
        <SubPart PartName="Formats" />
        <SubPart PartName="BuildTerrainModelTests"/>
        <SubPart PartName="google_gtest_lib" PartFile="iModelCore/util/gtest/gtest" Repository="imodel02"/>
        <SubPart PartName="google_gtest"        PartFile="iModelCore/util/gtest/gtest"            Repository="imodel02" />
        <SubPart PartName="UnitTests_Published" PartFile="BentleyUnitTests" Repository="BentleyUnitTests"/>
   </Part>

    <Part Name="BuildTerrainModelNetTests" BMakeFile="Tests\TerrainModelNetTests\BuildTerrainModelTests.mke" >
        <SubPart PartName="TerrainModelTestData" />
        <SubPart PartName="TestDependencies"/>
        <SubPart PartName="TerrainModelNET" />
        <SubPart PartName="FormatsNET" />
        <Bindings>
            <Assemblies ProductDirectoryName="managedtests">
                Delivery\Bentley.TerrainModelNET.Tests.dll
            </Assemblies>
        </Bindings>
    </Part>

    <Part Name="BuildTerrainModelTests" BMakeFile="Tests\TerrainModelTests\BuildTerrainModelTests.mke" BMakeOptions="+dUSE_GTEST +dCOMPILE_MAIN_TESTS">
        <SubPart PartName="TerrainModelTestData" />
        <SubPart PartName="TestDependencies"/>
        <SubPart PartName="TerrainModelNET" />
        <SubPart PartName="FormatsNET" />

        <SubPart PartName="google_gtest_lib" PartFile="iModelCore/util/gtest/gtest" Repository="imodel02"/>
        <SubPart PartName="bentley_gtest"        PartFile="iModelCore/util/gtest/gtest"            Repository="imodel02" />
        <SubPart PartName="UnitTests_Published" PartFile="BentleyUnitTests" Repository="BentleyUnitTests"/>

        <Bindings>
            <Files ProductDirectoryName="managedtests">Delivery\TerrainModelTests.exe</Files>
            <Files ProductDirectoryName="managedtests">Delivery\TerrainModelTests.log.config.xml</Files>
        </Bindings>
    </Part>

    
    <Part Name="TerrainModel"  PrgOutputDir="TerrainModel">
        <SubPart PartName="Core" />
        <SubPart PartName="TerrainModelNET" />
        <SubPart PartName="Formats" />
        <SubPart PartName="FormatsNET" />
        <SubPart PartName="ScalableTerrainModel" />
        <SubPart PartName="AutomaticGroundDetection" />

    </Part>

    <Part Name="FullProduct"  PrgOutputDir="TerrainModel">
        <SubPart PartName="TerrainModel" />
        <SubPart PartName="ConsoleApps" />
        <SubProduct ProductName="TerrainModelTest" />
        <!--SubPart PartName="Core" LibType="Static"/>
        <SubPart PartName="Formats" LibType="Static"/>
        <SubPart PartName="ConsoleApps" LibType="Static" /-->

    </Part>

    <!-- ///////////////////////////////////////////////////////////////////////////////////// -->
    <!-- Must have a product available to run the executable from. -->
    <!-- ///////////////////////////////////////////////////////////////////////////////////// -->

    <ProductDirectoryList ListName="TerrainModelTest">
        <ProductDirectory Name="Libs"                               Path="lib" Deliver="false" />
        <ProductDirectory Name="PublicAPI"                          Deliver="false" />
        <ProductDirectory Name="VendorAPI"                          Deliver="false" />
        <ProductDirectory Name="BentleyNativeAssemblies"            />
        <ProductDirectory Name="BentleyGeometryNetAssemblies"       />
        <ProductDirectory Name="GeomNativeAssemblies"               />
        <ProductDirectory Name="LoggingNativeAssemblies"            />
        <ProductDirectory Name="PlatformTechAssemblies"             />
        <ProductDirectory Name="LoggingManagedAssemblies"           />
        <ProductDirectory Name="ImagePPAssemblies"                  />
        <ProductDirectory Name="GeoCoordNativeAssemblies"           />
        <ProductDirectory Name="GeoCoordManagedAssemblies"          />

        <ProductDirectory Name="RmgrToolsNativeAssemblies"          />
        <ProductDirectory Name="GeoCoordData"                       Path="GeoCoordData"/>


        <ProductDirectory Name="TerrainModelNetAssemblies"          />
        <ProductDirectory Name="TerrainModelNativeAssemblies"       />
        <ProductDirectory Name="TerrainModelConsole"                />

        <ProductDirectory Name="NUnit 2.5.10 binaries"               Path="" />
        <ProductDirectory Name="NUnit 2.5.10 core references"        />
        <ProductDirectory Name="managedtests"                        />
        <ProductDirectory Name="TerrainModelTestData"                Path="Data"/>

        <ProductDirectory Name="CSMapMergeModules"                Deliver="false"/>
    
        
        <ProductDirectory Name="ECSchemas"  Deliver="false" />
        <ProductDirectory Name="ECObjectsManagedAssemblies"  Deliver="false" />
        
        <ProductDirectory Name="AdobeResource"  Deliver="false" />
        <ProductDirectory Name="AdobeAssemblies"  Deliver="false" />
        <ProductDirectory Name="PdfLibinitNativeAssemblies"  Deliver="false" />

        <ProductDirectory Name="PublicAPI"  LibType="static"  Deliver="false" />
        <ProductDirectory Name="RmgrToolsNativeAssemblies"  LibType="static"  Deliver="false" />
        <ProductDirectory Name="BentleyNativeAssemblies"  LibType="static"  Deliver="false" />
        <ProductDirectory Name="VendorAPI"  LibType="static"  Deliver="false" />
        <ProductDirectory Name="Libs"  LibType="static"  Deliver="false" />

        
        <ProductDirectory Name="TestBin"         />
        <ProductDirectory Name="TestBin" LibType="static" Deliver="false" />

    </ProductDirectoryList>

    <Product Name="TerrainModelTest" >
        <!--SubProduct ProductName="MicroStationProduct" PartFile="derivative\Mstn\Mstn" Repository="MstnPlatform" /-->
        <SubPart PartName="ConsoleApps" />
        <SubPart PartName="TerrainModelNET" />
        <SubPart PartName="BuildTerrainModelTests" />
        <SubPart PartName="BuildTerrainModelNETTests" />
        <SubPart PartName="RunTerrainModelTests"/>

        <SubPart PartName="TestRunner"        PartFile="iModelCore/util/gtest/gtest"                      Repository="imodel02"/>

        <!-- SubPart PartName="ConsoleApps" LibType="Static" /-->
        <Directories DirectoryListName="TerrainModelTest" />
    </Product>

</BuildContext>
