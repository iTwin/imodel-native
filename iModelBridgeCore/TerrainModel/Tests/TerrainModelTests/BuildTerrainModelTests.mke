#----------------------------------------------------------------------------------------
#
#  $Source: Tests/TerrainModelTests/BuildTerrainModelTests.mke $
#
#  $Copyright: (c) 2015 Bentley Systems, Incorporated. All rights reserved. $
#
#----------------------------------------------------------------------------------------
%include  mdl.mki

baseDir         = $(_MakeFilePath)
TestDir         = $(BuildContext)SubParts/UnitTests/source/

TEST_LOCATION   = $(TestDir)Published/
name            = TerrainModelTest_Published
o               = $(terrainModelBuildDir_)/test/Published/

%include $(SrcRoot)TerrainModel/privmki/TerrainModelCommon.mki

%if defined (BUILD_USING_VS2012)
    # Required for GTest
    nameToDefine = _VARIADIC_MAX=10
    %include cdefapnd.mki
%endif

always: 
    ~mkdir $(o)

$(o)TerrainModelTest$(oext)          : $(basedir)TerrainModelTest.cpp

#----------------------------------------------------------------------------------------
#   Link the executable
#----------------------------------------------------------------------------------------
#%if defined(COMPILE_PUBLISHED_TESTS)
#    objs = $[@wildcard $(BuildContext)SubParts/GUnitTests/objs/Published/*$(oext)]
#%endif

objs + $(o)TerrainModelTest$(oext)

#----------------------------------------------------------------------------------------
#   Libs
#----------------------------------------------------------------------------------------
DLM_NAME            = $(name)
DLM_DEST            = $(o)
DLM_EXTENSION       = $(shlibext)
DLM_OBJECT_FILES    = $(objs)
DLM_EXPORT_OBJS     = $(objs)
DLM_OBJECT_DEST     = $(o)
DLM_EXPORT_DEST     = $(o)
DLM_SYMB_DEST       = $(o)
DLM_MAP_DEST        = $(o)
DLM_NO_SIGN         = 1
DLM_NO_DEF          = 1
DLM_NO_DLS          = 1
DLM_NOENTRY         = 0
DLM_CONTEXT_LOCATION = $(BuildContext)Delivery/
LINKER_LIBRARIES    =   $(ContextSubpartsLibs)$(libprefix)BentleyGeom$(libext) \
                        $(ContextSubpartsLibs)$(libprefix)TerrainModelCore$(libext) \
                        $(ContextSubpartsLibs)$(libprefix)TerrainModelFormats$(libext) \
                        $(BuildContext)SubParts/Libs/$(stlibprefix)gtest$(stlibext)

%if $(TARGET_PLATFORM)=="Windows"  # *** WIP_NONPORT - define a way to specify OS libraries symbolically, without naming them
LINKER_LIBRARIES    +	advapi32$(libext)
%endif

%include dlmlink.mki

