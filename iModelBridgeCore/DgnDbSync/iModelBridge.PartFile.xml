<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">

    <!-- ........................................................................................................................................ -->
    <!-- iModelBridge    The bridge DLL. -->
    <!-- ........................................................................................................................................ -->

    <Part Name="iModelBridgeLibrary" BentleyBuildMakeFile="iModelBridge/iModelBridge.mke" ApiNumber="M02">
        <SubPart PartName="iModelDmsSupport" Repository="imodel02" PartFile="iModelBridgeCore/dmssupport/iModelDmsSupport"/>
        <SubPart PartName="DgnPlatformDLL" Repository="imodel02" PartFile="iModelCore/DgnPlatform/DgnPlatform" />
        <SubPart PartName="iModelHubClient" PartFile="iModelCore/WSClient/WSClient" Repository="imodel02" />
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="SourceInfoSchemaPrewire"/>
        <SubPart PartName="LaunchDarkly" Repository="bsicommon" PartFile="Libsrc-Nugets"/>
        <SubPart PartName="Licensing" Repository="imodel02" PartFile="iModelCore/LicensingCrossPlatform/licensingcrossplatform"/>
        <Bindings>
            <Libs Required="false">Delivery/$(libprefix)iModelBridge$(libext)</Libs>
            <Assemblies>Delivery/$(shlibprefix)iModelBridge$(ApiNumber)$(shlibext)</Assemblies>
        </Bindings>
    </Part>
    <Part Name="SourceInfoSchemaPrewire" BentleyBuildMakeFile="SourceInfoSchemaPrewire.mke" >
        <Bindings>
            <Files ProductDirectoryName="Assets" ProductSubDirectory="ECSchemas/Application" SubPartDirectory="ECSchemas/Application">
                Delivery/SourceInfo.ecschema.xml
            </Files>
        </Bindings>
    </Part>
    
    <Part Name="PublicApi" BentleyBuildMakeFile="iModelBridge/prewire.mke">
        <Bindings>
            <PublicAPI Domain="iModelBridge" />
        </Bindings>
    </Part>

    <Part Name="Docs-Windows" DeferType="BuildDocs" OnlyPlatforms="x64" ExcludeLibType="Static">
        <SubPart PartName="Docs" />
    </Part>

    <Part Name="Docs-Unix-Shim" DeferType="BuildDocs" OnlyPlatforms="Linux*">
        <SubPart PartName="Docs-Unix" LibType="Static"/>
    </Part>

    <Part Name="Docs-Unix" DeferType="BuildDocs" OnlyPlatforms="Linux*" ExcludeLibType="Dynamic">
        <SubPart PartName="Docs" />
    </Part>

    <Part Name="Docs" DeferType="BuildDocs" BentleyBuildMakeFile="iModelBridge/BuildDoc.mke" >
        <RequiredRepository>Bsitools-Doxygen</RequiredRepository>
        <SubPart PartName="BentleyDocConfig" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="iModelBridgeLibrary" />
        <Bindings>
            <Directory SourceName="Delivery/docs" ProductDirectoryName="iModelBridgeDoc" />
        </Bindings>
    </Part>

    <Part Name="Domains">
        <SubPart PartName="AecUnitsDomain"                  PartFile="Domains/AecUnits/AecUnits" />
        <SubPart PartName="BuildingSpatialDomain"           PartFile="Domains/BuildingSpatial/BuildingSpatial" />
        <SubPart PartName="ClassificationSystemsDomain"     PartFile="Domains/ClassificationSystems/ClassificationSystems" />
        <SubPart PartName="FormsDomainDLL"                  PartFile="Domains/Forms/FormsDomain" />
        <SubPart PartName="GeometryManipulationStrategies"  PartFile="Domains/BuildingShared/BuildingShared" />
        <SubPart PartName="Grids"                           PartFile="Domains/Grids/Grids" />
        <SubPart PartName="LinearReferencing"               PartFile="Domains/LinearReferencing/LinearReferencing" />
        <SubPart PartName="QuantityTakeoffsAspectsDomain"   PartFile="Domains/QuantityTakeoffsAspects/QuantityTakeoffsAspects" />
        <SubPart PartName="ProfilesDomainDLL"               PartFile="Domains/Profiles/ProfilesDomain" />
        <SubPart PartName="RoadRailAlignment"               PartFile="Domains/RoadRailAlignment/RoadRailAlignment" />
        <SubPart PartName="RoadRailPhysical"                PartFile="Domains/RoadRailPhysical/RoadRailPhysical" />
        <SubPart PartName="SpatialCompositionDomain"        PartFile="Domains/SpatialComposition/SpatialComposition" />
        <SubPart PartName="StructuralDomainDLL"             PartFile="Domains/Structural/StructuralDomains"/>

        <!--
            Apps like to include parts like BisSchemas:BuildingSchemas, which in turn depend on AecUnitsSchema.
            Since the above domain list includes AecUnitsSchema, we need to also include select other
            code-less schemas so that adding a <SubPart> does not conflict between our nuget and bisschemas source
            (e.g. they should only need the nuget).
        -->
        <SubPart PartName="BuildingSchemas" PartFile="BisSchemasIModelCore" Repository="BisSchemas"/>
        <SubPart PartName="BuildingSpatialSchema" PartFile="BisSchemasIModelCore" Repository="BisSchemas"/>
        <SubPart PartName="QuantityTakeoffsAspectsSchema" PartFile="BisSchemasIModelCore" Repository="BisSchemas"/>
    </Part>
    
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <!-- iModelBridgeFwk - Loads and runs iModelBridges connected to iModelHub -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <Product Name="iModelBridgeFwk" SaveProduct="true">
        <SubPart PartName="iModelBridgeFwkExe-Windows" LibType="Dynamic" />
        <SubPart PartName="iModelBridgeFwkExe-Unix-Shim"/>
        <SubPart PartName="Docs-Windows" LibType="Dynamic"/>
        <SubPart PartName="Docs-Unix-Shim"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <SubPart PartName="iModelBridgeAssignExeShim" />
        <SubPart PartName="iModelBridgeGetAffinityHostExe" />

        <Directories DirectoryListName="iModelBridgeAppCommonDirList"/>
        <Directories DirectoryListName="iModelBridgeFwkDirList"/>
    </Product>

    <ProductDirectoryList ListName="iModelBridgeFwkDirList">
        <ProductDirectory Name="Assemblies"                                     Path="bin"      RelativeTo="Root"/>
        <ProductDirectory Name="Assemblies"                 LibType="Static"    Deliver="false"/>
        <ProductDirectory Name="CrashpadHandler"                                Path="bin"      RelativeTo="Root"/>
        <ProductDirectory Name="CrashpadHandler"            LibType="Static"    Path="bin"      RelativeTo="Root"/>
        <ProductDirectory Name="iModelBridgeDoc"                                Path="docs"     RelativeTo="Root"/>
        <ProductDirectory Name="iModelBridgeDoc"            LibType="Static"    Path="docs"     RelativeTo="Root"/>
        <ProductDirectory Name="Libs"                                           Path="lib"      RelativeTo="Root"/>
        <ProductDirectory Name="Libs"                       LibType="Static"    Path="lib"      RelativeTo="Root"/>
        <ProductDirectory Name="PublicApi"                                      Path="include"  RelativeTo="Root"/>
        <ProductDirectory Name="PublicApi"                  LibType="Static"    Path="include"  RelativeTo="Root"/>
        <ProductDirectory Name="PublisherLoggingConfigXml"                      Path="bin"      RelativeTo="Root"/>
        <ProductDirectory Name="PublisherLoggingConfigXml"  LibType="Static"    Path="bin"      RelativeTo="Root"/>
        <ProductDirectory Name="VendorApi"                                      Path="include"  RelativeTo="Root"/>
        <ProductDirectory Name="VendorApi"                  LibType="Static"    Path="include"  RelativeTo="Root"/>
        <ProductDirectory Name="DgnV8Dlls"                                      Deliver="false"/>
        <ProductDirectory Name="DgnV8Dlls"                  LibType="Static"    Deliver="false"/>

        <ProductDirectory Name="BeHttpXliffs"                                   Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="BeHttpXliffs"               LibType="Static"    Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="DgnPlatformXliffs"                              Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="DgnPlatformXliffs"          LibType="Static"    Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="ECPresentationXliffs"                           Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="ECPresentationXliffs"       LibType="Static"    Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="WSClientXliffs"                                 Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="WSClientXliffs"             LibType="Static"    Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="xliffs"                                         Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="xliffs"                     LibType="Static"    Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="iModelBridgeFwkXliffs"                          Path="xliffs"   RelativeTo="Root"/>
        <ProductDirectory Name="iModelBridgeFwkXliffs"      LibType="Static"    Path="xliffs"   RelativeTo="Root"/>
    </ProductDirectoryList>

    <NuGetProduct Name="iModelBridgeFwkNuget" Description="iModel Bridge Framework">
        <SubPart PartName="iModelBridgeFwkExe-Windows" LibType="Dynamic"/>
        <SubPart PartName="iModelBridgeFwkExe-Unix-Shim"/>
        <SubPart PartName="Docs-Windows" LibType="Dynamic"/>
        <SubPart PartName="Docs-Unix-Shim"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <SubPart PartName="iModelBridgeAssignExeShim"/>
        <SubPart PartName="iModelBridgeGetAffinityHostExe"/>
        <SubPart PartName="Domains" />
        <SubPart PartName="UpdateClientRegistrationMsm"/>

        <Directories DirectoryListName="iModelBridgeAppCommonDirList"/>
        <Directories DirectoryListName="iModelBridgeFwkDirList"/>
        <Directories DirectoryListName="iModelBridgeFwkNugetDirList"/>
    </NuGetProduct>

    <ProductDirectoryList ListName="iModelBridgeFwkNugetDirList">
        <ProductDirectory Name="Root"                       Path="native"/>
        <ProductDirectory Name="Root"   LibType="Static"    Path="native"/>
        <ProductDirectory Name="MergeModules"               Path="MergeModules" RelativeTo="Root"/>
    </ProductDirectoryList>

    <!--
        This exists because iModelBridgeAssign always builds iModelBridgeGetAffinityHost statically, even on Windows.
        But, iModelBridgeFwk wants to deliver iModelBridgeAssign and its dependencies, along with a dynamic SDK.
        This would normally cause a build error because it reaches both static and dynamic .lib files (e.g. bentley.lib) through SubParts.
        So we create this Product middle-man to isolate the static EXE for iModelBridgeFwk.
        Further, we know that iModelBridgeGetAffinityHostExe has produced an EXE in our Delivery/ directory, so we can use it directly from there.
    -->
    <Product Name="__iModelBridgeGetAffinityHostWrapper">
        <SubPart PartName="iModelBridgeGetAffinityHostExe" LibType="Static"/>
        <Directories DirectoryListName="__iModelBridgeGetAffinityHostWrapperDirs"/>
    </Product>
    <ProductDirectoryList ListName="__iModelBridgeGetAffinityHostWrapperDirs">
        <ProductDirectory Name="Assemblies" Deliver="false"/>
        <ProductDirectory Name="Assemblies" LibType="Static" Path=""/>
        <ProductDirectory Name="Assets" Deliver="false"/>
        <ProductDirectory Name="Assets" LibType="Static" Deliver="false"/>
        <ProductDirectory Name="VendorNotices" Deliver="false"/>
        <ProductDirectory Name="VendorNotices" LibType="Static" Deliver="false"/>
    </ProductDirectoryList>
    <Part Name="__iModelBridgeGetAffinityHostForFwk" BentleyBuildMakeFile="iModelBridgeGetAffinityHostForFwk.mke">
        <SubProduct ProductName="__iModelBridgeGetAffinityHostWrapper"/>
        <Bindings>
            <Files ProductDirectoryName="Assemblies" ProductSubDirectory="iModelBridgeGetAffinityHost">Delivery/__iModelBridgeGetAffinityHostWrapper/iModelBridgeGetAffinityHost$(exeext)</Files>
        </Bindings>
    </Part>

    <Part Name="iModelBridgeFwkExe-Windows" OnlyPlatforms="x64" ExcludeLibType="Static">
      <SubPart PartName="iModelBridgeFwkExe"/>
    </Part>

    <Part Name="iModelBridgeFwkExe-Unix-Shim" OnlyPlatforms="Linux*">
      <SubPart PartName="iModelBridgeFwkExe-Unix" LibType="Static"/>
    </Part>

    <Part Name="iModelBridgeFwkExe-Unix" OnlyPlatforms="Linux*" ExcludeLibType="Dynamic">
        <SubPart PartName="iModelBridgeFwkExe"/>
    </Part>

    <Part Name="Platform-xliffs">
      <SubPart PartName="DgnPlatformDLL" Repository="imodel02" PartFile="iModelCore/DgnPlatform/DgnPlatform"/>
      <!-- DgnPlatformDLL is responsible for creating DgnPlatform xliffs -->
      <SubPart PartName="WSClient-Xliffs" PartFile="iModelCore/WSClient/WSClient" Repository="imodel02"/>
      <SubPart PartName="iModelHubClient-Xliffs" PartFile="iModelCore/WSClient/WSClient" Repository="imodel02"/>
      <SubPart PartName="BeHttp-Xliffs" PartFile="iModelCore/BeHttp/BeHttp" Repository="imodel02"/>
    </Part>

    <Part Name="iModelBridgeFwk-Xliffs" BentleyBuildMakeFile="iModelBridge/Fwk/xliffs.mke">
      <Bindings>
        <Files Required="false" ProductDirectoryName="iModelBridgeFwkXliffs" SubPartDirectory="xliffs">
          Delivery/xliffs/iModelBridgeFwk_en.xliff
        </Files>
      </Bindings>
    </Part>

    <!-- The English Sqlang database that bundles up iModelBridgeFwk's xliff along with platform library xliffs. -->
    <Part Name="iModelBridgeFwk-en" BentleyBuildMakeFile="${SrcRoot}bsicommon/sqlang/mki/XliffsToDb.mke" BentleyBuildMakeOptions="-dSQLANG_OutputDb=$(OutputRootDir)build/iModelBridgeFwkLib/iModelBridgeFwk_en-US.sqlang.db3 -dSQLANG_XliffWildcard=$(BuildContext)SubParts/xliffs/*.xliff">
        <SubPart PartName="Platform-xliffs"/>
        <SubPart PartName="iModelBridgeFwk-Xliffs"/>
      <Bindings>
        <Files ProductDirectoryName="Assets" ProductSubDirectory="sqlang" Required="true">Delivery/sqlang/iModelBridgeFwk_en-US.sqlang.db3</Files>
      </Bindings>
    </Part>

    <Part Name="iModelBridgeFwkLib" BentleyBuildMakeFile="iModelBridge/Fwk/iModelBridgeFwkLib.mke" ApiNumber="M02">
      <SubPart PartName="PublicAPI"/>
      <SubPart PartName="iModelHubClient" PartFile="iModelCore/WSClient/WSClient" Repository="imodel02"/>
      <SubPart PartName="iModelBridgeLibrary" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge" Repository="imodel02"/>
      <SubPart PartName="iModelBridgeFwk-en"/>
      <SubPart PartName="BeSecurity" PartFile="iModelCore/BeSecurity/BeSecurity" Repository="imodel02"/>
      <SubPart PartName="iModelDmsSupport" Repository="imodel02" PartFile="iModelBridgeCore/dmssupport/iModelDmsSupport"/>
      <SubPart PartName="cxxopts" Repository="bsicommon" PartFile="Libsrc-Nugets"/>
      <SubPart PartName="CrashpadHandler" PartFile="iModelCore/libsrc/crashpad/crashpad"/>
      <Bindings>
        <Assemblies>Delivery/$(libprefix)iModelBridgeFwkLib$(ApiNumber)$(shlibext)</Assemblies>
        <Libs Required="false">Delivery/$(libprefix)iModelBridgeFwkLib$(libext)</Libs>
        <Files ProductDirectoryName="PublisherLoggingConfigXml">Delivery/iModelBridgeFwkLib/iModelBridgeFwk.logging.config.xml</Files>
        <Files ProductDirectoryName="Assets">
            Delivery/iModelBridgeFwkLib/iModelBridgeFwk.debug.logging.config.xml
            Delivery/iModelBridgeFwkLib/iModelBridgeFwk.error.logging.config.xml
            Delivery/iModelBridgeFwkLib/iModelBridgeFwk.fatal.logging.config.xml
            Delivery/iModelBridgeFwkLib/iModelBridgeFwk.info.logging.config.xml
            Delivery/iModelBridgeFwkLib/iModelBridgeFwk.none.logging.config.xml
            Delivery/iModelBridgeFwkLib/iModelBridgeFwk.trace.logging.config.xml
            Delivery/iModelBridgeFwkLib/iModelBridgeFwk.warn.logging.config.xml
        </Files>
      </Bindings>
    </Part>

    <Part Name="iModelBridgeFwkExe" BentleyBuildMakeFile="iModelBridge/Fwk/iModelBridgeFwk.mke">
        <SubPart PartName="iModelBridgeFwkLib"/>
        <SubPart PartName="iModelBridgeGetAffinityHostExe" />
        <Bindings>
            <Files ProductDirectoryName="Assemblies">Delivery/exe/iModelBridgeFwk$(exeext)</Files>
        </Bindings>
    </Part>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <!-- iModelBridgeAssign - Writes to a database of bridge->file assignments -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <Product Name="iModelBridgeAssign" SaveProduct="true">
        <SubPart PartName="iModelBridgeAssignExeShim" />
        <SubPart PartName="__iModelBridgeGetAffinityHostForFwk"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <Directories DirectoryListName="iModelBridgeAssignDirList" />
    </Product>

    <ProductDirectoryList ListName="iModelBridgeAssignDirList">
        <ProductDirectory Name="Root"                               Path=""/>
        <ProductDirectory Name="Root"           LibType="Static"    Path=""/>
        <ProductDirectory Name="Bin"                                Path="" RelativeTo="Root"/>
        <ProductDirectory Name="Bin"            LibType="Static"    Path="" RelativeTo="Root"/>
      
        <ProductDirectory Name="Assemblies"     LibType="Static"    Path="" RelativeTo="Bin"/>
        <ProductDirectory Name="Assemblies"     LibType="dynamic"   Path="" RelativeTo="Bin"/>
        <ProductDirectory Name="Assets"         LibType="static"    Path="assets" RelativeTo="Root"/>
        <ProductDirectory Name="VendorNotices"  LibType="static"    Path="notices" RelativeTo="Root"/>
      
        <ProductDirectory Name="Libs"           Deliver="false" LibType="static"/>
        <ProductDirectory Name="Libs"           Deliver="false" LibType="dynamic"/>
        <ProductDirectory Name="PublicApi"      Deliver="false" LibType="static"/>
        <ProductDirectory Name="PublicApi"      Deliver="false" LibType="dynamic"/>
        <ProductDirectory Name="VendorApi"      Deliver="false" LibType="static"/>
        <ProductDirectory Name="VendorApi"      Deliver="false" LibType="dynamic"/>
        <ProductDirectory Name="Assets"         Deliver="false" LibType="dynamic"/>
        <ProductDirectory Name="VendorNotices"  Deliver="false" LibType="dynamic"/>
        <ProductDirectory Name="DgnV8Dlls"      Deliver="false" LibType="dynamic" />
        <ProductDirectory Name="DgnV8Dlls"      Deliver="false" LibType="static" />
    </ProductDirectoryList>
    
    <NuGetProduct Name="iModelBridgeAssignNuget" Description="iModel Bridge Assign">
        <SubPart PartName="iModelBridgeAssignExeShim"/>
        <SubPart PartName="__iModelBridgeGetAffinityHostForFwk"/>
        <Directories DirectoryListName="iModelBridgeAssignDirList"/>
        <Directories DirectoryListName="iModelBridgeAssignNugetDirList"/>
    </NuGetProduct>

    <ProductDirectoryList ListName="iModelBridgeAssignNugetDirList">
        <ProductDirectory Name="Root"                                               Path="native"/>
        <ProductDirectory Name="Root"                           LibType="Static"    Path="native"/>
        <ProductDirectory Name="Assets"                                             Path="assets" RelativeTo="Root"/>
        <ProductDirectory Name="Bin"                                                RelativeTo="Root"/>
        <ProductDirectory Name="iModelBridgeGetAffinityHostExe" LibType="Static"    Path="iModelBridgeGetAffinityHost" RelativeTo="Root"/>
        <ProductDirectory Name="VendorNotices"                                      Path="notices" RelativeTo="Root"/>

        <ProductDirectory Name="Assemblies" LibType="Static" Deliver="false"/>
    </ProductDirectoryList>

    <Part Name="iModelBridgeAssignExeShim_Dynamic" OnlyPlatforms="x64">
        <SubPart PartName="iModelBridgeAssignExe" LibType="Dynamic"/>
    </Part>
    <Part Name="iModelBridgeAssignExeShim_Static" OnlyPlatforms="macosx64,linuxx64">
        <SubPart PartName="iModelBridgeAssignExe" LibType="Static"/>
    </Part>
    <Part Name="iModelBridgeAssignExeShim">
        <SubPart PartName="iModelBridgeAssignExeShim_Dynamic"/>
        <SubPart PartName="iModelBridgeAssignExeShim_Static"/>
    </Part>

    <Part Name="iModelBridgeAssignExe" BentleyBuildMakeFile="iModelBridge/Fwk/Registry/iModelBridgeAssignMain.mke">
        <SubPart PartName="BeSQLite" PartFile="iModelCore/BeSQLite/BeSQLite" Repository="imodel02" />
        <SubPart PartName="BeXml" PartFile="iModelCore/Bentley/Bentley" Repository="imodel02"/>
        <SubPart PartName="PublicApi"/>
        <SubPart PartName="cxxopts" Repository="bsicommon" PartFile="Libsrc-Nugets"/>
        <SubPart PartName="VersionedV8_InternalSDK" PartFile="iModelBridgeCore/DgnDbSync/DgnDbSync"/>
        <SubPart PartName="PublicAPI" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <Bindings>
            <Files ProductDirectoryName="Assemblies">Delivery/exe/iModelBridgeAssign$(exeext)</Files>
        </Bindings>
    </Part>

    <Part Name="iModelBridgeGetAffinityHostExeShim_Dynamic" OnlyPlatforms="x64">
        <SubPart PartName="iModelBridgeGetAffinityHostExe" LibType="Dynamic"/>
    </Part>
    <Part Name="iModelBridgeGetAffinityHostExeShim_Static" OnlyPlatforms="macosx64,linuxx64">
        <SubPart PartName="iModelBridgeGetAffinityHostExe" LibType="Static"/>
    </Part>
    <Part Name="iModelBridgeGetAffinityHostExeShim">
        <SubPart PartName="iModelBridgeGetAffinityHostExeShim_Dynamic"/>
        <SubPart PartName="iModelBridgeGetAffinityHostExeShim_Static"/>
    </Part>

    <Part Name="iModelBridgeGetAffinityHostExe" BentleyBuildMakeFile="iModelBridge/Fwk/Registry/iModelBridgeGetAffinityHost.mke">
        <SubPart PartName="BentleyDll" PartFile="iModelCore/Bentley/Bentley" Repository="imodel02" />
        <SubPart PartName="PublicApi"/>
        <Bindings>
            <Files ProductDirectoryName="Assemblies">Delivery/exe/iModelBridgeGetAffinityHost$(exeext)</Files>
        </Bindings>
    </Part>

    <Part Name="iModelBridgeGetAffinityHostExeStatic" BentleyBuildMakeFile="iModelBridge/Fwk/Registry/iModelBridgeGetAffinityHost.mke">
        <SubPart LibType="Static" PartName="BentleyDll" PartFile="iModelCore/Bentley/Bentley"/>
        <Bindings>
            <Files ProductDirectoryName="iModelBridgeGetAffinityHostExe">Delivery/exe/iModelBridgeGetAffinityHost$(exeext)</Files>
        </Bindings>
    </Part>

    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <!-- iModelBridgeFwkICSPlugin - a product that installs a plugin into ProjectWise Orchestration Framework/Automation Services -->
    <!-- This plugin invokes iModelBridgeFwk. The plugin is and must be a separate product WITH NO BUILD CHAIN DEPENDENCIES
           because the plugin must be 32-bit, while iModelBridgeFwk must be 64-bit. The user installs each product separately.
      -->
    <!-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    <Product Name="iModelBridgeFwkICSPlugin">
      <SubPart PartName="iModelBridgeFwkICSPluginDll"/>
      <SubPart PartName="iModelBridgeFwkICSPluginConfigBootStrapperExe" />
      <Directories DirectoryListName="iModelBridgeFwkICSPluginDirList" />
    </Product>

    <ProductDirectoryList ListName="iModelBridgeFwkICSPluginDirList">
      <ProductDirectory Name="iModelBridgeFwkICSPluginBinaries" Path=""/>
    </ProductDirectoryList>

    <Part Name="iModelBridgeFwkICSPluginConfigBootStrapperExe" BMakeFile="iModelBridge/Fwk/bas/Bootstrapper/iModelBridgeFwkICSPluginConfigBootStrapper.mke" OnlyPlatforms="x86">
      <Bindings>
        <Assemblies ProductDirectoryName="iModelBridgeFwkICSPluginBinaries">Delivery/iModelBridgeFwkICSPluginConfigBootStrapper.exe</Assemblies>
      </Bindings>
    </Part>

    <Part Name="iModelBridgeFwkICSPluginDll" BMakeFile="iModelBridge/Fwk/bas/iModelBridgeFwkICSPlugin.mke" OnlyPlatforms="x86">
      <Bindings>
        <Assemblies ProductDirectoryName="iModelBridgeFwkICSPluginBinaries">Delivery/iModelBridgeFwkICSPlugin.dll</Assemblies>
      </Bindings>
    </Part>

    <!-- ******************************** Unit Tests ************************************** -->

    <Part Name="PrewireForUnitTests" DeferType="BuildUnitTests" BentleyBuildMakeFile="iModelBridge/Tests/Prewire.mke">
        <SubPart PartName="iModelBridgeLibrary"/>
        <SubPart PartName="iModelBridgeFwkLib"/>
        <SubPart PartName="DgnPlatformUnitTestHelpers" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="DgnDbTestUtils" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02" />
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <Bindings>
            <Files ProductDirectoryName="UnitTests-IgnoreList" ProductSubDirectory="iModelBridge" SubPartDirectory="UnitTests/iModelBridge">Delivery/UnitTests/ignore_list.txt</Files>
        </Bindings>
    </Part>

    <Part Name="UnitTests-Common" DeferType="BuildUnitTests" BentleyBuildMakeFile="iModelBridge/Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Common">
        <SubPart PartName="PrewireForUnitTests" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects" ProductSubDirectory="iModelBridge/Common" SourceName="Delivery/UnitTests/Objects/Common"/>
        </Bindings>
    </Part>
    
    
    <Part Name="UnitTests-NonPublished" DeferType="BuildUnitTests" BentleyBuildMakeFile="iModelBridge/Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=NonPublished">
        <SubPart PartName="UnitTests-Common" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects" ProductSubDirectory="iModelBridge/NonPublished" SourceName="Delivery/UnitTests/Objects/NonPublished"/>
        </Bindings>
    </Part>

    <Part Name="UnitTests-Performance" DeferType="BuildUnitTests" BentleyBuildMakeFile="iModelBridge/Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Performance">
        <SubPart PartName="UnitTests-Common" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects" ProductSubDirectory="iModelBridge/Performance" SourceName="Delivery/UnitTests/Objects/Performance"/>
        </Bindings>
    </Part>

    <!-- Define a test collection part. This is included in MobileDgn's TestsAggregate -->
    <Part Name="Tests" DeferType="BuildUnitTests">
        <SubPart PartName="UnitTests-NonPublished"/>
    </Part>

    <!-- Define a gtest program to run the tests. The Gtest and RunGtest parts are included in MobileDgn's Gtest-Aggregator and RunGtest-MobileDgnTests parts -->
    <Product Name="iModelBridge-Tests">
        <SubPart PartName="Base" PartFile="iModelCore/BeGTest/BeGTest" Repository="imodel02"/>
        <SubPart PartName="DgnPlatformSqlang" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02" />
        <SubPart PartName="Tests"/>
        <Directories DirectoryListName="CollectionProduct" Repository="imodel02"  PartFile="iModelCore/BeGTest/BeGTest"/>
        <Directories DirectoryListName="iModelBridge-TestsDirs"/>
    </Product>

    <Product Name="iModelBridge-PerformanceObjs">
        <SubPart PartName="Base" PartFile="iModelCore/BeGTest/BeGTest"/>
        <SubPart PartName="DgnPlatformSqlang" PartFile="iModelCore/DgnPlatform/DgnPlatform"/>
        <SubPart PartName="UnitTests-Performance"/>
        <Directories DirectoryListName="CollectionProduct" PartFile="iModelCore/BeGTest/BeGTest"/>
        <Directories DirectoryListName="iModelBridge-TestsDirs"/>
    </Product>
    
    <ProductDirectoryList ListName="iModelBridge-TestsDirs">
        <ProductDirectory Name="DgnV8Dlls" Deliver="false"/>
    </ProductDirectoryList>

    <!-- ********************** -->
    <!-- **** Gtest **** -->
    <!-- ********************** -->

    <Part Name="Gtest" DeferType="BuildUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/gtest/buildGtest.mke" BentleyBuildMakeOptions="-dTEST_NAME=iModelBridgeTest -dTEST_COLLECTION_PRODUCT=iModelBridge-Tests -dTEST_FRAMEWORK_SQLANG=DgnPlatform_en.sqlang.db3" OnlyPlatforms="x86,x64,Linux*,MacOS*">
        <SubProduct ProductName="iModelBridge-Tests"/>
        <SubPart PartName="Gtest-Tools" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
        <Bindings>
            <Files ProductDirectoryName="Gtest-NativeAssemblies">Delivery/Gtest/iModelBridgeTest/Assemblies/*</Files>
            <Directory ProductDirectoryName="Gtest-Assets" SourceName="Delivery/Gtest/iModelBridgeTest/Assets" />
        </Bindings>
    </Part>

    <Part Name="Gtest-Performance" DeferType="BuildUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/gtest/buildGtest.mke" BentleyBuildMakeOptions="-dTEST_NAME=iModelBridgePerformanceTest -dTEST_COLLECTION_PRODUCT=iModelBridge-PerformanceObjs -dTEST_FRAMEWORK_SQLANG=DgnPlatform_en.sqlang.db3" OnlyPlatforms="x86,x64,Linux*,MacOS*">
        <SubProduct ProductName="iModelBridge-PerformanceObjs"/>
        <SubPart PartName="Gtest-Tools" PartFile="iModelCore/BeGTest/BeGTest"/>
        <Bindings>
            <Files ProductDirectoryName="Gtest-NativeAssemblies">Delivery/Gtest/iModelBridgePerformanceTest/Assemblies/*</Files>
            <Directory ProductDirectoryName="Gtest-Assets" SourceName="Delivery/Gtest/iModelBridgePerformanceTest/Assets" />
        </Bindings>
    </Part>
    
    <Product Name="iModelBridge-Gtest" >
        <SubPart PartName="Gtest"/>
        <Directories DirectoryListName="GtestProduct" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
    </Product>

    <Product Name="iModelBridge-PerformanceTest">
        <SubPart PartName="Gtest-Performance"/>
        <Directories DirectoryListName="GtestProduct" PartFile="iModelCore/BeGTest/BeGTest"/>
    </Product>
    <Part Name="RunGtest" DeferType="RunUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/gtest/RunGtest.mke" BentleyBuildMakeOptions="-dGTEST_PRODUCT=iModelBridge-Gtest -dGTEST_NAME=iModelBridgeTest" OnlyPlatforms="x86,x64,MacOs*,Linux*">
        <SubProduct ProductName="iModelBridge-Gtest" />
        <SubProduct ProductName="iModelBridge-PerformanceTest" />
        <SubPart PartName="Gtest-Tools" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
        <Bindings>
          <Files Required="false" SubPartDirectory="Gtest/Logs">Delivery/Gtest/Logs/iModelBridgeTest.log</Files>
        </Bindings>
    </Part>

    <!-- ********************** -->
    <!-- **** AndroidJUnit **** -->
    <!-- ********************** -->
    <Part Name="AndroidJUnit" DeferType="BuildUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/Android//MakeJUnitTestProject.mke" BentleyBuildMakeOptions="-dTEST_COLLECTION_PRODUCT=iModelBridge-Tests -dTEST_SHORT_NAME=iMoBridgeTst -dTEST_FRAMEWORK_SQLANG=DgnPlatform_en.sqlang.db3 -dUSE_STATIC_LIBRARIES=1 -dTEST_ANDROID_MIN_SDK_VERSION=19" OnlyPlatforms="Android*">
        <SubProduct ProductName="iModelBridge-Tests"/>
        <SubPart PartName="AndroidJUnitTest-Tools" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
        <Bindings>
            <Directory ProductDirectoryName="AndroidJUnit-Project" SourceName="Delivery/ANJUP" />
        </Bindings>
    </Part>

    <Product Name="iModelBridge-AndroidJUnit" >
        <SubPart PartName="AndroidJUnit" LibType="Static"/>
        <Directories DirectoryListName="AndroidJUnitProduct" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
    </Product>

    <Part Name="RunAndroidJUnitTest" DeferType="RunUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/Android//RunAndroidJUnitTest.mke" BentleyBuildMakeOptions="-dANDROIDJUNIT_PRODUCT=iModelBridge-AndroidJUnit" OnlyPlatforms="Android*">
        <SubProduct ProductName="iModelBridge-AndroidJUnit"/>
        <Bindings>
          <Files Required="false" SubPartDirectory="ANJU/Logs">Delivery/ANJU/Logs/iModelBridge-AndroidJUnit.log</Files>
        </Bindings>
    </Part>

    <!-- ********************** -->
    <!-- **** iOSXCTest **** -->
    <!-- ********************** -->
    <Part Name="iOSXCTest" DeferType="BuildUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/iOS//MakeXCTestProject.mke" BentleyBuildMakeOptions="-dTEST_NAME=iModelBridge -dTEST_COLLECTION_PRODUCT=iModelBridge-Tests -dTEST_FRAMEWORK_SQLANG=DgnPlatform_en.sqlang.db3 -dUSE_STATIC_LIBRARIES=1" OnlyPlatforms="iOS*">
        <SubProduct ProductName="iModelBridge-Tests"/>
        <SubPart PartName="iOSXCTest-Tools" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
        <Bindings>
            <Directory ProductDirectoryName="iOSXCTestProject" SourceName="Delivery/iOSXCTest/iModelBridge/Project" />
        </Bindings>
    </Part>

    <Product Name="iModelBridge-iOSXCTest" >
        <SubPart PartName="iOSXCTest" LibType="Static"/>
        <Directories DirectoryListName="iOSXCTestProduct" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
    </Product>

    <Part Name="RuniOSXCTest" DeferType="RunUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/iOS//RunXCTestProject.mke" BentleyBuildMakeOptions="-dXCTEST_PRODUCT=iModelBridge-iOSXCTest" OnlyPlatforms="iOS*">
        <SubProduct ProductName="iModelBridge-iOSXCTest"/>
        <Bindings>
            <Files Required="false" SubPartDirectory="XCTest/Logs">Delivery/XCTest/Logs/iModelBridge-iOSXCTest.log</Files>
        </Bindings>
    </Part>

    <!-- *********************************************************** -->
    <!-- **** UWP Microsoft::VisualStudio::CppUnitTestFramework **** -->
    <!-- *********************************************************** -->
    <!-- N.B. ApiNumber is important here because we must manually reference some DLLs, and thus need an accruate suffix to find them. -->
    <Part
        Name="UwpTest" DeferType="BuildUnitTests"
        BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/uwp//MakeUwpTestProject.mke"
        BentleyBuildMakeOptions="-dTEST_NAME=iModelBridge -dTEST_COLLECTION_PRODUCT=iModelBridge-Tests -dTEST_FRAMEWORK_SQLANG=DgnPlatform_en.sqlang.db3"
        OnlyPlatforms="WinRT*"
        ApiNumber="M02"
        >
        <SubProduct ProductName="iModelBridge-Tests"/>
        <SubPart PartName="UwpTest-Tools" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
        <Bindings>
            <Directory ProductDirectoryName="UwpTestProject" SourceName="Delivery/iModelBridgeUwpTest"/>
        </Bindings>
    </Part>

    <Product Name="iModelBridge-UwpTest">
        <SubPart PartName="UwpTest"/>
        <Directories DirectoryListName="UwpTestProduct" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
    </Product>

    <Part
        Name="RunUwpTest"
        DeferType="RunUnitTests"
        BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/uwp//RunUwpTestProject.mke"
        BentleyBuildMakeOptions="-dUWPTEST_PRODUCT=iModelBridge-UwpTest"
        OnlyPlatforms="WinRT*"
        >
        <SubPart PartName="UwpTest-Tools" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
        <SubProduct ProductName="iModelBridge-UwpTest"/>
        <Bindings>
            <Files Required="false" SubPartDirectory="UwpTest/Logs">Delivery/UwpTest/Logs/iModelBridge-UwpTest.log</Files>
        </Bindings>
    </Part>

    <ProductDirectoryList ListName="iModelBridgeAppCommonDirList">
        <ProductDirectory Name="Root"                                               Path=""/>
        <ProductDirectory Name="Root"                           LibType="Static"    Path=""/>
        <ProductDirectory Name="Assets"                                             Path="assets"       RelativeTo="Root"/>
        <ProductDirectory Name="Assets"                         LibType="static"    Path="assets"       RelativeTo="Root"/>
        <ProductDirectory Name="VendorNotices"                                      Path="notices"      RelativeTo="Root"/>
        <ProductDirectory Name="VendorNotices"                  LibType="Static"    Path="notices"      RelativeTo="Root"/>
        <ProductDirectory Name="BentleyEulaDelivery"                                Path="notices"      RelativeTo="Root"/>
        <ProductDirectory Name="Assemblies"                                         Path=""             RelativeTo="Root"/>
        <ProductDirectory Name="BentleyClientSharedAssemblies"                      Path=""             RelativeTo="Root"/>
        <ProductDirectory Name="BentleyDesktopClientApi"                            Path=""             RelativeTo="Root"/>
        <ProductDirectory Name="BentleyDesktopClientApi_Native"                     Path=""             RelativeTo="Root"/>
        <ProductDirectory Name="Assemblies"                                         Path=""             RelativeTo="Root"/>
        <ProductDirectory Name="dgnplatformlinestylersc"                            Path="LineStyles"   RelativeTo="Root"/>
        <ProductDirectory Name="PublisherLoggingConfigXml"                          Path=""             RelativeTo="Root"/>
        <ProductDirectory Name="PdfLibInitNativeAssemblies"                         Deliver="false"/>
        <ProductDirectory Name="DgnV8Dlls"                                          Path="DgnV8"        RelativeTo="Root"/>
        <ProductDirectory Name="DgnV8DummyUstation"                                 Path="DgnV8"        RelativeTo="Root"/>
    </ProductDirectoryList>

    <Part Name="UpdateClientRegistrationMsm" BentleyBuildMakeFile="iModelBridge/UpdateClientRegistrationMsm.mke">
        <Bindings>
            <Files ProductDirectoryName="MergeModules">Delivery/UpdateClientRegistration.msm</Files>
        </Bindings>
    </Part>

</BuildContext>
