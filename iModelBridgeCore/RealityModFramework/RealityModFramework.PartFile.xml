<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">

    <Part Name="PublicAPI" BentleyBuildMakeFile="RealityModFramework.prewire.mke">
        <Bindings>
            <PublicAPI Domain="RealityPlatform" />
            <PublicAPI Domain="RealityPackage" />
        </Bindings>
    </Part>
    
    <Part Name="RealityPlatform" BentleyBuildMakeFile="RealityPlatform\RealityPlatform.mke">
      <SubPart PartName="PublicAPI" />
      <SubPart PartName="ImagePPDll"                 PartFile="ImagePP"                   Repository="ImagePP" />
      <SubPart PartName="PointoolsVortexAPI_VS2012"  PartFile="PointoolsVortexAPI_VS2012" Repository="PointoolsVortexAPI" />
      <SubPart PartName="BeCurl"                     PartFile="BeCurl"                    Repository="Libsrc-Curl"/>
      <SubPart PartName="BeJsonCpp"                  PartFile="BeJsonCpp"                 Repository="Libsrc-JsonCpp"/>
      <Bindings>
          <Libs>Delivery/$(stlibprefix)RealityPlatform$(stlibext)</Libs>
          <Assemblies ProductDirectoryName="RealityAssemblies">delivery/$(shlibprefix)RealityPlatform$(shlibext)</Assemblies>
      </Bindings>
    </Part>

    <Part Name="RealityCrawler" BMakeFile="RealityCrawler\RealityCrawler.mke">
        <SubPart PartName="RealityPlatform"/>
        <SubPart PartName="WMSCapabilitiesNET"/>
    </Part>

    <Part Name="RealityDataHandlerTester" BentleyBuildMakeFile="RealityPlatform\Tests\RealityDataHandlerTester\RealityDataHandlerTester.mke" OnlyPlatforms="x86,x64">
        <SubPart PartName="RealityPlatform"/>
        <Bindings>
            <Assemblies ProductDirectoryName="RealityAssemblies">Delivery/RealityDataHandlerTester.exe</Assemblies>
        </Bindings>
    </Part>

    <Part Name="RealityPackage" BentleyBuildMakeFile="RealityPackage\RealityPackage.mke">
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="BentleyDll"  PartFile="Bentley"      Repository="Bentley" />
        <SubPart PartName="BeXmlDll"    PartFile="BeLibxml2"    Repository="libsrc-libxml2" />
        <SubPart PartName="GeomDlls"    PartFile="geomlibs"     Repository="GeomLibs" />        
        <Bindings>
            <Libs>Delivery/$(stlibprefix)RealityPackage$(stlibext)</Libs>
            <Assemblies ProductDirectoryName="RealityAssemblies">Delivery/$(shlibprefix)RealityPackage$(shlibext)</Assemblies>
        </Bindings>
    </Part>

    <Part Name="CrawlerLib" BentleyBuildMakeFile="CrawlerLib\CrawlerLib.mke">
        <SubPart PartName="BeCurl"              PartFile="BeCurl"       Repository="Libsrc-Curl"/>
        <SubPart PartName="BeXmlDll"            PartFile="BeLibxml2"    Repository="libsrc-libxml2" />
        <SubPart PartName="BentleyDll"  PartFile="Bentley"      Repository="Bentley" />
        <Bindings>
            <PublicAPI Domain="CrawlerLib" />
            <Libs>Delivery/$(stlibprefix)CrawlerLib$(stlibext)</Libs>
            <Assemblies ProductDirectoryName="RealityAssemblies">Delivery/$(shlibprefix)CrawlerLib$(shlibext)</Assemblies>
        </Bindings>
    </Part>

    <Part Name="CrawlerLibExample" BMakeFile="CrawlerLib/Example/CrawlerLibExample.mke">
        <SubPart PartName="CrawlerLib" />
        <Bindings>
            <Assemblies ProductDirectoryName="RealityAssemblies">Delivery/CrawlerLibExample.exe</Assemblies>
        </Bindings>
    </Part>

    <Part Name="DownloadEngineExample" BentleyBuildMakeFile="RealityPlatform\Example\DownloadEngineExample.mke">
        <SubPart PartName="BeCurl"              PartFile="BeCurl"       Repository="Libsrc-Curl"/>
        <SubPart PartName="BentleyDll"  PartFile="Bentley"      Repository="Bentley" />
        <SubPart PartName="RealityPlatform"/>
        <Bindings>
            <Assemblies ProductDirectoryName="RealityAssemblies">Delivery/DownloadEngineExample.exe</Assemblies>
        </Bindings>
    </Part>

    <Part Name="PrewireForUnitTests" BentleyBuildMakeFile="Tests/Prewire.mke">
        <Bindings>
            <!-- un-comment this if you want to deliver ignore_list.txt
            <Files ProductDirectoryName="UnitTests-IgnoreList" ProductSubDirectory="RealityMod" SubPartDirectory="UnitTests/RealityMod"> Delivery/UnitTests/ignore_list.txt</Files>
            -->
            <Files ProductDirectoryName="UnitTests-Assets" ProductSubDirectory="xsd">Delivery/UnitTests/RealityPackage.1.0.xsd</Files>
            </Bindings>
        </Part>

    <Part Name="RealityPackageUnitTests" BentleyBuildMakeFile="Tests/BuildTests.mke" BMakeOptions="-dTestDir=RealityPackage">
        <SubPart PartName="PrewireForUnitTests" />
        <SubPart PartName="RealityPackage"/>
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    ProductSubDirectory="RealityPackage" SourceName="Delivery/UnitTests/Objects/RealityPackage"/>
        </Bindings>
    </Part>

    <Part Name="RealityPlatformUnitTests" BentleyBuildMakeFile="Tests/BuildTests.mke" BMakeOptions="-dTestDir=RealityPlatform">
        <SubPart PartName="PrewireForUnitTests" />
        <SubPart PartName="RealityPlatform"/>
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    ProductSubDirectory="RealityPlatform" SourceName="Delivery/UnitTests/Objects/RealityPlatform"/>
        </Bindings>
    </Part>

    <Part Name="CrawlerLibUnitTests" BentleyBuildMakeFile="Tests/BuildTests.mke" BMakeOptions="-dTestDir=CrawlerLib">
        <SubPart PartName="PrewireForUnitTests" />
        <SubPart PartName="CrawlerLib"/>
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    ProductSubDirectory="CrawlerLib" SourceName="Delivery/UnitTests/Objects/CrawlerLib"/>
        </Bindings>
    </Part>

    <!-- Define a test collection product -->
    <Part Name="Tests">
        <SubPart PartName="RealityPackageUnitTests"/>
        <SubPart PartName="RealityPlatformUnitTests"/>
        <SubPart PartName="CrawlerLibUnitTests"/>
    </Part>

    <Product Name="Reality-Tests">
        <SubPart Repository="BeGTest" PartFile="BeGTest" PartName="Base" />
        <SubPart PartName="Tests"/>
        <Directories DirectoryListName="CollectionProduct" Repository="BeGTest"  PartFile="BeGTest"/>
        <Directories DirectoryListName="RealityTestsDir"/>
    </Product>

    <ProductDirectoryList ListName="RealityTestsDir" >
        <ProductDirectory Name="RealityAssemblies"              Path="Assemblies"/>
        <ProductDirectory Name="ImagePPAssemblies"              Path="Assemblies"/>
        <ProductDirectory Name="PPNativeAssemblies"             Path="Assemblies" />
        <ProductDirectory Name="PdfLibInitNativeAssemblies"     Path="Assemblies" />
        <ProductDirectory Name="MrSidAssemblies"                Path="Assemblies" />
        <ProductDirectory Name="ErdasEcwJpeg2000Assemblies"     Path="Assemblies" />
        <ProductDirectory Name="ECObjectsNativeAssemblies"      Path="Assemblies" />
        <ProductDirectory Name="ECObjectsManagedAssemblies"     Path="Assemblies" />
        <ProductDirectory Name="ECServicesManagedAssemblies"    Path="Assemblies"/>
        <ProductDirectory Name="PointoolsAssemblies"            Path="Assemblies"/>
        <ProductDirectory Name="PointoolsAssemblies32Ext"       Path="Pointools32Ext" RelativeTo="PointoolsAssemblies"/>

        <ProductDirectory Name="AdobeAssemblies"                Path="Assemblies" Deliver="false"/>
        <ProductDirectory Name="AdobeResource"                  Path="System/Data/PDFL" RelativeTo="AdobeAssemblies"  Deliver="false"/>
        <ProductDirectory Name="OracleNativeAssemblies"         Deliver="false"/>
        <ProductDirectory Name="GdalData"                       Deliver="false"/>
        <ProductDirectory Name="csmapmergemodules"              Deliver="false" />
    </ProductDirectoryList>

    <!-- Define a gtest program to run the tests -->
    <Part Name="Gtest" BentleyBuildMakeFile="${SrcRoot}BeGTest/gtest/buildGTest.mke" BentleyBuildMakeOptions="-dTEST_NAME=RealityTest -dTEST_COLLECTION_PRODUCT=Reality-Tests" OnlyPlatforms="x86,x64,Linux*,MacOS*">
        <SubProduct ProductName="Reality-Tests"/>
        <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
        <Bindings>
            <Files ProductDirectoryName="Gtest-NativeAssemblies">Delivery/Gtest/RealityTest/Assemblies/*</Files>
            <Directory ProductDirectoryName="Gtest-Assets" SourceName="Delivery/Gtest/RealityTest/Assets" />
        </Bindings>
    </Part>

    <Product Name="Reality-Gtest" >
        <SubPart PartName="Gtest"/>
        <Directories DirectoryListName="GtestProduct" Repository="BeGTest" PartFile="BeGTest"/>
    </Product>

    <Part Name="RunGtest" BentleyBuildMakeFile="${SrcRoot}BeGTest/gtest/RunGTest.mke" BentleyBuildMakeOptions="-dGTEST_EXE=$(OutputRootDir)Product/Reality-Gtest/RealityTest -dGTEST_OUTPUT_DIR=$(OutputRootDir)build/Reality" OnlyPlatforms="x86,x64,MacOs*,Linux*">
        <SubProduct ProductName="Reality-Gtest" />
        <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
    </Part>
    
    <Part Name="Reality-Examples">
        <SubPart PartName="RealityDbECPlugin"/>
        <SubPart PartName="CrawlerLibExample"/>
        <SubPart PartName="RealityDbECPluginInstaller" />
        <!--<SubPart PartName="RealityCrawler"/>-->
    </Part>

    <Part Name="RealityDb" BentleyBuildMakeFile="RealityDb\RealityDb.mke">
        <Bindings>
             <Files ProductDirectoryName="ECSchemas" SourceName="Delivery">Delivery/ECSchemaNewDB.xml</Files>
        </Bindings>
    </Part>

    <Part Name="RealityDbECPlugin" BMakeFile="RealityDbECPlugin\RealityDbECPlugin.mke" OnlyPlatforms="x86,x64">
        <SubPart PartName="RealityDb"/>
        <SubPart PartName="BentleyWMSPackageNet"/>
        <SubPart PartName="ECServices"          PartFile="ecf"            Repository="ecf" />
        <SubPart PartName="JsonNet45"           PartFile="${SrcBsiCommon}CvsPartFiles\bin"    Repository="Bin-JsonNet" />
        <SubPart PartName="IdentityModel"       PartFile="${SrcBsiCommon}CvsPartFiles\identitymodel"    Repository="BCC-IdentityModel" />
        <Bindings>
            <Assemblies ProductDirectoryName="RealityAssemblies">Delivery/Bentley.RealityDbECPlugin.dll</Assemblies>
        </Bindings>

    </Part>
    
    <Part Name="BentleyWMSPackageNet" BentleyBuildMakeFile="BentleyWMSPackageNet\BentleyWMSPackageNet.mke">
        <SubPart PartName="RealityPackage"/>
        <SubPart PartName="RealityPlatform"/>
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="BentleyDll"  PartFile="Bentley"      Repository="Bentley" />
        <SubPart PartName="GeomDlls"    PartFile="geomlibs"     Repository="GeomLibs" />
        <Bindings>
            <Assemblies ProductDirectoryName="RealityAssemblies">Delivery/BentleyWMSPackageNet$(shlibext)</Assemblies>
        </Bindings>
    </Part>

    <Part Name="RealityDbECPluginInstaller" BMakeFile="RealityDbECPlugin/Install/Install.mke">
      <RequiredRepository>bsitools-wix_3.10.2103.0</RequiredRepository>
      <RequiredRepository>Miscdev-Eula</RequiredRepository>
      <Bindings>
        <Files ProductDirectoryName="ApplicationInstallRoot" Required="true" IfNotPresent="Warn">Delivery/Setup_RealityDbECPlugin.msi</Files>
      </Bindings>
    </Part>

    <Part Name="WMSCapabilitiesNET" BentleyBuildMakeFile="WMSCapabilitiesNET\WMSCapabilitiesNET.mke">
        <SubPart PartName="RealityPlatform"/>
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="BentleyDll"  PartFile="Bentley"      Repository="Bentley" />
        <Bindings>
            <Assemblies ProductDirectoryName="RealityAssemblies">Delivery/WMSCapabilitiesNET$(shlibext)</Assemblies>
        </Bindings>

    </Part>

  
    <!-- ///////////////////////////////////////////////////////////////////////////////////// -->
    <!-- ////////////////////////////////// Products ///////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////////////////////////////// -->
    
    <ProductDirectoryList ListName="RealityModFrameworkDirList" >
        <ProductDirectory Name="PublicAPI"                  Deliver="false" />
        <ProductDirectory Name="VendorAPI"                  Deliver="false" />
        <ProductDirectory Name="Libs"                       Deliver="false" />
        <ProductDirectory Name="OracleNativeAssemblies"     Deliver="false"/>
        <ProductDirectory Name="GdalData"                   Deliver="false"/>
        <ProductDirectory Name="csmapmergemodules"          Deliver="false" />
        <ProductDirectory Name="LoggingManagedAssemblies"   Deliver="false"/>

         <!--notices/ review if notices need to be delivered--> 
        <ProductDirectory Name="VendorNotices"   Deliver="false"    LibType="dynamic"   Path="notices"/>
        <ProductDirectory Name="VendorNotices"   Deliver="false"    LibType="static"    Path="notices"/>

        <ProductDirectory   Name="PublicAPI"                    LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="VendorAPI"                    LibType="Static"    Deliver="false" />
        <ProductDirectory   Name="libs"                         LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="BentleyNativeAssemblies"      LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="GeomNativeAssemblies"         LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="RmgrToolsNativeAssemblies"    LibType="Static"    Deliver="false"/>

        <ProductDirectory Name="RealityAssemblies"              Path=""/>
        <ProductDirectory Name="BentleyNativeAssemblies"        Path=""/>
        <ProductDirectory Name="BentleyGeometryNetAssemblies"   Path=""/>
        <ProductDirectory Name="JsonNetAssemblies"              Path=""/>
        <ProductDirectory Name="IdentityModelAssemblies"        Path=""/>
        <ProductDirectory Name="ImagePPAssemblies"              Path=""/>
        <ProductDirectory Name="PlatformTechAssemblies"         Path=""/>
        <ProductDirectory Name="RmgrToolsNativeAssemblies"      Path=""/>
        <ProductDirectory Name="AdobeAssemblies"                Path="" Deliver="false"/>
        <ProductDirectory Name="AdobeResource"                  Path="System/Data/PDFL" RelativeTo="AdobeAssemblies"  Deliver="false"/>
        <ProductDirectory Name="PPNativeAssemblies"             Path="" />
        <ProductDirectory Name="PdfLibInitNativeAssemblies"     Path="" />
        <ProductDirectory Name="GeomNativeAssemblies"           Path="" />
        <ProductDirectory Name="GeoCoordData"                   Path="GeoCoordinateData" />
        <ProductDirectory Name="GeoCoordNativeAssemblies"       Path="" />
        <ProductDirectory Name="MrSidAssemblies"                Path="" />
        <ProductDirectory Name="ErdasEcwJpeg2000Assemblies"     Path="" />
        <ProductDirectory Name="ECObjectsNativeAssemblies"      Path="" />
        <ProductDirectory Name="ECObjectsManagedAssemblies"     Path="" />
        <ProductDirectory Name="ECServicesManagedAssemblies"    Path=""/>
        <ProductDirectory Name="ECSchemas"                      Path="ECSchemas" />
        <ProductDirectory Name="BeOpenSSLAssemblies"            Path="" />
        <ProductDirectory Name="BeCurlAssemblies"               Path="" />

        <ProductDirectory Name="GeomNativeAssemblies"           Path=""/>
        <ProductDirectory Name="PointoolsAssemblies"            Path=""/>
        <ProductDirectory Name="PointoolsAssemblies32Ext"       Path="Pointools32Ext" RelativeTo="PointoolsAssemblies"/>

        <ProductDirectory Name="LoggingNativeAssemblies"        Path=""/>
        <ProductDirectory Name="ApplicationInstallRoot"         Path="InstallRealityDbECPlugin"      RelativeTo="RealityAssemblies"/>
    </ProductDirectoryList>

	
    <Product Name="RealityModFramework">
        <SubPart PartName="Reality-Examples"/>
        <SubProduct ProductName="Reality-Tests"/>
        <Directories DirectoryListName="RealityModFrameworkDirList" />
    </Product>

</BuildContext>

<!--
To build the tests
bb –sRealityModFramework.Dev b

To run the tests:
bb -rRealityModFramework -pRealityModFramework:RunGtest b

To re-run the tests:
bb -rRealityModFramework -pRealityModFramework:RunGtest re RunGtest

To run under the debugger run the exe that you see in %OutRoot%Winx64\Product\Reality-Gtest
-->
