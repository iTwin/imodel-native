<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd" >

<!-- ///////////////////////////////////////////////////////////////////////////////////// -->
<!-- ///////////////////// Runtime Parts ///////////////////////////////////////////////// -->
<!-- / This section contains parts that make the ECF Runtime ///////////////////////////// -->
<!-- ///////////////////////////////////////////////////////////////////////////////////// -->

    <Part Name="Logging" ExcludeLibType="Static" ExcludePlatforms="MacOS*"> <!-- Trim off dynamic-only parts here so we don't have to download the (non-existant) partfiles) -->
        <SubPart PartName="LoggingNative"   PartFile="LoggingSDK"                           Repository="loggingsdk" /> 
    </Part>

    <!-- NOTE: Graphite uses "G" as an ApiNumber (library suffix) to disambiguate from Vancouver libraries -->
    <Part Name="ECObjectsNative" BentleyBuildMakeFile="src/ecobjects.mke" ApiNumber="G">
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="BentleyDll"      PartFile="Bentley"      Repository="Bentley" />
        <SubPart PartName="Logging" /> 
        <SubPart PartName="GeomDlls"        PartFile="geomlibs"     Repository="GeomLibs" />
        <SubPart PartName="GeomlibsSerialization" PartFile="geomlibs" Repository="GeomLibs" />
        <SubPart PartName="BeXmlDll"        PartFile="BeLibxml2"    Repository="libsrc-libxml2" />
        <SubPart PartName="StandardSchemas" PartFile="ECStandards"  Repository="ECStandards"/>
        <Bindings>
            <Libs ProductDirectoryName="ECObjectsLibs" Required="false">Delivery/$(libprefix)ECObjects$(libext)</Libs>
            <Assemblies ProductDirectoryName="ECObjectsNativeAssemblies">Delivery/$(shlibprefix)ECObjects$(ApiNumber)$(shlibext)</Assemblies>
        </Bindings>
    </Part>

    <Part Name="PublishedApi" BentleyBuildMakeFile="PublicApi/PublishAPI.mke">
        <SubPart PartName="PublicAPI" />
        <Bindings>
            <Directory SubPartDirectory="PublishedAPI/ECObjects" SourceName="Delivery/PublishedAPI" ProductDirectoryName="PublishedAPI" Required="false"/>
        </Bindings>
    </Part>

    <Part Name="PublishedApi_Doc" BentleyBuildMakeFile="PublicApi/BuildPublishedDoc.mke">
        <RequiredRepository>bsitools-doxygen</RequiredRepository>
        <SubPart PartName="PublishedApi" />
        <Bindings>
            <Files ProductDirectoryName="PublishedApi_Doc" IfNotPresent="Warn" Required="false">Delivery/ECObjectsAPI.chm</Files>
        </Bindings>
    </Part>

    <!-- Bind my own PublicAPI into BuildContext/PublicAPI. Note that this part does not cause any sub-part PublicAPIs to be bound. -->
    <Part Name="PublicAPI" BentleyBuildMakeFile="ecobjects.prewire.mke">
        <Bindings>
            <PublicAPI Domain="ECObjects" />
            <PublicAPI Domain="ECPresentation" />
            <PublicAPI Domain="ECPresentationRules" />
            <PublicAPI Domain="ECUnits" />
        </Bindings>
    </Part>

    <!-- This part enables the ECObjects unit tests to be built into the set of unit tests that run on multiple platforms. -->

    <Part Name="ECObjectsTestsBasicDependencies">
        <SubPart PartName="google_gtest_lib"     PartFile="gtest"                   Repository="util-gtest" />
        <SubPart PartName="StandardSchemas"      PartFile="ECStandards"             Repository="ECStandards"/>
        <SubPart PartName="ECObjectsNative" />
    </Part>

    <Part Name="ECObjectsUnitTests" BentleyBuildMakeFile="../bsicommon/sharedmki/BuildPlatformUnitTests.mke" BMakeOptions="-dBEGTEST_INPUT=$(SrcRoot)ECObjects/test/ -dBEGTEST_NAME=ECObjects -dBEGTEST_DEPENDENCIES=$(SrcRoot)ECObjects/test/SeedData.prewire.mke">
        <SubPart PartName="ECObjectsTestsDependencies"/>
        <SubPart PartName="PublishedApi"/>
    </Part>

    <!-- The following parts build the stand-alone ECObjects unit tests (from the same unit test source). -->

    <Part Name="ECObjectsTestsSeedData" BentleyBuildMakeFile="test/SeedData.prewire.mke">
        <Bindings>
            <Files SubPartDirectory="SeedData" ProductDirectoryName="ECObjectsTestSeedData">Delivery/SeedData/*xml</Files>
            <Files SubPartDirectory="SeedData/ur-PK" ProductDirectoryName="ECObjectsTestSeedDataPK">Delivery/SeedData/ur-PK/*xml</Files>
            <Files SubPartDirectory="SeedData/en-GB" ProductDirectoryName="ECObjectsTestSeedDataGB">Delivery/SeedData/en-GB/*xml</Files>
            <Files SubPartDirectory="SeedData/it" ProductDirectoryName="ECObjectsTestSeedDataIT">Delivery/SeedData/it/*xml</Files>
        </Bindings>
    </Part>

    <Part Name="ECObjectsTestLoggingConfig" BentleyBuildMakeFile="test/LoggingConfig.prewire.mke" ExcludePlatforms="Android*,Linux*,iOS*">
        <Bindings>
            <Files ProductDirectoryName="ECObjectsTestExe">Delivery/logging.config.xml</Files>
        </Bindings>
    </Part>

    <Part Name="ECObjectsTestsDependencies">
        <SubPart PartName="GeomlibsSerialization" PartFile="geomlibs" Repository="GeomLibs" />
        <SubPart PartName="ECObjectsTestsBasicDependencies"/>
        <SubPart PartName="ECObjectsTestsSeedData"/>
        <SubPart PartName="Logging" />
        <SubPart PartName="ECObjectsTestLoggingConfig"/>
    </Part>

    <Part Name="ECObjectsPublishedTests" BentleyBuildMakeFile="test/PublishedTests.mke" ExcludePlatforms="Android*,Linux*,iOS*">
        <SubPart PartName="ECObjectsNonPublishedTests"/>
        <SubPart PartName="ECObjectsTestsDependencies"/>
        <SubPart PartName="PublishedApi"/>
        <Bindings>
            <Files ProductDirectoryName="ECObjectsTestExe">Delivery/ECObjectsTest_Published.exe</Files>
        </Bindings>
    </Part>

    <Part Name="ECObjectsNonPublishedTests" BentleyBuildMakeFile="test/NonPublishedTests.mke" ExcludePlatforms="Android*,Linux*,iOS*">
        <SubPart PartName="ECObjectsTestsDependencies"/>
        <Bindings>
            <Files ProductDirectoryName="ECObjectsTestExe">Delivery/ECObjectsTest_NonPublished.exe</Files>
        </Bindings>
    </Part>

    <Part Name="ECObjectsScenarioTests" BentleyBuildMakeFile="test\scenarioTests.mke" ExcludePlatforms="Android*,Linux*,iOS*">
        <SubPart PartName="ECObjectsTestsDependencies"/>
        <SubPart PartName="PublishedApi"/>
        <Bindings>
            <Files ProductDirectoryName="ECObjectsTestExe">Delivery\ECObjectsTest_Scenario.exe</Files>
        </Bindings>
    </Part>
    
    <Part Name="ECObjectsNonPublishedScenarioTests" BentleyBuildMakeFile="test\nonPublishedScenarioTests.mke" ExcludePlatforms="Android*,Linux*,iOS*">
        <SubPart PartName="ECObjectsTestsDependencies"/>
        <Bindings>
            <Files ProductDirectoryName="ECObjectsTestExe">Delivery\ECObjectsTest_NonPublishedScenario.exe</Files>
        </Bindings>
    </Part>


    <Part Name="ECObjectsPerformanceTests" BentleyBuildMakeFile="test\PerformanceTests.mke" ExcludePlatforms="Android*,Linux*,iOS*">
      <SubPart PartName="ECObjectsTestsDependencies"/>
      <SubPart PartName="PublishedApi"/>
      <Bindings>
        <Files ProductDirectoryName="ECObjectsTestExe">Delivery\ECObjectsTest_Performance.exe</Files>
      </Bindings>
    </Part>

    <Part Name="Tests">
        <SubPart PartName="ECObjectsPublishedTests" />
        <SubPart PartName="ECObjectsNonPublishedTests" />
        <SubPart PartName="ECObjectsPerformanceTests" />
        <SubPart PartName="ECObjectsScenarioTests" />
        <SubPart PartName="ECObjectsNonPublishedScenarioTests" />
    </Part>

    <Part Name="RunECObjectsTests" BentleyBuildMakeFile="test/ECObjectsNativeTest.run.mke" ExcludePlatforms="Android*,Linux*,iOS*">
        <SubPart PartName="Tests" />
    </Part>

    <Part Name="RunECObjectsPerformanceTests" BentleyBuildMakeFile="test/ECObjectsPerformanceTest.run.mke">
        <SubPart PartName="ECObjectsPerformanceTests" />
    </Part>

  <Product Name="ECObjectsStatic"> <!-- Only here to avoid putting directory list on ECObjectsTested -->
      <SubPart PartName="ECObjectsNative"  LibType="Static"/>
      <Directories DirectoryListName="ECObjects" />
  </Product>
  <!-- ///////////////////////////////////////////////////////////////////////////////////// -->
<!-- ////////////////////////////////// Products ///////////////////////////////////////// -->
<!-- ///////////////////////////////////////////////////////////////////////////////////// -->

    <ProductDirectoryList ListName="ECObjects">
        <ProductDirectory Name="PublicAPI"                          Deliver="false"/>
        <ProductDirectory Name="VendorAPI"                          Deliver="false" />
        <ProductDirectory Name="VendorNotices"                      Deliver="false" />
        <ProductDirectory Name="LoggingWorkspaceData"               Deliver="false"/>
        <ProductDirectory Name="LoggingManagedAssemblies"           Deliver="false"/>
        <ProductDirectory Name="LoggingOptionalManagedAssemblies"   Deliver="false"/>
        <ProductDirectory Name="mergemodules"                       Deliver="false"/>
        <ProductDirectory Name="libs"                               Deliver="false"/>

        <ProductDirectory   Name="PublicAPI"                    LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="VendorAPI"                    LibType="Static"    Deliver="false" />
        <ProductDirectory   Name="VendorNotices"                LibType="Static"    Deliver="false" />
        <ProductDirectory   Name="libs"                         LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="BentleyNativeAssemblies"      LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="GeomNativeAssemblies"         LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="RmgrToolsNativeAssemblies"    LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="ecobjectsnativeassemblies"    LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="ecschemas"                    LibType="Static"    Deliver="false"/>

        <ProductDirectory Name="loggingnativeassemblies"            Path="Runtime"/>
        <ProductDirectory Name="LoggingOptionalNativeAssemblies"    Path="Runtime"/>
        <ProductDirectory Name="BentleyNativeAssemblies"            Path="Runtime"/>
        <ProductDirectory Name="GeomNativeAssemblies"               Path="Runtime"/>
        <ProductDirectory Name="ecobjectsnativeassemblies"          Path="Runtime"/>
        <ProductDirectory Name="PublishedApi"                       Path="Include"/>        
        <ProductDirectory Name="PublishedApi_Doc"                   Path="Docs"/>
        <ProductDirectory Name="ecschemas"                          Path="Runtime"/>
        <ProductDirectory Name="VendorNotices"                      Path="Notices"/>
        <ProductDirectory Name="VendorNotices"                      Path="Notices" LibType="Static"/>
    </ProductDirectoryList>

    <Product Name="ECObjects">
        <SubPart PartName="ECObjectsNative"/>
        <SubPart PartName="PublishedApi_Doc" />
        <Directories DirectoryListName="ECObjects"/>
    </Product>

    <ProductDirectoryList ListName="ECObjectsTest">
        <ProductDirectory Name="VendorAPI"                          Deliver="false"/>
        <ProductDirectory Name="VendorNotices"                      Deliver="false"/>
        <ProductDirectory Name="PublicAPI"                          Deliver="false"/>
        <ProductDirectory Name="LoggingWorkspaceData"               Deliver="false"/>
        <ProductDirectory Name="LoggingManagedAssemblies"           Deliver="false"/>
        <ProductDirectory Name="LoggingOptionalManagedAssemblies"   Deliver="false"/>
        <ProductDirectory Name="mergemodules"                       Deliver="false"/>
        <ProductDirectory Name="libs"                               Deliver="false"/>

        <ProductDirectory Name="PublicAPI"      LibType="Static"    Deliver="false"/>
        <ProductDirectory Name="VendorAPI"      LibType="Static"    Deliver="false"/>
        <ProductDirectory Name="VendorNotices"  LibType="Static"    Deliver="false"/>
        <ProductDirectory Name="libs"           LibType="Static"    Deliver="false"/>

        <ProductDirectory Name="ECObjectsTestSeedData"              Path="SeedData"/>
        <ProductDirectory Name="ECObjectsTestSeedDataPK"            Path="SeedData/ur-PK"/>
        <ProductDirectory Name="ECObjectsTestSeedDataGB"            Path="SeedData/en-GB"/>
        <ProductDirectory Name="ECObjectsTestSeedDataIT"            Path="SeedData/it"/>
        <ProductDirectory Name="ECObjectsTestLoggingConfig"         Path=""/>

        <ProductDirectory Name="geomnativeassemblies"               Path=""/>
        <ProductDirectory Name="loggingnativeassemblies"            Path=""/>
        <ProductDirectory Name="LoggingOptionalNativeAssemblies"    Path="" />
        <ProductDirectory Name="BentleyNativeAssemblies"            Path=""/>
        <ProductDirectory Name="ECObjectsNativeAssemblies"          Path=""/>
        <ProductDirectory Name="ECObjectsTestExe"                   Path=""/>
        <ProductDirectory Name="ecschemas"                          Path=""/>
    </ProductDirectoryList>

    <Product Name="ECObjectsTests" SaveProduct="true">
        <SubPart PartName="Tests"/>
        <Directories DirectoryListName="ECObjectsTest"/>
    </Product>

    <ProductDirectoryList ListName="ECObjectsTested">
    </ProductDirectoryList>
    <Product Name="ECObjectsTested" PrgOutputDir="ECObjects" SaveProduct="true" AddIn="true">
        <SubProduct ProductName="ECObjects" />
        <!-- SubProduct ProductName="ECObjectsStatic" /-->
        <SubProduct ProductName="ECObjectsTests" />
        <SubPart PartName="RunECObjectsTests" />
        <Directories DirectoryListName="ECObjectsTested"/>
    </Product>

</BuildContext>
