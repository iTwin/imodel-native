<?xml version="1.0" encoding="utf-8"?>
<BuildContext
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd"
    >

    <!-- ======================================================================================================================================== -->
    <!-- == PUBLIC ============================================================================================================================== -->
    <!-- ======================================================================================================================================== -->

    <Part Name="iModelCorePRG" PrgOutputDir="iModelCore">
        <SubPart PartName="__iModelCorePRG-Dynamic"/>
        <SubPart PartName="__iModelCorePRG-Static"/>
    </Part>
    
    <!--
        iModelCore needs to include at least the platform SubParts required for the
        iModelJsNodeAddon. See iModelJsNodeAddon:iModelJsNodeAddonLibCommon.
     -->
    <Part Name="iModelCore">
        <SubPart PartName="DgnPlatformDLL" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="ECPresentation" PartFile="iModelCore/ECPresentation/ECPresentation" Repository="imodel02"/>
        <SubPart PartName="ECObjectsNative" PartFile="iModelCore/ecobjects/ECObjects" Repository="imodel02"/>
        <SubPart PartName="iModelCoreSqlang" PartFile="iModelCore/iModelCoreL10N" Repository="imodel02"/>
        <SubPart PartName="Licensing" PartFile="iModelCore/LicensingCrossPlatform/LicensingCrossPlatform" Repository="imodel02" />
    </Part>

    <Part Name="RunUnitTests" DeferType="RunUnitTests">
        <SubPart PartName="RunUnitGTest" PartFile="iModelCore/iModelCoreTesting" Repository="imodel02"/>
        <SubPart PartName="RunUnitJUnit" PartFile="iModelCore/iModelCoreTesting" Repository="imodel02"/>
        <SubPart PartName="RunUnitXCTest" PartFile="iModelCore/iModelCoreTesting" Repository="imodel02"/>
        <SubPart PartName="RunUnitCppTest" PartFile="iModelCore/iModelCoreTesting" Repository="imodel02"/>
    </Part>

    <NuGetProduct Name="iModelCoreNuget" Description="iModel Core SDK" OnlyPlatforms="x64,linux*,macos*">
        <Directories DirectoryListName="iModelCoreNugetDirs"/>
        <SubPart PartName="iModelCore"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
    </NuGetProduct>

    <ProductDirectoryList ListName="iModelCoreNugetDirs">
        <ProductDirectory Name="Root" Path="native"/>

        <ProductDirectory Name="Assemblies"                                 RelativeTo="Root" Path="bin"/>
        <ProductDirectory Name="Assemblies"             LibType="Static"    Deliver="false"/>
        <ProductDirectory Name="Assets"                                     RelativeTo="Root" Path="assets"/>
        <ProductDirectory Name="Assets"                 LibType="Static"    RelativeTo="Root" Path="assets"/>
        <ProductDirectory Name="BeHttpXliffs"                               RelativeTo="Root" Path="xliffs"/>
        <ProductDirectory Name="BeHttpXliffs"           LibType="Static"    RelativeTo="Root" Path="xliffs"/>
        <ProductDirectory Name="DgnPlatformXliffs"                          RelativeTo="Root" Path="xliffs"/>
        <ProductDirectory Name="DgnPlatformXliffs"      LibType="Static"    RelativeTo="Root" Path="xliffs"/>
        <ProductDirectory Name="ECPresentationXliffs"                       RelativeTo="Root" Path="xliffs"/>
        <ProductDirectory Name="ECPresentationXliffs"   LibType="Static"    RelativeTo="Root" Path="xliffs"/>
        <ProductDirectory Name="Libs"                                       RelativeTo="Root" Path="lib"/>
        <ProductDirectory Name="Libs"                   LibType="Static"    RelativeTo="Root" Path="lib"/>
        <ProductDirectory Name="PublicApi"                                  RelativeTo="Root" Path="include"/>
        <ProductDirectory Name="PublicApi"              LibType="Static"    RelativeTo="Root" Path="include"/>
        <ProductDirectory Name="VendorApi"                                  RelativeTo="Root" Path="include"/>
        <ProductDirectory Name="VendorApi"              LibType="Static"    RelativeTo="Root" Path="include"/>
        <ProductDirectory Name="VendorNotices"                              RelativeTo="Root" Path="notices"/>
        <ProductDirectory Name="VendorNotices"          LibType="Static"    RelativeTo="Root" Path="notices"/>
        <ProductDirectory Name="WSClientXliffs"                             RelativeTo="Root" Path="xliffs"/>
        <ProductDirectory Name="WSClientXliffs"         LibType="Static"    RelativeTo="Root" Path="xliffs"/>

    </ProductDirectoryList>

    <NuGetProduct Name="iModelCoreTestingNuget" Description="iModel Core Testing SDK" OnlyPlatforms="x64,linux*,macos*">
        <Directories DirectoryListName="iModelCoreTestingNugetDirs"/>
        <SubPart PartName="Gtest-Tools" PartFile="iModelCore/BeGTest/BeGTest"/>
        <SubPart PartName="UnitTestSchemas" PartFile="iModelCore/DgnPlatform/DgnPlatform"/>
    </NuGetProduct>

    <ProductDirectoryList ListName="iModelCoreTestingNugetDirs">
        <ProductDirectory Name="Root" Path="native"/>

        <ProductDirectory Name="Assemblies"                         RelativeTo="Root" Path="bin"/>
        <ProductDirectory Name="Assemblies"     LibType="Static"    Deliver="false"/>
        <ProductDirectory Name="Assets"                             RelativeTo="Root" Path="assets"/>
        <ProductDirectory Name="Assets"         LibType="Static"    RelativeTo="Root" Path="assets"/>
        <ProductDirectory Name="Libs"                               RelativeTo="Root" Path="lib"/>
        <ProductDirectory Name="Libs"           LibType="Static"    RelativeTo="Root" Path="lib"/>
        <ProductDirectory Name="PublicApi"                          RelativeTo="Root" Path="include"/>
        <ProductDirectory Name="PublicApi"      LibType="Static"    RelativeTo="Root" Path="include"/>
        <ProductDirectory Name="UnitTestAssets"                     RelativeTo="Root" Path="data"/>
        <ProductDirectory Name="UnitTestAssets" LibType="Static"    RelativeTo="Root" Path="data"/>
        <ProductDirectory Name="UnitTestLibs"                       RelativeTo="Root" Path="lib"/>
        <ProductDirectory Name="UnitTestLibs"   LibType="Static"    RelativeTo="Root" Path="lib"/>
        <ProductDirectory Name="VendorApi"                          RelativeTo="Root" Path="include"/>
        <ProductDirectory Name="VendorApi"      LibType="Static"    RelativeTo="Root" Path="include"/>
        <ProductDirectory Name="VendorNotices"                      RelativeTo="Root" Path="notices"/>
        <ProductDirectory Name="VendorNotices"  LibType="Static"    RelativeTo="Root" Path="notices"/>
    </ProductDirectoryList>

    <!-- ======================================================================================================================================== -->
    <!-- == PRIVATE ============================================================================================================================= -->
    <!-- ======================================================================================================================================== -->

    <Part Name="__iModelCorePRG-Dynamic" OnlyPlatforms="x64,winrt*">
        <SubPart PartName="iModelCore" LibType="Dynamic"/>
        <SubPart PartName="RunUnitTests" LibType="Dynamic"/>
        <SubPart PartName="__ParasiteSubParts" LibType="Dynamic"/>
        <SubNuGetProduct NuGetProductName="iModelCoreNuget"/>
        <SubNuGetProduct NuGetProductName="iModelCoreTestingNuget"/>
    </Part>

    <Part Name="__iModelCorePRG-Static" OnlyPlatforms="android*,ios*,macos*,linux*">
        <SubPart PartName="iModelCore" LibType="Static"/>
        <SubPart PartName="RunUnitTests" LibType="Static"/>
        <SubPart PartName="__ParasiteSubParts" LibType="Static"/>
        <SubNuGetProduct NuGetProductName="iModelCoreNuget" LibType="Static"/>
        <SubNuGetProduct NuGetProductName="iModelCoreTestingNuget" LibType="Static"/>
    </Part>

    <!--
        These are "parasites" because they aren't strictly required for the this library
        library itself. However, they may be required for its non-library parts of the build (e.g.
        testing, which we'd normally exclude from our build), or for other downstream builds
        pulling LKGs.
    -->
    <Part Name="__ParasiteSubParts">
        <!-- Testing -->
        <!-- .................................................................................. -->
        <SubPart PartName="__ParasiteSubParts_Gtest"/>
        <SubPart PartName="__ParasiteSubParts_JUnit"/>
        <SubPart PartName="__ParasiteSubParts_XCTest"/>
        <SubPart PartName="__ParasiteSubParts_CppTest"/>

        <SubPart PartName="__ParasiteSubParts_DcsX64Parts"/>
    </Part>
    
    <Part Name="__ParasiteSubParts_Gtest" OnlyPlatforms="x64,macos*,linux*">
        <SubPart PartName="Gtest-Tools" PartFile="iModelCore/BeGTest/BeGTest" Repository="imodel02"/>
        <SubPart PartName="google_gmock_lib" PartFile="iModelCore/util/gmock/gmock" Repository="imodel02"/>
        <SubPart PartName="google_gtest_lib" PartFile="iModelCore/util/gtest/gtest" Repository="imodel02"/>
    </Part>

    <Part Name="__ParasiteSubParts_JUnit" OnlyPlatforms="android*">
        <SubPart PartName="AndroidJUnitTest-Tools" PartFile="iModelCore/BeGTest/BeGTest" Repository="imodel02"/>
    </Part>

    <Part Name="__ParasiteSubParts_XCTest" OnlyPlatforms="ios*">
        <SubPart PartName="iOSXCTest-Tools" PartFile="iModelCore/BeGTest/BeGTest" Repository="imodel02"/>
    </Part>

    <Part Name="__ParasiteSubParts_CppTest" OnlyPlatforms="winrt*">
        <SubPart PartName="UwpTest-Tools" PartFile="iModelCore/BeGTest/BeGTest" Repository="imodel02"/>
    </Part>

    <Part Name="__ParasiteSubParts_DcsX64Parts" OnlyPlatforms="x64">
        <SubProduct ProductName="IModelExtractor" PartFile="iModelCore/BeSQLite/IModelExtractor" Repository="imodel02"/>
        <SubProduct ProductName="iModelConsole" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
    </Part>

</BuildContext>
