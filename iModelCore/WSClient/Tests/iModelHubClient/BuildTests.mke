#---------------------------------------------------------------------------------------------
#  Copyright (c) Bentley Systems, Incorporated. All rights reserved.
#  See COPYRIGHT.md in the repository root for full copyright notice.
#---------------------------------------------------------------------------------------------
%include mdl.mki

%ifndef TestDir
    %error must define TestDir
%endif

baseDir = $(_MakeFilePath)

tempInclude = $(baseDir)BackDoor/PublicAPI/BackDoor/WebServices/iModelHub/
cIncs + -I$(tempInclude)

PlatformLib = $(BuildContext)SubParts/Libs/
cIncs + -I$(PlatformLib)

PlatformAPI = $(BuildContext)PublicAPI/
cIncs + -I$(PlatformAPI)

PlatformVendorAPI = $(BuildContext)VendorAPI/
cIncs + -I$(PlatformVendorAPI)

# Compile and Link the unit tests
BEGTEST_NAME  = $(TestDir)iModelHub
BEGTEST_INPUT = $(baseDir)$(TestDir)/
BEGTEST_IGNORE= $(baseDir)ignore_list.txt
BEGTEST_OUTPUT=$(OutputRootDir)build/iModelHubNativeTests/
o = $(BEGTEST_OUTPUT)$(BEGTEST_NAME)/

#--------------------------------------------------------------------------------------
#   Set variable if build crash tests
#--------------------------------------------------------------------------------------
%if defined (ENABLE_IMODELHUB_CRASH_TESTS)
    nameToDefine    = ENABLE_IMODELHUB_CRASH_TESTS
    %include cdefapnd.mki
%endif

#--------------------------------------------------------------------------------------
#   Building tests
#--------------------------------------------------------------------------------------
%include $(SrcRoot)bsicommon/sharedmki/DetectAndCompileUnitTests.mki

# Deliver 
$(BuildContext)Delivery/iModelHubNativeTests/IntegrationTests.json : $(baseDir)Integration/IntegrationTests.json
    $(LinkFirstDepToFirstTarget)

$(BuildContext)Delivery/iModelHubNativeTests/PerformanceTests.json : $(baseDir)Integration/PerformanceTests.json
    $(LinkFirstDepToFirstTarget)

$(BuildContext)Delivery/iModelHubNativeTests/DgnPlatformTest.ecschema.xml : $(baseDir)ECSchemas/DgnPlatformTest.ecschema.xml
    $(LinkFirstDepToFirstTarget)

$(BuildContext)Delivery/iModelHubNativeTests/SchemaVersionTest.02.02.02.ecschema.xml : $(baseDir)ECSchemas/SchemaVersionTest.02.02.02.ecschema.xml
    $(LinkFirstDepToFirstTarget)

$(BuildContext)Delivery/iModelHubNativeTests/Objects/$(TestDir) : ${o}
    $(LinkFirstDepToFirstTargetAsDirectory)

$(BuildContext)Delivery/iModelHubNativeTests/ignore_list_dev.txt : $(baseDir)ignore_list_dev.txt
    $(LinkFirstDepToFirstTarget)

$(BuildContext)Delivery/iModelHubNativeTests/ignore_list_qa.txt : $(baseDir)ignore_list_qa.txt
    $(LinkFirstDepToFirstTarget)
