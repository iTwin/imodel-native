#--------------------------------------------------------------------------------
# PLEASE keep this file structurized and add new issues to specific sections:
# KNOWN, BREAKAGES, RANDOM, NEW
#--------------------------------------------------------------------------------

#--------------------------------------------------------------------------------
# KNOWN issues
#--------------------------------------------------------------------------------
# Tests that fail for know reasons and require larger fixes
*_KnownIssue*

#--------------------------------------------------------------------------------
# RANDOM reproduceable crashes/hangs that break DEV builds
#--------------------------------------------------------------------------------

#--------------------------------------------------------------------------------
# RANDOM crashes/hangs on PRG/FIREBUG (usually can be ran on DEV x64 builds with no problems)
#--------------------------------------------------------------------------------

UrlProviderTests.GetUrl_ValidateAllGetters
    # TFS#862962
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Date: 03/14/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Configuration\UrlProviderTests.cpp(103): error: Actual function call count doesn't match EXPECT_CALL(*client, GetUrl(_, _))...
    # Expected: to be called once
    # Actual: never called - unsatisfied and active
    # Can not reproduce. Also, test is expecting 17 calls count and it was never expecting called once.

UrlProviderTests.GetPunchlistWsgUrl_LocalStateHasOldUrlStoredAsString_IgnoresOldUrlAndCallsBuddi
    # bim0200, x64, NDEBUG
    # Also dgndb61-16q4, x64, NDEBUG, PRG
    # [ RUN      ] UrlProviderTests.GetPunchlistWsgUrl_LocalStateHasOldUrlStoredAsString_IgnoresOldUrlAndCallsBuddi
    # F:\Bim0200\src\WSClient\Tests\UnitTests\Published\WebServices\Configuration\UrlProviderTests.cpp(87): error: Actual function call count doesn't match EXPECT_CALL(*client, GetUrl(_, _))...
    #          Expected: to be called once
    #            Actual: never called - unsatisfied and active
    #
    # GMOCK WARNING:
    # Uninteresting mock function call - taking default action specified at:
    # F:\Bim0200\src\WSClient\Tests\UnitTests\Published\WebServices\Configuration\UrlProviderTests.cpp(130):
    #     Function call: _GetValue(00007FFCFB8A20D8 pointing to "UrlCache", 00007FFCFB8A20C8 pointing to "Environment")
    #           Returns: "null"
    # NOTE: You can safely ignore the above warning unless this call should not happen.  Do not suppress it by blindly adding an EXPECT_CALL() if you don't mean to enforce the call.  See https://github.com/google/googletest/blob/master/googlemock/docs/CookBook.md#knowing-when-to-expect for details.
    #
    # GMOCK WARNING:
    # Uninteresting mock function call - taking default action specified at:
    # F:\Bim0200\src\WSClient\Tests\UnitTests\Published\WebServices\Configuration\UrlProviderTests.cpp(131):
    #     Function call: _SaveValue(00007FFCFB8A20D8 pointing to "UrlCache", 00007FFCFB8A20C8 pointing to "Environment", @000000A33FF3EE40 "0
    # ")
    # NOTE: You can safely ignore the above warning unless this call should not happen.  Do not suppress it by blindly adding an EXPECT_CALL() if you don't mean to enforce the call.  See https://github.com/google/googletest/blob/master/googlemock/docs/CookBook.md#knowing-when-to-expect for details.
    # F:\Bim0200\src\WSClient\Tests\UnitTests\Published\WebServices\Configuration\UrlProviderTests.cpp(141): error: Mock function called more times than expected - taking default action specified at:
    # F:\Bim0200\src\WSClient\Tests\UnitTests\Published\WebServices\Configuration\UrlProviderTests.cpp(132):
    #     Function call: GetUrl(@0000022B5DDBFD98 "Mobile.PunchListWsg", 103)
    #           Returns: 0000022B5DFF1260
    #          Expected: to be called once
    #            Actual: called twice - over-saturated and active
    # [  FAILED  ] UrlProviderTests.GetPunchlistWsgUrl_LocalStateHasOldUrlStoredAsString_IgnoresOldUrlAndCallsBuddi (35 ms)
    # Can not reproduce the test failure, but it logs GMOCK warnings. This test never had code in line 87.

ECInstanceKeyFilterTests.FilterByClass_OneClassEmptyInput_EmptyResults
    # bim0200dev, x86, DEBUG
    # End of tests reports:
    # f:\bim0200dev\src-staging\wsclient\tests\unittests\published\webservices\client\MockWSClient.h(31): ERROR: this mock object (used in test ECInstanceKeyFilterTests.FilterByClass_OneClassEmptyInput_EmptyResults) should be deleted but never is. Its address is @080BFB7C.
    # ERROR: 1 leaked mock object found at program exit.
    # Can not reproduce, because fails to pull nuget packages with x86 architecture. I tried with WSClient build strategy. No memory leak with x64 architecture

#--------------------------------------------------------------------------------
# NEW not reviewed issues
#--------------------------------------------------------------------------------

ConnectSignInManagerTests.CheckAndUpdateToken_AfterSignInAndConfiguredTimeout_RequestsNewToken

    # TFS#821998
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Date: 02/22/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Connect\ConnectSignInManagerTests.cpp(102): error: Actual function call count doesn't match EXPECT_CALL(*imsClient, RequestToken(*token, _, _))...
    # Expected: to be called once
    # Actual: never called - unsatisfied and active

UrlProviderTests.GetUrl_ValidateAllGetters

    # TFS#862962
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Date: 03/14/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Configuration\UrlProviderTests.cpp(103): error: Actual function call count doesn't match EXPECT_CALL(*client, GetUrl(_, _))...
    # Expected: to be called once
    # Actual: never called - unsatisfied and active

DataSourceCacheTests.GetExtendedData_UpdatedDataForObject_WorksFine

    # TFS#927740
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/04/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.RemoveResponses_ResponsesWithSameName_RemovesResponses

    # TFS#927740
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/04/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.CacheResponse_ResponseContainsItsParentInstanceAndParentRootRemoved_QueryResultsAndParentDeleted

    # TFS#930240
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/12/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.CacheResponse_KeyHasDifferentHolderAndThenParentIsRemoved_RemovesResults

    # TFS#930240
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/12/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.ReadInstancesConnectedToRootMap_DifferentClassInstancesLinked_ReturnsOnlyCachedInstanceIds

    # TFS#930241
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/12/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.ReadInstancesLinkedToRoot_DifferentClassInstancesLinked_ReturnsIds

    # TFS#930241
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/12/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.FindRelationship_CachedRelationshipExists_ReturnsRelationshipObjectId

    # TFS#930241
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/12/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.ReadInstanceHierarchy_IvalidInstance_Error

    # TFS#930241
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/12/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.FindRelationship_NoRelationshipWithSuchEnds_ReturnsInvalidKey

    # TFS#930241
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/12/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.FindRelationship_RelationshipWithSuchEndsExists_ReturnsRelationshipKey

    # TFS#930241
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/12/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.FindRelationship_NoCachedRelationshipWithSuchKey_ReturnsEmptyObjectId

    # TFS#930241
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 08/12/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(302): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(303): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: C++ exception with description "DataSourceCache is not open!" thrown in the test body.

DataSourceCacheTests.UpdateSchemas_SchemaChangeListenerRegisteredAndSchemaPassed_CallsListenerBeforeAndAfterSchemaUpdate

    # VSTS#31669
    # Stream:bim0200dev, build configuration :NDEBUG, architecture: (x64), Device: Desktop, Date: 09/07/2018
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(310): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::EmptyAndRemoveDirectory(s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::FileNotFound
    # c:\build\src\mds06t\WSClient\Tests\UnitTests\Published\WebServices\Cache\Persistence\BaseCacheTest.cpp(311): error:       Expected: BeFileNameStatus::Success
    # To be equal to: BeFileName::CloneDirectory(s_seedCacheFolderPath, s_targetCacheFolderPath)
    # Which is: BeFileNameStatus::AlreadyExists
    # unknown file: error: SEH exception with code 0xc0000005 thrown in the test body.
    # *********************** STACK TRACE ************************
    # [4] _C_specific_handler (0x7ffb4bbfbff0)
    # [3] _chkstk (0x7ffb570d9ec0)
    # [2] RtlLookupFunctionEntry (0x7ffb57064710)
    # [1] KiUserExceptionDispatcher (0x7ffb570d9030)
    # [0] BentleyB0200::BeSQLite::Db::IsReadonly (0x7ffb1d75da80)

WSRepositoryClientTests.SendGetChildrenRequest_PerformedTwiceWithWebApi27_SendsAllRequestsWithDifferentMasRequestId
    # Random, NDEBUG, x64
    # [ RUN      ] WSRepositoryClientTests.SendGetChildrenRequest_PerformedTwiceWithWebApi27_SendsAllRequestsWithDifferentMasRequestId
    # D:\vsts_a\13\bbsrc\iModel02\iModelCore\WSClient\Tests\UnitTests\Published\WebServices\Client\WSRepositoryClientTests.cpp(774): error:       Expected: 2
    # To be equal to: uniqueRequestIds
    #       Which is: 1
    # [  FAILED  ] WSRepositoryClientTests.SendGetChildrenRequest_PerformedTwiceWithWebApi27_SendsAllRequestsWithDifferentMasRequestId (1 ms)

UrlProviderTests.GetPunchlistWsgUrl_TimeoutIsLessThanTimeElapsed_CallsBuddiToGetUrl
    # Random, MacOSx64, NDEBUG, https://bentleycs.visualstudio.com/iModelTechnologies/_build/results?buildId=61997&_a=summary
    # [ RUN      ] UrlProviderTests.GetPunchlistWsgUrl_TimeoutIsLessThanTimeElapsed_CallsBuddiToGetUrl
    # /Users/platform-bld/vsts_agent_a/_work/1/s/iModelCore/WSClient/Tests/UnitTests/Published/WebServices/Configuration/UrlProviderTests.cpp:139: Failure
    # Mock function called more times than expected - taking default action specified at:
    # /Users/platform-bld/vsts_agent_a/_work/1/s/iModelCore/WSClient/Tests/UnitTests/Published/WebServices/Configuration/UrlProviderTests.cpp:143:
    #     Function call: GetUrl(@0x7f88a27126d8 "Mobile.PunchListWsg", 103)
    #           Returns: 0x7f88a27124d0
    #          Expected: to be called once
    #            Actual: called twice - over-saturated and active
    # Feb  5 10:00:53  Be[26261] <Error>: WSClient: URL 'Mobile.PunchListWsg' is not configured on buddi service for region '103'. Will use fallback URL.
    # [  FAILED  ] UrlProviderTests.GetPunchlistWsgUrl_TimeoutIsLessThanTimeElapsed_CallsBuddiToGetUrl (37 ms)
