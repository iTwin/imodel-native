#----------------------------------------------------------------------------------------
#
#  $Source: Tests/UnitTests/BuildTests.mke $
#
#  $Copyright: (c) 2018 Bentley Systems, Incorporated. All rights reserved. $
#
#----------------------------------------------------------------------------------------
%include mdl.mki

%ifndef TestDir
    %error must define TestDir
%endif

baseDir = $(_MakeFilePath)

%ifdef BUILD_AGGREGATE_TESTS
    nameToDefine=BUILD_FOR_AGGREGATE_TESTS=1
    %include cdefapnd.mki
%endif

%ifdef ENABLE_DGNDBSERVER_UNIT_TESTS
    nameToDefine = DGNDBSERVER_UNIT_TESTS=1
    %include cdefapnd.mki
%endif	

# Compile and Link the unit tests
BEGTEST_NAME  = $(TestDir)WebServices
BEGTEST_INPUT = $(baseDir)$(TestDir)/
BEGTEST_IGNORE= $(baseDir)ignore_list.txt
BEGTEST_OUTPUT=$(OutputRootDir)build/WebServices/UnitTests/
o = $(BEGTEST_OUTPUT)$(BEGTEST_NAME)/

%ifdef UsePublishedApi
    BEGTEST_API = $(BuildContext)SubParts/PublishedApi/WSClient/
%endif

# When compiling under VS2017
# src\WSClient\Tests\UnitTests\Published\WebServices\Client\ActivityLoggerTests.cpp(64): warning C4840: non-portable use of class 'std::function<void (va_list)>' as an argument to a variadic function
# src\WSClient\Tests\UnitTests\Published\WebServices\Client\ActivityLoggerTests.cpp(64): note: to simplify migration, consider the temporary use of /Wv:18 flag with the version of the compiler with which you used to build without warnings

%include $(SrcRoot)bsicommon/sharedmki/DetectAndCompileUnitTests.mki

# Deliver 
$(BuildContext)Delivery/UnitTests/Objects/$(TestDir) : ${o}
    $(LinkFirstDepToFirstTargetAsDirectory)
