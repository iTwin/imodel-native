<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd"
              >

    <!-- ********************************************************************************************** -->
    <!-- BeGtest
                This produces a test runner that is a very thin wrapper around gtest. It currently
                builds and runs on Windows, Linues, and MacOS.
    -->
    <!-- ********************************************************************************************** -->

    <Product Name="BeGTest">
        <SubPart PartName="BeGTestExe" />
        <Directories DirectoryListName="BeGTestDirList" />
    </Product>

    <Product Name="BeGTestTested">
        <SubProduct ProductName="BeGTest" />
        <SubPart PartName="RunBeGTest" />
        <SubPart PartName="DisplayIgnoreList" />
        <Directories DirectoryListName="BeGTestDirList" />
    </Product>

    <Product Name="BeGTestPerformanceTested">
        <SubProduct ProductName="BeGTest" />
        <SubPart PartName="RunBeGTestPerformance" />
        <Directories DirectoryListName="BeGTestDirList" />
    </Product>

    <Part Name="RunBeGTest" BentleyBuildMakeFile="RunBeGTest.mke" ExcludePlatforms="Android*,iOS*">
        <SubProduct ProductName="BeGTest" />
    </Part>

    <Part Name="DisplayIgnoreList" BentleyBuildMakeFile="DisplayIgnoreList.mke">
        <SubPart PartName="RunBeGTest" />
    </Part>

    <Part Name="RunBeGTestPerformance" BentleyBuildMakeFile="RunBeGTest.mke" BMakeOptions="+dGTEST_FILTER=--gtest_filter=Performance*" ExcludePlatforms="Android*,iOS*">
    </Part>

    <Part Name="BeGTestExe" BentleyBuildMakeFile="BeGTestExe.mke"  BMakeOptions="+dUSE_GTEST +dBUILD_BEGTEST_GTEST_EXE" ExcludePlatforms="Android*,iOS*">
        <SubPart PartName="google_gtest_lib"                PartFile="gtest"            Repository="util-gtest" />
        <SubPart PartName="google_gmock_lib"                PartFile="gmock"            Repository="util-gmock" />
        <SubPart PartName="LoggingNative"                   PartFile="LoggingSDK"       Repository="loggingsdk" />
        <SubPart PartName="BeSQLite"            PartFile="BeSQLite"     Repository="BeSQLite" />
        <SubPart PartName="Base"/>
        <Bindings>
            <Directory ProductDirectoryName="BeGTestFiles" SourceName="Delivery"/>
        </Bindings>
    </Part>

    <Part Name="Base" BentleyBuildMakeFile="prewire.mke">
        <Bindings>
            <PublicAPI Domain="BeGTest" />
        </Bindings>
    </Part>

    <ProductDirectoryList ListName="BeGTestDirList" >
        <ProductDirectory Name="BeGTestFiles"                       Path="bin" />

        <!-- ***NEEDS WORK: We say that we don't deliver anything. But, in fact, BeGTestExe.mke symlinks all this stuff into the "bin" directory. 
                We can probably take that logic out of BeGTestExe.mke and put it here. -->
        <ProductDirectory Name="LoggingNativeAssemblies"            Deliver="false" />
        <ProductDirectory Name="LoggingOptionalNativeAssemblies"    Deliver="false" />
        <ProductDirectory Name="BentleyNativeAssemblies"            Deliver="false" />
        <ProductDirectory Name="Libs"                               Deliver="false" />
        <ProductDirectory Name="Libs"                               Deliver="false"  LibType="static"/>
        <ProductDirectory Name="PublicAPI"                          Deliver="false" />
        <ProductDirectory Name="VendorAPI"                          Deliver="false" />
        <ProductDirectory Name="VendorNotices"                      Deliver="false" />
        <ProductDirectory Name="VendorNotices"                      Deliver="false"  LibType="static"/>
        <ProductDirectory Name="DgnViewDecorators"                  Deliver="false" />
        <ProductDirectory Name="PPNativeAssemblies"                 Deliver="false" />
        <ProductDirectory Name="MobileDgnSdkIncludeDirectory"       Deliver="false" />
        <ProductDirectory Name="DgnPlatformNativeAssemblies"        Deliver="false" />
        <ProductDirectory Name="GeomNativeAssemblies"               Deliver="false" />
        <ProductDirectory Name="ECSchemas"                          Deliver="false" />
        <ProductDirectory Name="ECObjectsNativeAssemblies"          Deliver="false" />
        <ProductDirectory Name="ECObjectsTestSeedData"              Deliver="false" />
        <ProductDirectory Name="ECObjectsTestExe"                   Deliver="false" />
        <ProductDirectory Name="BeOpenSSLAssemblies"                Deliver="false" />
        <ProductDirectory Name="BeCurlAssemblies"                   Deliver="false" />
        <ProductDirectory Name="RmgrToolsNativeAssemblies"          Deliver="false" />
        <ProductDirectory Name="DgnPlatformLastResortFonts"         Deliver="false" />
        <ProductDirectory Name="DgnPlatformFont"                    Deliver="false" />
        <ProductDirectory Name="MdlsysAsneededSmartsolid"           Deliver="false" />
        <ProductDirectory Name="SmartSolidAssemblies"               Deliver="false" />
        <ProductDirectory Name="ECSchemas"                          Deliver="false" />
        <ProductDirectory Name="GeoCoordNativeAssemblies"           Deliver="false" />
        <ProductDirectory Name="sqlang"                             Deliver="false" />
        <ProductDirectory Name="CordovaLibs"                        Deliver="false" />
        <ProductDirectory Name="StdThemes"                          Deliver="false" />
        <ProductDirectory Name="MobileDgnJavaScript"                Deliver="false" />
        <ProductDirectory Name="MobileDgnJavaScriptIcons"           Deliver="false" />
        <ProductDirectory Name="MobileDgnNativeAssemblies"          Deliver="false" />
        <ProductDirectory Name="WSClientAssemblies"                 Deliver="false" />

    </ProductDirectoryList>

    <!-- ********************************************************************************************** -->
    <!-- BeGTestStaticLib
                This produces a static library that includes all of the unit tests as well as
                the libraries they require. This all-in-one static library is used by some test
                runners such as BeTestiOS to simplify their link statements.
    -->
    <!-- ********************************************************************************************** -->

    <Part Name="BeGTestStaticLib" BentleyBuildMakeFile="BeGTestStaticLib.mke">
        <Bindings>
            <Libs Required="false" ProductDirectoryName="BeGTestStaticLib">Delivery/$(stlibprefix)BeGTestStatic$(stlibext)</Libs>
        </Bindings>
    </Part>

  <!-- ********************************************************************************************** -->
  <!-- UnitTestsDll
                This produces a DLL that includes all of the unit tests. This is used to deliver
		the unit tests to test runners on platforms such as BeTestWinRT to simplify their link statements.
    -->
  <!-- ********************************************************************************************** -->

  <Part Name="UnitTestsDll" BentleyBuildMakeFile="UnitTestsDll.mke">
    <Bindings>
      <Libs ProductDirectoryName="UnitTestsLib" Required="false">Delivery/$(libprefix)UnitTests$(libext)</Libs>
      <Assemblies ProductDirectoryName="UnitTestsDll">Delivery/$(shlibprefix)UnitTests$(shlibext)</Assemblies>
    </Bindings>
  </Part>

  <!-- ********************************************************************************************** -->
    <!-- BeTestDocuments                                                                                -->
    <!-- ********************************************************************************************** -->

    <Product Name="BeTestDocuments" PrgOutputDir="MobileDgnSdk">
        <Directories DirectoryListName="BeTestDocumentsDirList" />
        <SubPart PartName="DgnV8Converter"/>
        <SubPart PartName="LinkDgnDbPublisherIntoToolContext" LibType="Dynamic"/>
        <SubPart PartName="UnitTests_Documents" LibType="Static"    PartFile="ECDb" Repository="ECDb" />
    </Product>

    <Part Name="DgnV8Converter" OnlyPlatforms="x64,x86">
        <SubProduct ProductName="DgnV8Converter" PartFile="DgnDbSync" Repository="DgnDbSync"/>
    </Part>

    <Part Name="LinkDgnDbPublisherIntoToolContext" BentleyBuildMakeFile="LinkDgnDbPublisherIntoToolContext.mke" OnlyPlatforms="x64,x86">
        <SubPart PartName="DgnV8Converter" LibType="Dynamic"/>
    </Part>

    <ProductDirectoryList ListName="BeTestDocumentsDirList">
        <ProductDirectory Name="UnitTests_Documents_DgnDb"          Path="DgnDb" Deliver="true"/>
        <ProductDirectory Name="UnitTests_Documents_DgnDb"          Path="DgnDb" Deliver="true" LibType="Static"/>
    </ProductDirectoryList>

    <Part Name="UnitTests-Documents" BentleyBuildMakeFile="DeliverBeTestDocuments.mke">
        <SubProduct ProductName="BeTestDocuments"/>
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Documents-DgnDb" SourceName="Delivery/UnitTests/Documents"/>
        </Bindings>
    </Part>

    <!-- ********************************************************************************************** -->
    <!-- Common unit tests part for all platforms                                                     -->
    <!-- ********************************************************************************************** -->

    <Part Name="PlatformUnitTests">
        <SubPart PartName="PlatformUnitTests-Windows" />
        <SubPart PartName="PlatformUnitTests-Static" />
    </Part>

    <Part Name="PlatformUnitTests-Windows" OnlyPlatforms="x86,x64,WinRT*,Linux*,MacOS*">
        <SubPart    PartName="PlatformUnitTests-Windows-No-View" />
        <SubPart    PartName="MobileDgnUnitTests"       PartFile="MobileDgn"            Repository="MobileDgn" />
    </Part>

    <Part Name="PlatformUnitTests-Static" ExcludePlatforms="x86,x64,WinRT*,Linux*,MacOS*">
        <SubPart    PartName="PlatformUnitTests-Static-No-View" />
        <SubPart    PartName="MobileDgnUnitTests"       PartFile="MobileDgn"            Repository="MobileDgn"              LibType="Static" />
    </Part>

    <Part Name="PlatformUnitTests-No-View">
        <SubPart PartName="PlatformUnitTests-Windows-No-View" />
        <SubPart PartName="PlatformUnitTests-Static-No-View" />
    </Part>

    <Part Name="PlatformUnitTests-Windows-No-View" OnlyPlatforms="x86,x64,WinRT*,Linux*,MacOS*">
        <SubPart    PartName="BentleyUnitTests"         PartFile="Bentley"              Repository="Bentley" />
        <SubPart    PartName="ECObjectsUnitTests"       PartFile="ecobjects"            Repository="ecobjects" />
        <SubPart    PartName="GeomLibsUnitTests"        PartFile="geomlibs"             Repository="GeomLibs" />
        <SubPart    PartName="BeSQLiteUnitTests"        PartFile="BeSQLite"             Repository="BeSQLite" />
        <SubPart    PartName="ECDbUnitTests"            PartFile="ECDb"                 Repository="ECDb" />
        <SubPart    PartName="DgnProjectUnitTests"      PartFile="DgnPlatform"          Repository="DgnPlatform" />
        <SubPart    PartName="DgnDisplayUnitTests"      PartFile="DgnDisplay"           Repository="DgnDisplay" />
        <SubPart    PartName="PlanningUnitTests"        PartFile="Planning"             Repository="DgnDomains-Planning"/>
        <SubPart    PartName="WSClientUnitTests"        PartFile="WSClient"             Repository="WSClient" />
        <SubPart    PartName="ConstructionSchemaUnitTests"  PartFile="ConstructionSchema"   Repository="ConstructionSchema" />
    </Part>

    <Part Name="PlatformUnitTests-Static-No-View" ExcludePlatforms="x86,x64,WinRT*,Linux*,MacOS*">
        <SubPart    PartName="BentleyUnitTests"         PartFile="Bentley"              Repository="Bentley"                LibType="Static" />
        <SubPart    PartName="ECObjectsUnitTests"       PartFile="ecobjects"            Repository="ecobjects"              LibType="Static" />
        <SubPart    PartName="GeomLibsUnitTests"        PartFile="geomlibs"             Repository="GeomLibs"               LibType="Static" />
        <SubPart    PartName="BeSQLiteUnitTests"        PartFile="BeSQLite"             Repository="BeSQLite"               LibType="Static" />
        <SubPart    PartName="ECDbUnitTests"            PartFile="ECDb"                 Repository="ECDb"                   LibType="Static" />
        <SubPart    PartName="DgnProjectUnitTests"      PartFile="DgnPlatform"          Repository="DgnPlatform"            LibType="Static" />
        <SubPart    PartName="DgnDisplayUnitTests"      PartFile="DgnDisplay"           Repository="DgnDisplay"             LibType="Static" />
        <SubPart    PartName="PlanningUnitTests"        PartFile="Planning"             Repository="DgnDomains-Planning"    LibType="Static" />
        <SubPart    PartName="WSClientUnitTests"        PartFile="WSClient"             Repository="WSClient"               LibType="Static" />
        <SubPart    PartName="ConstructionSchemaUnitTests"  PartFile="ConstructionSchema"   Repository="ConstructionSchema"     LibType="Static" />
    </Part>

    <!-- ********************************************************************************************** -->
    <!-- Common test builder part for all platforms                                                     -->
    <!-- ********************************************************************************************** -->

    <Part Name="BeGTestCommon">
        <SubPart PartName="BeGTest-Windows" />
        <SubPart PartName="BeGTest-Android" />
        <SubPart PartName="BeGTest-iOS" />
        <SubPart PartName="BeGTest-WinRT" />
        <SubPart PartName="BeGTest-Linux" />
        <SubPart PartName="BeGTest-MacOS" />
    </Part>

    <Part Name="BeGTest-Windows" OnlyPlatforms="x86,x64">
        <SubProduct ProductName="BeGTestTested" />
    </Part>

    <Part Name="BeGTest-Android" OnlyPlatforms="Android*">
        <SubProduct ProductName="BeTestAndroid" PartFile="BeTestAndroid" Repository="BeTestAndroid" />
    </Part>

    <Part Name="BeGTest-iOS" OnlyPlatforms="iOS*">
        <SubProduct ProductName="BeTestiOS" PartFile="BeTestiOS" Repository="BeTestiOS" />
    </Part>

    <Part Name="BeGTest-WinRT" OnlyPlatforms="WinRT*">
        <SubProduct ProductName="BeTestWinRT" PartFile="BeTestWinRT" Repository="BeTestWinRT" />
    </Part>

    <Part Name="BeGTest-Linux" OnlyPlatforms="Linux*">
        <SubProduct ProductName="BeGTestTested" />
    </Part>

    <Part Name="BeGTest-MacOS" OnlyPlatforms="MacOS*">
        <SubProduct ProductName="BeGTestTested" />
    </Part>

    <!-- *********************************************************************************************** -->
    <!-- ProductDirectory that can be used by any material product based on mobiledgn -->
    <!-- *********************************************************************************************** -->
    <ProductDirectoryList ListName="BeGTest-Material">
        <ProductDirectory Name="BentleyNativeAssemblies"            Path="Assemblies"/>
        <ProductDirectory Name="LoggingNativeAssemblies"            Path="Assemblies"/>
        <ProductDirectory Name="GeomNativeAssemblies"               Path="Assemblies"/>
        <ProductDirectory Name="BeOpenSSLAssemblies"                Path="Assemblies"/>
        <ProductDirectory Name="DgnPlatformNativeAssemblies"        Path="Assemblies"/>
        <ProductDirectory Name="BeCurlAssemblies"                   Path="Assemblies"/>
        <ProductDirectory Name="ECObjectsNativeAssemblies"          Path="Assemblies"/>
        <ProductDirectory Name="GeoCoordNativeAssemblies"           Path="Assemblies"/>
        <ProductDirectory Name="PPNativeAssemblies"                 Path="Assemblies"/>
        <ProductDirectory Name="MdlsysAsneededSmartsolid"           Path="Assemblies"/>
        <ProductDirectory Name="SmartSolidAssemblies"               Path="Assemblies"/>
        <ProductDirectory Name="Libs"                               Path="Libs"/>
        <ProductDirectory Name="BentleyLibs"                        Path="Libs"/>
        <ProductDirectory Name="UnitTests-Objects"                  Path="Objects"/>
        <ProductDirectory Name="UnitTests-Assets"                   Path="Assets"/>
        <ProductDirectory Name="UnitTests-IgnoreList"               Path="Assets/Ignore"/>
        <ProductDirectory Name="UnitTests-Documents-DgnDb"          Path="Assets/BeTestDocuments/DgnDb"/>
        <ProductDirectory Name="ECSchemas"                          Path="Assets"/>
        <ProductDirectory Name="sqlang"                             Path="Assets/sqlang/platform"/>
        <ProductDirectory Name="DgnPlatformFont"                    Path="Assets/fonts"/>
        <ProductDirectory Name="DgnPlatformLastResortFonts"         Path="Assets"/>
        <ProductDirectory Name="BeIcu4cData"                        Path="Assets"/>
        <ProductDirectory Name="BeIcu4cData"                        Path="Assets" LibType="static"/>
        <ProductDirectory Name="GeoCoordData"                       Path="Assets/DgnGeoCoord"/>
        <ProductDirectory Name="GeoCoordDataMinimal"                Path="Assets/DgnGeoCoord"/>

        <ProductDirectory Name="DgnViewDecorators" Deliver="false"/>
        <ProductDirectory Name="RmgrToolsNativeAssemblies" Deliver="false"/>
        <ProductDirectory Name="PublicAPI" Deliver="false"/>
        <ProductDirectory Name="VendorAPI" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" LibType="static" />
        <ProductDirectory Name="Libs" Deliver="false" LibType="static"/>
    </ProductDirectoryList>


    <!-- *********************************************************************************************** -->
    <!-- Subpart needed by all gtest-based test-runner EXE parts -->
    <!-- *********************************************************************************************** -->
    <Part Name="Gtest-ExeSupport" ExcludePlatforms="Android*,iOS*">
        <SubPart PartName="google_gtest_lib"    PartFile="gtest"        Repository="util-gtest" />
        <SubPart PartName="google_gmock_lib"    PartFile="gmock"        Repository="util-gmock" />
        <SubPart PartName="LoggingNative"       PartFile="LoggingSDK"   Repository="loggingsdk" />
        <SubPart PartName="BeSQLite"            PartFile="BeSQLite"     Repository="BeSQLite" />
        <SubPart PartName="Base"/>
    </Part>

    <!-- *********************************************************************************************** -->
    <!-- ProductDirectory used by all gtest-based test-runner products -->
    <!-- *********************************************************************************************** -->
    <ProductDirectoryList ListName="Gtest-GtestRunner">
        <ProductDirectory Name="Gtest-NativeAssemblies" Path=""/>
        <ProductDirectory Name="BentleyNativeAssemblies" Path=""/>
        <ProductDirectory Name="LoggingNativeAssemblies" Path=""/>
        <ProductDirectory Name="Gtest-DgnPlatformAssetsDirectory" Path="DgnPlatformAssetsDirectory"/>

        <!-- 
        <ProductDirectory Name="UnitTests-Objects" Deliver="false"/>
        <ProductDirectory Name="UnitTests-IgnoreList" Deliver="false"/>
        -->
        <ProductDirectory Name="Libs" Deliver="false"/>
        <ProductDirectory Name="Libs" Deliver="false" LibType="static"/>
        <ProductDirectory Name="PublicAPI" Deliver="false"/>
        <ProductDirectory Name="VendorAPI" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" LibType="static" />
    </ProductDirectoryList>

</BuildContext>
