<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd"
              >

    <Part Name="Base">
    </Part>

    <!-- ********************************************************************************************** -->
    <!-- BeTestDocuments                                                                                -->
    <!-- ********************************************************************************************** -->

    <!-- TRICKY 
        Unit tests depend on documents as follows:
        1. Unit test parts depend on UnitTests-Documents.
        2. UnitTests-Documents depends on BeTestDocuments (which is in ECDb).
        3. BeTestDocuments depends on GetBeTestDocuments.
        The reason to have this chain of dependencies is that "BeTestDocuments" is an LKG in some builds. 
        We only execute the GetBeTestDocuments part on platforms where we can run the converter.
        -->
    <Part Name="UnitTests-Documents" BentleyBuildMakeFile="DeliverBeTestDocuments.mke">
        <SubProduct ProductName="BeTestDocuments" Repository="ECDb" PartFile="ECDb"/>
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Documents-DgnDb" SourceName="Delivery/UnitTests/Documents"/>
        </Bindings>
    </Part>

    <!-- TRICKY: Even though documents are only actually converted for x64,x86, we must do other processing for other platforms and other cases. Therefore, no platforms can be excluded! -->
    <Part Name="GetBeTestDocuments" BentleyBuildMakeFile="${SrcBsiCommon}sharedmki/PublishDocuments.mke" BMakeOptions="-dUNIT_TESTS_NAME=ECDbUnitTests -dUNIT_TESTS_DOCUMENTS_DIR=${SrcRoot}/DgnPlatformTest/DgnDbUnitTests/ -dUNIT_TESTS_DOCUMENTS_PREBUILTS_SUBDIR=DgnDb -dUNIT_TESTS_PUBLISH_CONFIG=${SrcRoot}/BeGTest/UnitTestPublisherConfiguration.xml">
        <!-- *** NEEDS WORK: Why are we using UnitTestPublisherConfiguration.xml? Shouldn't we be using UnitTestDgnV8ConverterConfiguration.xml? Or, why do we have two config files? There's only one converter! -->
        <SubPart PartName="LinkToDgnDbUnitTestsData"/>
        <SubPart PartName="LinkDgnV8ConverterIntoToolContext"/>
        <Bindings>
            <Directory SourceName="Delivery/UnitTests/Documents" SubPartDirectory="Documents/DgnDb" ProductDirectoryName="UnitTests_Documents_DgnDb" />
        </Bindings>
    </Part>

    <Part Name="LinkToDgnDbUnitTestsData" OnlyPlatforms="x64,x86">
        <RequiredRepository>DgnDbUnitTestsData</RequiredRepository>
    </Part>

    <Part Name="LinkDgnV8ConverterIntoToolContext" BentleyBuildMakeFile="LinkDgnDbPublisherIntoToolContext.mke" OnlyPlatforms="x64,x86">
        <SubProduct ProductName="DgnV8Converter" PartFile="DgnDbSync" Repository="DgnDbSync"/>
    </Part>

    <!-- *********************************************************************************************** -->
    <!-- This ProductDirectory can be used by any portable unit test product based on mobiledgn. -->
    <!-- This is also an example of how to layout the directory structure for any BeGTest product. -->
    <!-- *********************************************************************************************** -->
    <ProductDirectoryList ListName="MobileDgnTestsProduct">
        <ProductDirectory Name="BentleyNativeAssemblies"            Path="Assemblies"/>
        <ProductDirectory Name="LoggingNativeAssemblies"            Path="Assemblies"/>
        <ProductDirectory Name="GeomNativeAssemblies"               Path="Assemblies"/>
        <ProductDirectory Name="BeOpenSSLAssemblies"                Path="Assemblies"/>
        <ProductDirectory Name="DgnPlatformNativeAssemblies"        Path="Assemblies"/>
        <ProductDirectory Name="BeCurlAssemblies"                   Path="Assemblies"/>
        <ProductDirectory Name="ECObjectsNativeAssemblies"          Path="Assemblies"/>
        <ProductDirectory Name="GeoCoordNativeAssemblies"           Path="Assemblies"/>
        <ProductDirectory Name="PPNativeAssemblies"                 Path="Assemblies"/>
        <ProductDirectory Name="MdlsysAsneededSmartsolid"           Path="Assemblies"/>
        <ProductDirectory Name="SmartSolidAssemblies"               Path="Assemblies"/>
        <ProductDirectory Name="BePortableUiAssemblies"             Path="Assemblies"/>
        <ProductDirectory Name="CordovaLibs"                        Path="Assemblies"/>
        <ProductDirectory Name="MobileDgnNativeAssemblies"          Path="Assemblies"/>

        <ProductDirectory Name="Libs"                               Path="Libs"/>
        <ProductDirectory Name="BentleyLibs"                        Path="Libs"/>
        <ProductDirectory Name="UnitTests-Objects"                  Path="Objects"/>
        <ProductDirectory Name="UnitTests-Assets"                   Path="Assets"/>
        <ProductDirectory Name="UnitTests-IgnoreList"               Path="Assets/Ignore"/>
        <ProductDirectory Name="UnitTests-Documents-DgnDb"          Path="Assets/BeTestDocuments/DgnDb"/>
        <ProductDirectory Name="ECSchemas"                          Path="Assets"/>
        <ProductDirectory Name="DgnPlatformSqlang"                  Path="Assets/sqlang"/>
        <ProductDirectory Name="sqlang"                             Path="Assets/sqlang/platform"/>
        <ProductDirectory Name="DgnPlatformFont"                    Path="Assets/fonts"/>
        <ProductDirectory Name="DgnPlatformLastResortFonts"         Path="Assets"/>
        <ProductDirectory Name="BeIcu4cData"                        Path="Assets"/>
        <ProductDirectory Name="BeIcu4cData"                        Path="Assets" LibType="static"/>
        <ProductDirectory Name="GeoCoordData"                       Path="Assets/DgnGeoCoord"/>
        <ProductDirectory Name="GeoCoordDataMinimal"                Path="Assets/DgnGeoCoord"/>
        <ProductDirectory Name="MobileDgnSdkSeedFiles"              Path="Assets/seed"/>

        <ProductDirectory Name="http"                               Path="Assets/http"/>

        <ProductDirectory Name="MobileDgnJavaScript"                Path="Assets/js/"/>
        <ProductDirectory Name="MobileDgnJavaScriptViewGroups"      Path="Assets/js/ViewGroups"/>
        <ProductDirectory Name="MobileDgnJavaScriptIcons"           Path="Assets/js/resources/icons"/>
        <ProductDirectory Name="StdThemes"                          Path="Assets/std-themes"/>

        <ProductDirectory Name="MobileDgnSdkIncludeDirectory" Deliver="false"/>
        <ProductDirectory Name="DgnViewDecorators" Deliver="false"/>
        <ProductDirectory Name="RmgrToolsNativeAssemblies" Deliver="false"/>
        <ProductDirectory Name="PublicAPI" Deliver="false"/>
        <ProductDirectory Name="VendorAPI" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" LibType="static" />
        <ProductDirectory Name="Libs" Deliver="false" LibType="static"/>
    </ProductDirectoryList>

    <!-- *********************************************************************************************** -->
    <!-- This part should be used by any part that wants to build and/or run a gtest EXE -->
    <!-- *********************************************************************************************** -->
    <Part Name="Gtest-Tools" BentleyBuildMakeFile="prewire.mke" ExcludePlatforms="Android*,iOS*">
        <SubPart PartName="google_gtest_lib"    PartFile="gtest"        Repository="util-gtest" />
        <SubPart PartName="google_gmock_lib"    PartFile="gmock"        Repository="util-gmock" />
        <SubPart PartName="LoggingNative"       PartFile="LoggingSDK"   Repository="loggingsdk" />
        <SubPart PartName="BeSQLite"            PartFile="BeSQLite"     Repository="BeSQLite" />
        <Bindings>
            <PublicAPI Domain="BeGTest" />
            <Files Required="false" SubPartDirectory="Gtest-Tools">Delivery/buildGtest.mke</Files>
            <Files Required="false" SubPartDirectory="Gtest-Tools">Delivery/BeGTestExe.cpp</Files>
            <Files Required="false" SubPartDirectory="Gtest-Tools">Delivery/logging.config.xml</Files>
            <Files Required="false" SubPartDirectory="Gtest-Tools">Delivery/RunGtest.mke</Files>
            <Files Required="false" SubPartDirectory="Gtest-Tools">Delivery/RunTests.py</Files>
        </Bindings>
    </Part>

    <!-- *********************************************************************************************** -->
    <!-- ProductDirectory used by all gtest EXE products -->
    <!-- *********************************************************************************************** -->
    <ProductDirectoryList ListName="Gtest-GtestRunner">
        <ProductDirectory Name="Gtest-NativeAssemblies" Path=""/>
        <ProductDirectory Name="BentleyNativeAssemblies" Path=""/>
        <ProductDirectory Name="LoggingNativeAssemblies" Path=""/>
        <ProductDirectory Name="Gtest-DgnPlatformAssetsDirectory" Path="DgnPlatformAssetsDirectory"/>

        <!-- 
        <ProductDirectory Name="UnitTests-Objects" Deliver="false"/>
        <ProductDirectory Name="UnitTests-IgnoreList" Deliver="false"/>
        -->
        <ProductDirectory Name="Libs" Deliver="false"/>
        <ProductDirectory Name="Libs" Deliver="false" LibType="static"/>
        <ProductDirectory Name="PublicAPI" Deliver="false"/>
        <ProductDirectory Name="VendorAPI" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" LibType="static" />
    </ProductDirectoryList>

</BuildContext>
