<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">

    <!-- Bind my own PublicAPI and VendorAPI into BuildContext. Note that this part does not cause any sub-part PublicAPIs to be bound. Also deliver my notices. -->
    <Part Name="PublicAPI" BentleyBuildMakeFile="BeSQLite.prewire.mke">
        <Bindings>
            <PublicAPI Domain="BeSQLite" />
            <Files ProductDirectoryName="VendorNotices" Required="true">Delivery/sqlite-notice.txt</Files>
            <Files ProductDirectoryName="VendorNotices" Required="true">Delivery/snappy-notice.txt</Files>
        </Bindings>
    </Part>

    <!-- NOTE: Graphite uses "G" as an ApiNumber (library suffix) to disambiguate from Vancouver libraries -->
    <Part Name="BeSQLite" BentleyBuildMakeFile="BeSQLite.mke" ApiNumber="G">
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="BentleyDll" PartFile="Bentley" Repository="Bentley" />
        <SubPart PartName="Zlib" PartFile="Zlib" Repository="Libsrc-Compress" />
        <Bindings>
            <Libs>Delivery/$(libprefix)BeSQLite$(libext)</Libs>
            <Assemblies ProductDirectoryName="BentleyNativeAssemblies">Delivery/$(libprefix)BeSQLite$(ApiNumber)$(shlibext)</Assemblies>
        </Bindings>
    </Part>

    <!-- TRICKY: There are two sets of public APIs, BeSQLite and ECDb. There is only one published API for this repository, and it must do for both. 
         To avoid that we run the publishing twice this part cares for it and symlinks the same published API once under the name of BeSQLite and
         once under the name of ECDb-->
    <Part Name="PublishedApi" BentleyBuildMakeFile="${SrcBsiCommon}sharedmki/PublishApi.mke" BMakeOptions="+dPUBLISHAPI_DELIVERY_DIR=Delivery/PublishedApi">
        <Bindings>
            <Directory SourceName="Delivery/PublishedApi"  SubPartDirectory="PublishedApi/BeSQLite"/>
        </Bindings>
    </Part>

    <Part Name="BeSQLiteUnitTests" BentleyBuildMakeFile="../bsicommon/sharedmki/BuildPlatformUnitTests.mke" BMakeOptions="-dBEGTEST_INPUT=$(SrcRoot)BeSQLite/Tests/ -dBEGTEST_NAME=BeSQLite">
        <!-- Get GTest API directory -->
        <SubPart    PartName="google_gtest_lib"     PartFile="gtest"        Repository="util-gtest" />
        <!-- Get the tested API -->
        <SubPart    PartName="BeSQLite"             PartFile="BeSQLite"     Repository="BeSQLite" />
        <!-- Needed for published unit tests -->
        <SubPart    PartName="PublishedApi"         PartFile="BeSQLite"     Repository="BeSQLite" />
    </Part>

    <!-- Allow dependent tests to #include <UnitTests/BackDoor/PerformanceTestingHelper/PerformanceTestingHelpers.h> -->
    <Part Name="PerformanceTestingHelpers" BentleyBuildMakeFile="Tests/Prewire.mke">
        <Bindings>
            <Files Required="false" SubPartDirectory="UnitTests/include/UnitTests/BackDoor/PerformanceTestingHelper">Delivery/UnitTests/PerformanceTestingHelpers.h</Files>
        </Bindings>
    </Part>

    <Part Name="UnitTestsBase" BentleyBuildMakeFile="Tests/Prewire.mke">
        <SubPart PartName="BeSQLite"/>
        <Bindings>
            <Files ProductDirectoryName="UnitTestsIgnoreList" ProductSubDirectory="BeSQLite">Delivery/UnitTests/ignore_list.txt</Files>
        </Bindings>
    </Part>

    <Part Name="UnitTestsNonPublished" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=NonPublished">
        <SubPart PartName="UnitTestsBase" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTestsLinkables" ProductSubDirectory="BeSQLite/NonPublished" SourceName="Delivery/UnitTests/Linkables/NonPublished"/>
        </Bindings>
    </Part>

    <Part Name="UnitTestsPerformance" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Performance">
        <SubPart PartName="UnitTestsBase" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTestsLinkables" ProductSubDirectory="BeSQLite/Performance" SourceName="Delivery/UnitTests/Linkables/Performance"/>
        </Bindings>
    </Part>

    <Part Name="UnitTestsPublished" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Published -dUsePublishedApi">
        <SubPart PartName="UnitTestsBase" />
        <SubPart PartName="PublishedApi" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTestsLinkables"    ProductSubDirectory="BeSQLite/Published" SourceName="Delivery/UnitTests/Linkables/Published"/>
        </Bindings>
    </Part>

</BuildContext>
