<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">

    <!-- Bind my own PublicAPI and VendorAPI into BuildContext. Note that this part does not cause any sub-part PublicAPIs to be bound. Also deliver my notices. -->
    <Part Name="PublicAPI" BentleyBuildMakeFile="BeSQLite.prewire.mke">
        <Bindings>
            <PublicAPI Domain="BeSQLite" />
            <Files ProductDirectoryName="VendorNotices" Required="true">Delivery/sqlite-notice.txt</Files>
            <Files ProductDirectoryName="VendorNotices" Required="true">Delivery/snappy-notice.txt</Files>
        </Bindings>
    </Part>

    <!-- NOTE: Graphite uses "G" as an ApiNumber (library suffix) to disambiguate from Vancouver libraries -->
    <Part Name="BeSQLite" BentleyBuildMakeFile="BeSQLite.mke" ApiNumber="G">
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="BentleyDll" PartFile="Bentley" Repository="Bentley" />
        <SubPart PartName="Zlib" PartFile="Zlib" Repository="Libsrc-Compress" />
        <Bindings>
            <Libs>Delivery/$(libprefix)BeSQLite$(libext)</Libs>
            <Assemblies ProductDirectoryName="BentleyNativeAssemblies">Delivery/$(libprefix)BeSQLite$(ApiNumber)$(shlibext)</Assemblies>
        </Bindings>
    </Part>

    <!-- TRICKY: There are two sets of public APIs, BeSQLite and ECDb. There is only one published API for this repository, and it must do for both. 
         To avoid that we run the publishing twice this part cares for it and symlinks the same published API once under the name of BeSQLite and
         once under the name of ECDb-->
    <Part Name="PublishedApi" BentleyBuildMakeFile="${SrcBsiCommon}sharedmki/PublishApi.mke" BMakeOptions="+dPUBLISHAPI_DELIVERY_DIR=Delivery/PublishedApi">
        <SubPart PartName="PublicAPI" />
        <Bindings>
            <Directory SourceName="Delivery/PublishedApi"  SubPartDirectory="PublishedApi/BeSQLite"/>
        </Bindings>
    </Part>

    <!-- ******************************** Unit Tests ************************************** -->

    <!-- Allow dependent tests to #include <UnitTests/BackDoor/PerformanceTestingHelper/PerformanceTestingHelpers.h> -->
    <Part Name="PerformanceTestingHelpers" BentleyBuildMakeFile="Tests/Prewire.mke">
        <Bindings>
            <Files Required="false" SubPartDirectory="UnitTests/include/UnitTests/BackDoor/PerformanceTestingHelper">Delivery/UnitTests/PerformanceTestingHelpers.h</Files>
        </Bindings>
    </Part>

    <Part Name="PrewireForUnitTests" BentleyBuildMakeFile="Tests/Prewire.mke">
        <SubPart PartName="UnitTests-Documents-DgnDb" Repository="BeGTest" PartFile="BeGTest"/>
        <SubPart PartName="BeSQLite"/>
        <Bindings>
            <Files ProductDirectoryName="UnitTests-IgnoreList" ProductSubDirectory="BeSQLite" SubPartDirectory="UnitTests/BeSQLite">Delivery/UnitTests/ignore_list.txt</Files>
        </Bindings>
    </Part>

    <Part Name="UnitTests-NonPublished" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=NonPublished">
        <SubPart PartName="PrewireForUnitTests" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects" ProductSubDirectory="BeSQLite/NonPublished" SourceName="Delivery/UnitTests/Objects/NonPublished"/>
        </Bindings>
    </Part>

    <Part Name="UnitTests-Performance" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Performance">
        <SubPart PartName="PrewireForUnitTests" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects" ProductSubDirectory="BeSQLite/Performance" SourceName="Delivery/UnitTests/Objects/Performance"/>
        </Bindings>
    </Part>

    <Part Name="UnitTests-Published" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Published -dUsePublishedApi">
        <SubPart PartName="PrewireForUnitTests" />
        <SubPart PartName="PublishedApi" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"  ProductSubDirectory="BeSQLite/Published" SourceName="Delivery/UnitTests/Objects/Published"/>
        </Bindings>
    </Part>

    <!-- Define a test collection part. This is included in MobileDgn's NonGtest-TestCollection-Aggregate -->
    <Part Name="Tests">
        <SubPart PartName="UnitTests-NonPublished"/>
        <SubPart PartName="UnitTests-Published"/>
    </Part>

    <!-- Define a gtest program to run the tests. The Gtest and RunGtest parts are included in MobileDgn's Gtest-Aggregator and RunGtest-MobileDgnTests parts -->
    <Product Name="BeSQLite-Tests">
        <SubPart Repository="BeGTest" PartFile="BeGTest" PartName="Base" />
        <SubPart PartName="Tests"/>
        <Directories DirectoryListName="CollectionProduct" Repository="BeGTest"  PartFile="BeGTest"/>
    </Product>

    <Part Name="Gtest" BentleyBuildMakeFile="${SrcRoot}BeGTest/gtest/buildGTest.mke" BentleyBuildMakeOptions="-dTEST_NAME=BeSQLiteTest -dTEST_COLLECTION_PRODUCT=BeSQLite-Tests" OnlyPlatforms="x86,x64,Linux*,MacOS*">
        <SubProduct ProductName="BeSQLite-Tests"/>
        <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
        <Bindings>
            <Files ProductDirectoryName="Gtest-NativeAssemblies">Delivery/Gtest/BeSQLiteTest/Assemblies/*</Files>
            <Directory ProductDirectoryName="Gtest-Assets" SourceName="Delivery/Gtest/BeSQLiteTest/Assets" />
        </Bindings>
    </Part>

    <Product Name="BeSQLite-Gtest" >
        <SubPart PartName="Gtest"/>
        <Directories DirectoryListName="GtestProduct" Repository="BeGTest" PartFile="BeGTest"/>
    </Product>

    <Part Name="RunGtest" BentleyBuildMakeFile="${SrcRoot}BeGTest/gtest/RunGTest.mke" BentleyBuildMakeOptions="-dGTEST_EXE=$(OutputRootDir)Product/BeSQLite-Gtest/BeSQLiteTest -dGTEST_OUTPUT_DIR=$(OutputRootDir)build/BeSQLite" OnlyPlatforms="x86,x64,MacOs*,Linux*">
        <SubProduct ProductName="BeSQLite-Gtest" />
        <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
    </Part>

</BuildContext>
