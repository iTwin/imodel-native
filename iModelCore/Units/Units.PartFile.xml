<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd" >

<!-- ///////////////////////////////////////////////////////////////////////////////////// -->
<!-- ///////////////////// Runtime Parts ///////////////////////////////////////////////// -->
<!-- / This section contains parts that make the UNITS Runtime ///////////////////////////// -->
<!-- ///////////////////////////////////////////////////////////////////////////////////// -->

    <Part Name="Logging" ExcludeLibType="Static" ExcludePlatforms="MacOS*,WinRT*"> <!-- Trim off dynamic-only parts here so we don't have to download the (non-existant) partfiles) -->
        <SubPart PartName="LoggingNative"   PartFile="LoggingSDK"                           Repository="loggingsdk" /> 
    </Part>

    <!-- NOTE: Graphite uses "G" as an ApiNumber (library suffix) to disambiguate from Vancouver libraries -->
    <Part Name="UnitsDll" BentleyBuildMakeFile="Units.mke" ApiNumber="B02">
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="BentleyDll"      PartFile="Bentley"      Repository="Bentley" />
        <SubPart PartName="BeJsonCpp"       PartFile="BeJsonCpp"    Repository="Libsrc-JsonCpp"/>
        <SubPart PartName="BeSQLite" PartFile="BeSQLite" Repository="BeSQLite" />
        <SubPart PartName="Units-Xliffs" />
        <SubPart PartName="Logging" />
        <Bindings>
            <Libs>Delivery/$(libprefix)Units$(libext)</Libs>
            <Assemblies>Delivery/$(shlibprefix)Units$(ApiNumber)$(shlibext)</Assemblies>
        </Bindings>
    </Part>

  <!-- Why don't we just rename 'UnitsDll' to 'UnitsNative'? Do we plan to have a managed wrapper? -->
  <Part Name="UnitsNative">
    <SubPart PartName="UnitsDll" />
  </Part>

  <!-- Bind my own PublicAPI into BuildContext/PublicAPI. Note that this part does not cause any sub-part PublicAPIs to be bound. -->
    <Part Name="PublicAPI" BentleyBuildMakeFile="Units.Prewire.mke">
        <Bindings>
            <PublicAPI Domain="Units" />
            <PublicAPI Domain="Formatting" />
        </Bindings>
    </Part>

  <Part Name="UnitsConversionData" BentleyBuildMakeFile="tests/ConversionData.prewire.mke">
    <Bindings>
      <Files SubPartDirectory="ConversionData" ProductDirectoryName="UnitTests-Assets" ProductSubDirectory="ConversionData"> Delivery/ConversionData/*csv </Files>
    </Bindings>
  </Part>

  <!-- ///////////////////////////////////////////////////////////////////////////////////// -->
<!-- ////////////////////////////////// Products ///////////////////////////////////////// -->
<!-- ///////////////////////////////////////////////////////////////////////////////////// -->

  <!-- Cross-platform test part and product definitions -->
  <!-- Only/ExcludePlatforms attributes should NOT be used in this section -->

  <ProductDirectoryList ListName="UnitsTested" >
        <ProductDirectory Name="PublicAPI"                          Deliver="false"/>
        <ProductDirectory Name="VendorAPI"                          Deliver="false" />
        <ProductDirectory Name="VendorNotices"                      Deliver="false" />
        <ProductDirectory Name="LoggingWorkspaceData"               Deliver="false"/>
        <ProductDirectory Name="LoggingOptionalManagedAssemblies"   Deliver="false"/>
        <ProductDirectory Name="libs"                               Deliver="false"/>

        <ProductDirectory   Name="PublicAPI"                    LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="VendorAPI"                    LibType="Static"    Deliver="false" />
        <ProductDirectory   Name="VendorNotices"                LibType="Static"    Deliver="false" />
        <ProductDirectory   Name="libs"                         LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="Assemblies"      LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="UnitsNativeAssemblies"        LibType="Static"    Deliver="false"/>

        <ProductDirectory Name="LoggingOptionalNativeAssemblies"    Path="Runtime"/>
        <ProductDirectory Name="Assemblies"            Path="Runtime"/>
        <ProductDirectory Name="UnitsNativeAssemblies"              Path="Runtime"/>
        <ProductDirectory Name="PublishedApi"                       Path="Include"/>
        <ProductDirectory Name="PublishedApi_Doc"                   Path="Docs"/>
        <ProductDirectory Name="VendorNotices"                      Path="Notices"/>
    </ProductDirectoryList>


    <Product Name="UnitsTested" PrgOutputDir="Units" SaveProduct="true" AddIn="true">
        <SubPart PartName="RunGtest" />
        <SubPart PartName="RunAndroidJUnitTest" />
        <SubPart PartName="RuniOSXCTest" />
        <Directories DirectoryListName="UnitsTested"/>
    </Product>
    
    <Product Name="Units-Tests">
        <SubPart Repository="BeGTest" PartFile="BeGTest" PartName="Base" />
        <SubPart PartName="Tests"/>
        <Directories DirectoryListName="CollectionProduct" Repository="BeGTest"  PartFile="BeGTest"/>
    </Product>
    
	<Part Name="UnitTests-NonPublished" DeferType="BuildUnitTests" BentleyBuildMakeFile="tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=NonPublished">
        <SubPart PartName="TestDependencies"/>
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects" ProductSubDirectory="Units/NonPublished" SourceName="Delivery/UnitTests/Objects/NonPublished"/>
        </Bindings>
    </Part>
	
    <Part Name="Tests" DeferType="BuildUnitTests">
		<SubPart PartName="UnitTests-NonPublished" />
    </Part>

    <Part Name="TestDependencies" DeferType="BuildUnitTests" BentleyBuildMakeFile="tests/Prewire.mke">
        <SubPart PartName="UnitsNative" />
        <SubPart PartName="UnitsConversionData" />
        <Bindings>
            <Files ProductDirectoryName="UnitTests-IgnoreList"     ProductSubDirectory="Units" SubPartDirectory="UnitTests/Units">Delivery/UnitTests/ignore_list.txt</Files>
        </Bindings>
    </Part>

  <!-- Platform-specific test parts and products -->
  <!-- Only/ExcludePlatforms attributes should be used only in this section -->

  <!-- *** GTEST - runs on Windows, Linux, MaxOS *** -->
  <Part Name="RunGtest" DeferType="RunUnitTests" BentleyBuildMakeFile="${SrcRoot}BeGTest/gtest/RunGtest.mke" BentleyBuildMakeOptions="-dGTEST_PRODUCT=Units-Gtest -dGTEST_NAME=UnitsTest" OnlyPlatforms="x86,x64,MacOs*,Linux*">
    <SubProduct ProductName="Units-Gtest" />
    <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
    <Bindings>
      <Files Required="false" SubPartDirectory="Gtest/Logs">Delivery/Gtest/Logs/UnitsTest.log</Files>
    </Bindings>
  </Part>

  <Product Name="Units-Gtest" >
    <SubPart PartName="Gtest"/>
    <Directories DirectoryListName="GtestProduct" Repository="BeGTest" PartFile="BeGTest"/>
  </Product>

  <Part Name="Gtest" DeferType="BuildUnitTests" BentleyBuildMakeFile="${SrcRoot}BeGTest/gtest/buildGtest.mke" BentleyBuildMakeOptions="-dTEST_NAME=UnitsTest -dTEST_COLLECTION_PRODUCT=Units-Tests" OnlyPlatforms="x86,x64,Linux*,MacOS*">
    <SubProduct ProductName="Units-Tests"/>
    <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
    <Bindings>
      <Files ProductDirectoryName="Gtest-NativeAssemblies">Delivery/Gtest/UnitsTest/Assemblies/*</Files>
      <Directory ProductDirectoryName="Gtest-Assets" SourceName="Delivery/Gtest/UnitsTest/Assets" />
    </Bindings>
  </Part>

	<!-- Memory leak testing of Units tests. Only called on demand -->
	<Part Name="MemLeakTests" BentleyBuildMakeFile="${SrcRoot}DgnDbTestingScripts/MemoryLeak/RunMemLeakDetection.mke" BMakeOptions="-dGTEST_PRODUCT=Units-Gtest -dGTEST_NAME=UnitsTest" OnlyPlatforms="x64">
		<SubPart PartFile="DgnDbTestingScripts" Repository="DgnDbTestingScripts" PartName="MemLeakTests" />
		<SubProduct ProductName="Units-Gtest" />
	</Part>

  
  <!-- *** AndroidJUnit *** -->
  <Part Name="AndroidJUnit" DeferType="BuildUnitTests" BentleyBuildMakeFile="${SrcRoot}BeGTest/Android/MakeJUnitTestProject.mke" BentleyBuildMakeOptions="-dTEST_COLLECTION_PRODUCT=Units-Tests -dUSE_STATIC_LIBRARIES=1 -dTEST_ANDROID_MIN_SDK_VERSION=19" OnlyPlatforms="Android*">
    <SubProduct ProductName="Units-Tests"/>
    <SubPart PartName="AndroidJUnitTest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
    <Bindings>
      <Directory ProductDirectoryName="AndroidJUnit-Project" SourceName="Delivery/ANJUP" />
    </Bindings>
  </Part>

  <Product Name="Units-AndroidJUnit" >
    <SubPart PartName="AndroidJUnit" LibType="Static"/>
    <Directories DirectoryListName="AndroidJUnitProduct" Repository="BeGTest" PartFile="BeGTest"/>
  </Product>

  <Part Name="RunAndroidJUnitTest" DeferType="RunUnitTests" BentleyBuildMakeFile="${SrcRoot}BeGTest/Android/RunAndroidJUnitTest.mke" BentleyBuildMakeOptions="-dANDROIDJUNIT_PRODUCT=Units-AndroidJUnit" OnlyPlatforms="Android*">
    <SubProduct ProductName="Units-AndroidJUnit"/>
    <Bindings>
      <Files Required="false" SubPartDirectory="ANJU/Logs">Delivery/ANJU/Logs/Units-AndroidJUnit.log</Files>
    </Bindings>
  </Part>

  <!-- *** iOSXCTest *** -->
  <Part Name="iOSXCTest" DeferType="BuildUnitTests" BentleyBuildMakeFile="${SrcRoot}BeGTest/iOS/MakeXCTestProject.mke" BentleyBuildMakeOptions="-dTEST_NAME=Units -dTEST_COLLECTION_PRODUCT=Units-Tests -dUSE_STATIC_LIBRARIES=1" OnlyPlatforms="iOS*">
    <SubProduct ProductName="Units-Tests"/>
    <SubPart PartName="iOSXCTest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
    <Bindings>
      <Directory ProductDirectoryName="iOSXCTestProject" SourceName="Delivery/iOSXCTest/Units/Project" />
    </Bindings>
  </Part>

  <Product Name="Units-iOSXCTest" >
    <SubPart PartName="iOSXCTest" LibType="Static"/>
    <Directories DirectoryListName="iOSXCTestProduct" Repository="BeGTest" PartFile="BeGTest"/>
  </Product>

  <Part Name="RuniOSXCTest" DeferType="RunUnitTests" BentleyBuildMakeFile="${SrcRoot}BeGTest/iOS/RunXCTestProject.mke" BentleyBuildMakeOptions="-dXCTEST_PRODUCT=Units-iOSXCTest" OnlyPlatforms="iOS*">
    <SubProduct ProductName="Units-iOSXCTest"/>
    <Bindings>
        <Files Required="false" SubPartDirectory="XCTest/Logs">Delivery/XCTest/Logs/Units-iOSXCTest.log</Files>
    </Bindings>
  </Part>

    <!-- *********************************************************** -->
    <!-- **** UWP Microsoft::VisualStudio::CppUnitTestFramework **** -->
    <!-- *********************************************************** -->
    <!-- N.B. ApiNumber is important here because we must manually reference some DLLs, and thus need an accruate suffix to find them. -->
    <Part
        Name="UwpTest" DeferType="BuildUnitTests"
        BentleyBuildMakeFile="${SrcRoot}BeGTest/uwp/MakeUwpTestProject.mke"
        BentleyBuildMakeOptions="-dTEST_NAME=Units -dTEST_COLLECTION_PRODUCT=Units-Tests"
        OnlyPlatforms="WinRT*"
        ApiNumber="B02"
        >
        <SubProduct ProductName="Units-Tests"/>
        <SubPart PartName="UwpTest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
        <Bindings>
            <Directory ProductDirectoryName="UwpTestProject" SourceName="Delivery/UnitsUwpTest"/>
        </Bindings>
    </Part>

    <Product Name="Units-UwpTest">
        <SubPart PartName="UwpTest"/>
        <Directories DirectoryListName="UwpTestProduct" Repository="BeGTest" PartFile="BeGTest"/>
    </Product>

    <Part
        Name="RunUwpTest"
        DeferType="RunUnitTests"
        BentleyBuildMakeFile="${SrcRoot}BeGTest/uwp/RunUwpTestProject.mke"
        BentleyBuildMakeOptions="-dUWPTEST_PRODUCT=Units-UwpTest"
        OnlyPlatforms="WinRT*"
        >
        <SubProduct ProductName="Units-UwpTest"/>
        <Bindings>
            <Files Required="false" SubPartDirectory="UwpTest/Logs">Delivery/UwpTest/Logs/Units-UwpTest.log</Files>
        </Bindings>
    </Part>

  <!-- *** WinRT CTest - TBD ... *** -->
    
    <!-- //////////////////////////////////////////////////////////////////////////// -->
    <!-- // L10N                                                                   // -->
    <!-- //////////////////////////////////////////////////////////////////////////// -->
    <Part Name="Units-Xliffs" BentleyBuildMakeFile="Localization/Xliffs.mke">
        <Bindings>
            <Files ProductDirectoryName="UnitsXliffs" Required="false" SubPartDirectory="xliffs">Delivery/xliffs/Units_en.xliff</Files>
        </Bindings>
    </Part>

    <!-- English Xliffs generated during the build are pushed (by PRG only) to Mercurial next to translations for L10N vendor convenience -->
    <Part
        Name="L10N-UnitsXliffs-en"
        OnlyPlatforms="x64"
        BentleyBuildMakeFile="${SrcRoot}bsicommon/sqlang/mki/PushXliffsFromBuild.mke"
        BentleyBuildMakeOptions="-dBUILD_XLIFF_DIRECTORY=$(OutputRootDir)BuildContexts/Units/Delivery/xliffs/ -dL10N_XLIFF_DIRECTORY=$(SrcRoot)l10n/l10N-Units/ -dL10N_XLIFF_LANG_DIRECTORY=en"
        >
        <RequiredRepository>l10N-Units</RequiredRepository>
        <SubPart PartName="UnitsDll"/>
    </Part>

    <Part Name="L10N-UnitsXliffs-cs" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=cs">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="cs" SubPartDirectory="l10n/cs">Delivery/l10n/cs/Units_cs.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-de" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=de">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="de" SubPartDirectory="l10n/de">Delivery/l10n/de/Units_de.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-es" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=es">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="es" SubPartDirectory="l10n/es">Delivery/l10n/es/Units_es.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-fi" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=fi">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="fi" SubPartDirectory="l10n/fi">Delivery/l10n/fi/Units_fi.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-fr" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=fr">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="fr" SubPartDirectory="l10n/fr">Delivery/l10n/fr/Units_fr.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-it" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=it">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="it" SubPartDirectory="l10n/it">Delivery/l10n/it/Units_it.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-ja" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=ja">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="ja" SubPartDirectory="l10n/ja">Delivery/l10n/ja/Units_ja.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-ko" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=ko">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="ko" SubPartDirectory="l10n/ko">Delivery/l10n/ko/Units_ko.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-nl" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=nl">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="nl" SubPartDirectory="l10n/nl">Delivery/l10n/nl/Units_nl.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-pl" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=pl">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="pl" SubPartDirectory="l10n/pl">Delivery/l10n/pl/Units_pl.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-pt" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=pt">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="pt" SubPartDirectory="l10n/pt">Delivery/l10n/pt/Units_pt.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-ru" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=ru">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="ru" SubPartDirectory="l10n/ru">Delivery/l10n/ru/Units_ru.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-sv" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=sv">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="sv" SubPartDirectory="l10n/sv">Delivery/l10n/sv/Units_sv.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-tr" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=tr">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="tr" SubPartDirectory="l10n/tr">Delivery/l10n/tr/Units_tr.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-zh-cn" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=zh-cn">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="zh-cn" SubPartDirectory="l10n/zh-cn">Delivery/l10n/zh-cn/Units_zh-cn.xliff</Files>
        </Bindings>
    </Part>

    <Part Name="L10N-UnitsXliffs-zh-tw" BentleyBuildMakeFile="l10N-Units.mke" BentleyBuildMakeOptions="-dL10N_LANGUAGE_TAG=zh-tw">
        <RequiredRepository>l10N-Units</RequiredRepository>
        <Bindings>
            <Files ProductDirectoryName="L10N-UnitsXliffs" Required="false" ProductSubDirectory="zh-tw" SubPartDirectory="l10n/zh-tw">Delivery/l10n/zh-tw/Units_zh-tw.xliff</Files>
        </Bindings>
    </Part>
</BuildContext>
