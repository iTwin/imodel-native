<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd" >

<!-- ///////////////////////////////////////////////////////////////////////////////////// -->
<!-- ///////////////////// Runtime Parts ///////////////////////////////////////////////// -->
<!-- / This section contains parts that make the UNITS Runtime ///////////////////////////// -->
<!-- ///////////////////////////////////////////////////////////////////////////////////// -->

    <Part Name="Logging" ExcludeLibType="Static" ExcludePlatforms="MacOS*"> <!-- Trim off dynamic-only parts here so we don't have to download the (non-existant) partfiles) -->
        <SubPart PartName="LoggingNative"   PartFile="LoggingSDK"                           Repository="loggingsdk" /> 
    </Part>

    <!-- NOTE: Graphite uses "G" as an ApiNumber (library suffix) to disambiguate from Vancouver libraries -->
    <Part Name="UnitsDll" BentleyBuildMakeFile="Units.mke" ApiNumber="G06">
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="BentleyDll"      PartFile="Bentley"      Repository="Bentley" />
        <SubPart PartName="Logging" />
        <Bindings>
            <Libs ProductDirectoryName="UnitsLibs" Required="false">Delivery/$(libprefix)Units$(libext)</Libs>
            <Assemblies ProductDirectoryName="UnitsNativeAssemblies">Delivery/$(shlibprefix)Units$(ApiNumber)$(shlibext)</Assemblies>
        </Bindings>
    </Part>

    <!-- Bind my own PublicAPI into BuildContext/PublicAPI. Note that this part does not cause any sub-part PublicAPIs to be bound. -->
    <Part Name="PublicAPI" BentleyBuildMakeFile="units.prewire.mke">
        <Bindings>
            <PublicAPI Domain="Units" />
        </Bindings>
    </Part>

    <Part Name="Units-Windows-Only" OnlyPlatforms="x*">
        <SubPart PartName="UnitsDll" />
    </Part>

    <Part Name="Units-iOS-Only" OnlyPlatforms="iOS*">
        <SubPart PartName="UnitsDll" />
    </Part>

    <Part Name="Units-Android-Only" OnlyPlatforms="Android*">
        <SubPart PartName="UnitsDll" />
    </Part>

    <Part Name="UnitsNative">
        <SubPart PartName="Units-Windows-Only"  LibType="Dynamic" />
        <SubPart PartName="Units-iOS-Only"      LibType="Static" />
        <SubPart PartName="Units-Android-Only"  LibType="Static" />
    </Part>

<!-- ///////////////////////////////////////////////////////////////////////////////////// -->
<!-- ////////////////////////////////// Products ///////////////////////////////////////// -->
<!-- ///////////////////////////////////////////////////////////////////////////////////// -->

    <ProductDirectoryList ListName="UnitsTested" >
        <ProductDirectory Name="PublicAPI"                          Deliver="false"/>
        <ProductDirectory Name="VendorAPI"                          Deliver="false" />
        <ProductDirectory Name="VendorNotices"                      Deliver="false" />
        <ProductDirectory Name="LoggingWorkspaceData"               Deliver="false"/>
        <ProductDirectory Name="LoggingManagedAssemblies"           Deliver="false"/>
        <ProductDirectory Name="LoggingOptionalManagedAssemblies"   Deliver="false"/>
        <ProductDirectory Name="libs"                               Deliver="false"/>

        <ProductDirectory   Name="PublicAPI"                    LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="VendorAPI"                    LibType="Static"    Deliver="false" />
        <ProductDirectory   Name="VendorNotices"                LibType="Static"    Deliver="false" />
        <ProductDirectory   Name="libs"                         LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="BentleyNativeAssemblies"      LibType="Static"    Deliver="false"/>
        <ProductDirectory   Name="UnitsNativeAssemblies"        LibType="Static"    Deliver="false"/>

        <ProductDirectory Name="loggingnativeassemblies"            Path="Runtime"/>
        <ProductDirectory Name="LoggingOptionalNativeAssemblies"    Path="Runtime"/>
        <ProductDirectory Name="BentleyNativeAssemblies"            Path="Runtime"/>
        <ProductDirectory Name="UnitsNativeAssemblies"              Path="Runtime"/>
        <ProductDirectory Name="PublishedApi"                       Path="Include"/>
        <ProductDirectory Name="PublishedApi_Doc"                   Path="Docs"/>
        <ProductDirectory Name="VendorNotices"                      Path="Notices"/>
    </ProductDirectoryList>


    <Product Name="UnitsTested" PrgOutputDir="Units" SaveProduct="true" AddIn="true">
        <SubPart PartName="UnitsNative" />
        <SubProduct ProductName="Units-Tests" ExcludePlatforms="ios*"/>
        <SubPart PartName="RunGtest" ExcludePlatforms="ios*"/>
        <Directories DirectoryListName="UnitsTested"/>
    </Product>
    
    <Part Name="RunGtest" BentleyBuildMakeFile="${SrcRoot}BeGTest/gtest/RunGTest.mke" BentleyBuildMakeOptions="-dGTEST_EXE=$(OutputRootDir)Product/Units-Gtest/UnitsTest -dGTEST_OUTPUT_DIR=$(OutputRootDir)build/Units" OnlyPlatforms="x86,x64,MacOs*,Linux*">
        <SubProduct ProductName="Units-Gtest" />
        <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
    </Part>
    
    <Product Name="Units-Gtest" >
        <SubPart PartName="Gtest"/>
        <Directories DirectoryListName="GtestProduct" Repository="BeGTest" PartFile="BeGTest"/>
    </Product>
    
    <Part Name="Gtest" BentleyBuildMakeFile="${SrcRoot}BeGTest/gtest/buildGTest.mke" BentleyBuildMakeOptions="-dTEST_NAME=UnitsTest -dTEST_COLLECTION_PRODUCT=Units-Tests" OnlyPlatforms="x86,x64,Linux*,MacOS*">
        <SubProduct ProductName="Units-Tests"/>
        <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/>
        <Bindings>
            <Files ProductDirectoryName="Gtest-NativeAssemblies">Delivery/Gtest/UnitsTest/Assemblies/*</Files>
            <Directory ProductDirectoryName="Gtest-Assets" SourceName="Delivery/Gtest/UnitsTest/Assets" />
        </Bindings>
    </Part>
    
    <Product Name="Units-Tests">
        <SubPart Repository="BeGTest" PartFile="BeGTest" PartName="Base" />
        <SubPart PartName="Tests"/>
        <Directories DirectoryListName="CollectionProduct" Repository="BeGTest"  PartFile="BeGTest"/>
    </Product>
    
    <Part Name="Tests" BentleyBuildMakeFile="Test/BuildTests.mke" OnlyPlatforms="x86,x64,Linux*,MacOS*">
        <SubPart PartName="TestDependencies" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    SourceName="Delivery/UnitTests/Objects/UnitTests"/>
        </Bindings>
    </Part>

    <Part Name="TestDependencies" BentleyBuildMakeFile="Test/Prewire.mke">
        <SubPart PartName="UnitsNative" />
        <SubPart PartName="UnitsConversionData" />
        <Bindings>
            <Files ProductDirectoryName="UnitTests-IgnoreList"     ProductSubDirectory="Units" SubPartDirectory="UnitTests/Units">Delivery/UnitTests/ignore_list.txt</Files>
        </Bindings>
    </Part>

    <Part Name="UnitsConversionData" BentleyBuildMakeFile="test/ConversionData.prewire.mke">
        <Bindings>
            <Files SubPartDirectory="ConversionData" ProductDirectoryName="UnitTests-Assets" ProductSubDirectory="ConversionData">
                Delivery/ConversionData/*csv
            </Files>
        </Bindings>
    </Part>
</BuildContext>
