#--------------------------------------------------------------------------------------
#
#     $Source: src/native/log4cxx/log4cxx.mke $
#
#   $Copyright: (c) 2017 Bentley Systems, Incorporated. All rights reserved. $
#
#--------------------------------------------------------------------------------------
HAVE_PERMISSION_TO_COMPILE_AT_W3=1

%include mdl.mki
%include $(SrcRoot)LoggingSdk/mki/LoggingSdkCommon.mki

#-----------------------------------------------------------------------
#       Project Setup
#-----------------------------------------------------------------------
appName         = bentleylog4cxx
programName     = $(appName)
baseDir         = $(_MakeFilePath)

always:
    !~@mkdir $(o)


#-----------------------------------------------------------------------
#       Include compile options and pw macros
#-----------------------------------------------------------------------

nameToDefine = BSILOG_LOG4CXX_EXPORTS
%include cdefapnd.mki

nameToDefine = UNICODE
%include cdefapnd.mki

nameToDefine = LOG4CXX_STATIC
%include cdefapnd.mki

dirToSearch = $(nativeIntDir)
%include cincapnd.mki

#dirToSearch = $(LIBSRC)log4cxx/log4cxx-0.10.0/src/main/include/
#%include cincapnd.mki

CCompPDBName = $(appName)

#-----------------------------------------------------------------------
#       Include Files
#-----------------------------------------------------------------------
Includes    =   $(baseDir)log4cxx.h $(BuildContext)PublicApi/Logging/bentleylogging.h

#-----------------------------------------------------------------------
#       Compile Source
#-----------------------------------------------------------------------
MultiCompileDepends=$(_MakeFileSpec) $(Includes)
%include MultiCppCompileRule.mki

$(o)log4cxx.obj     :   $(baseDir)log4cxx.cpp       ${MultiCompileDepends}

$(o)cinterface.obj  :   $(baseDir)cinterface.cpp    ${MultiCompileDepends}

$(o)dllmain.obj     :   $(baseDir)dllmain.cpp       ${MultiCompileDepends}

%include MultiCppCompileGo.mki
Objects =% $(MultiCompileObjectList)

#-----------------------------------------------------------------------
#   Create the Windows NT DLL from Objects
#-----------------------------------------------------------------------
LINKER_LIBRARIES   =    $(ContextSubpartsLibs)Bentley.lib \
                        $(ContextSubpartsLibs)liblog4cxx010.lib \
                        $(BuildContextSubParts)staticlibs/libapr010502.lib \
                        $(BuildContextSubParts)staticlibs/libaprutil010504.lib \
                        ws2_32.lib odbc32.lib advapi32.lib mswsock.lib Rpcrt4.lib

# Cannot use libsmtp in DgnDb due to licensing concerns.
#                        $(BuildContextSubParts)libs/libsmtp08.lib \

%include linklibrary.mki

#-----------------------------------------------------------------------
#   Copy the files required for the SDK
#-----------------------------------------------------------------------
$(BuildContextDelivery)log4j.dtd : $(ContextSubpartsLibs)log4j.dtd
    $(LinkFirstDepToFirstTarget)

