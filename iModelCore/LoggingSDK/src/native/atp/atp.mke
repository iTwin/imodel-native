#--------------------------------------------------------------------------------------
#
#     $Source: src/native/atp/atp.mke $
#
#  $Copyright: (c) 2015 Bentley Systems, Incorporated. All rights reserved. $
#
#--------------------------------------------------------------------------------------
HAVE_PERMISSION_TO_COMPILE_AT_W3=1

%include mdl.mki
%include $(SrcRoot)LoggingSdk/mki/LoggingSdkCommon.mki

programName     = bentleyloggingtest
executableName  = bentleyloggingtest
baseDir         = $(_MakeFilePath)
incDir          = $(_MakeFilePath)../interface/
unitTestDir     = $(UTILROOT)cpp/cppunittest/

dirToSearch     = $(incDir)
%include cincapnd.mki

always:
    !~@mkdir $(o)

#-----------------------------------------------------------------------
#       Include Files
#-----------------------------------------------------------------------
allIncs         = $(BuildContext)PublicAPI/Logging/bentleylogging.h  $(BuildContextVendorAPI)cppunittest/testharness.h

#-----------------------------------------------------------------------
#       Object Files
#-----------------------------------------------------------------------
allObjs         =   $(o)consoleatp$(oext) $(o)log4cxxatp$(oext) $(o)fileatp$(oext)

#-----------------------------------------------------------------------
#       Compile Source
#-----------------------------------------------------------------------
$(o)consoleatp$(oext)           :   $(baseDir)consoleatp.cpp  $(allIncs)

$(o)fileatp$(oext)              :   $(baseDir)fileatp.cpp  $(allIncs)

$(o)log4cxxatp$(oext)           :   $(baseDir)log4cxxatp.cpp  $(allIncs)

$(atpDir)Bentley5.dll : $(BuildContext)SubParts/Assemblies/Bentley5.dll
    $(LinkFirstDepToFirstTarget)

#-----------------------------------------------------------------------
#   Create the Windows NT DLL from Objects
#-----------------------------------------------------------------------

CPPUNITTEST_OUT     = $(o)
CPPUNITTEST_NAME    = $(executableName)
CPPUNITTEST_DEST    = $(atpDir)
CPPUNITTEST_LIBS    = $(BuildContext)SubParts/Libs/bentley.lib
CPPUNITTEST_LIBS    + $(BuildContext)SubParts/Libs/BentleyAllocator.lib
CPPUNITTEST_LIBS_DELAYLOAD  =
CPPUNITTEST_OBJS    = $(allObjs)
CPPUNITTEST_PATH    = $(binDir)
CPPUNITTEST_SYMB    = $(atpDir)

%include $(SharedMki)cppunittest.mki        # Create .DLL
