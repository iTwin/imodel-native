<?xml version="1.0" encoding="utf-8"?>
<BuildContext
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd"
    >

    <!-- ======================================================================================================================================== -->
    <!-- == PUBLIC ============================================================================================================================== -->
    <!-- ======================================================================================================================================== -->

    <Part Name="iModelNativeCorePRG" PrgOutputDir="iModelNativeCore">
        <SubPart PartName="__iModelNativeCorePRGDynamicPlats"/>
        <SubPart PartName="__iModelNativeCorePRGStaticPlats"/>
    </Part>
    
    <!--
        iModelNativeCore needs to include at least the platform SubParts required for the
        iModelJsNodeAddon. See iModelJsNodeAddon:iModelJsNodeAddonLibCommon.
     -->
    <Part Name="iModelNativeCore">
        <SubPart PartName="DgnPlatformDLL" PartFile="DgnPlatform" Repository="DgnPlatform"/>
        <SubPart PartName="ECPresentation" PartFile="ECPresentation" Repository="ECPresentation"/>
        <SubPart PartName="ECObjectsNative" PartFile="ECObjects" Repository="ECObjects"/>
        <SubPart PartName="iModelNativeCoreSqlang" PartFile="iModelNativeCoreL10N"/>
    </Part>

    <Part Name="RunAllTests" DeferType="RunUnitTests"
            BentleyBuildMakeFile="${SrcRoot}iModelNative/iModelNativeCore/BeGTest/gtest/CheckLogfilesForFailures.mke"
            BentleyBuildMakeOptions="-dLogFilesDir=$(BuildContext)SubParts/Gtest/Logs +dAllowIgnore=1"
            >
        <SubPart PartName="RunGtest" PartFile="BeHttp" Repository="BeHttp"/>
        <SubPart PartName="RunGtest" PartFile="Bentley" Repository="Bentley"/>
        <SubPart PartName="RunGtest" PartFile="BeSQLite" Repository="BeSQLite"/>
        <SubPart PartName="RunGtest" PartFile="DgnPlatform" Repository="DgnPlatform"/>
        <SubPart PartName="RunGtest" PartFile="ECDb" Repository="ECDb"/>
        <SubPart PartName="RunGtest" PartFile="ECObjects" Repository="ecobjects"/>
        <SubPart PartName="RunGtest" PartFile="ECPresentation" Repository="ECPresentation"/>
        <SubPart PartName="RunGtest" PartFile="geomlibs" Repository="GeomLibs"/>
        <SubPart PartName="RunGtest" PartFile="Units" Repository="Units"/>

        <!-- These are built, but not run, due to time. -->
        <SubProduct ProductName="GeoCoord-Gtest" PartFile="GeoCoord" Repository="GeoCoord"/>
        
        <SubPart PartName="PerformanceTests" PartFile="ECObjects" Repository="ecobjects"/>
        <SubPart PartName="UnitTests-Performance" PartFile="Bentley" Repository="Bentley"/>
        <SubPart PartName="UnitTests-Performance" PartFile="DgnPlatform" Repository="DgnPlatform"/>
        <SubPart PartName="UnitTests-Performance" PartFile="ECDb" Repository="ECDb"/>
        <SubPart PartName="UnitTests-PerformanceTest" PartFile="geomlibs" Repository="GeomLibs"/>
    </Part>

    <!-- ======================================================================================================================================== -->
    <!-- == PRIVATE ============================================================================================================================= -->
    <!-- ======================================================================================================================================== -->

    <Part Name="__iModelNativeCorePRGDynamicPlats" OnlyPlatforms="x64,winrt*">
        <SubPart PartName="iModelNativeCore" LibType="Dynamic"/>
        <SubPart PartName="RunAllTests" LibType="Dynamic"/>
        <SubPart PartName="__ParasiteSubParts" LibType="Dynamic"/>
    </Part>

    <Part Name="__iModelNativeCorePRGStaticPlats" OnlyPlatforms="android*,ios*,macos*,linux*">
        <SubPart PartName="iModelNativeCore" LibType="Static"/>
        <SubPart PartName="RunAllTests" LibType="Static"/>
        <SubPart PartName="__ParasiteSubParts" LibType="Static"/>
    </Part>

    <!--
        These are "parasites" because they aren't strictly required for the iModelJsNodeAddon
        library itself. However, they may be required for its non-library parts of the build (e.g.
        testing, which we'd normally exclude from our build), or for other downstream builds.
    -->
    <Part Name="__ParasiteSubParts">
        <!-- Testing -->
        <!-- .................................................................................. -->
        <SubPart PartName="Gtest-Tools" PartFile="BeGTest" Repository="BeGTest"/>
        <SubPart PartName="google_gmock_lib" PartFile="gmock" Repository="util-gmock"/>
        <SubPart PartName="google_gtest_lib" PartFile="gtest" Repository="util-gtest"/>

        <!-- For DgnClientSdk -->
        <!-- .................................................................................. -->
        <SubProduct ProductName="IModelExtractor" PartFile="IModelExtractor" Repository="BeSQLite"/>
        <SubProduct ProductName="iModelConsole" PartFile="DgnPlatform" Repository="DgnPlatform"/>
        
        <SubPart PartName="LoggingManagedInterop" PartFile="LoggingSDK" Repository="LoggingSDK"/>
        <SubPart PartName="DgnPlatformExtractions" PartFile="DgnPlatform" Repository="DgnPlatform"/>
        <SubPart PartName="Docs" PartFile="ECPresentation" Repository="ECPresentation"/>
        <SubPart PartName="BentleyDocConfig" PartFile="DgnPlatform" Repository="DgnPlatform"/>

        <SubPart PartName="NuGetPackage" PartFile="ecobjects" Repository="ecobjects"/>
        <SubPart PartName="NuGetPackage" PartFile="ecdb" Repository="ECDb"/>
        <SubPart PartName="NuGetPackage" PartFile="ECPresentation" Repository="ECPresentation"/>
        <SubPart PartName="NuGetPackage" PartFile="dgnplatform" Repository="DgnPlatform"/>
    </Part>

</BuildContext>
