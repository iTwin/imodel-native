#----------------------------------------------------------------------
#
#     $Source: Tests/DgnProject/Compatibility/CompatibilityRunner/PullCompatibilityNugets.mke $
#
#  $Copyright: (c) 2018 Bentley Systems, Incorporated. All rights reserved. $
#
#----------------------------------------------------------------------

#----------------------------------------------------------
# Set up all the standard stuff.
#----------------------------------------------------------
%include  mdl.mki

%include $(SrcRoot)DgnPlatform/Tests/DgnProject/Compatibility/CompatibilityRunner/common.mki

#----------------------------------------------------------
# Make a subdir for the nuget packages, pull them from server
# link them to the product directory so they are set up to run
# against the same data
#----------------------------------------------------------

NUGET_DIR = $(SrcRoot)/nuget/iModelCompatibility/
ASSETS_DIR = $(IMS_DIR)/Assets
IMS_NUGETS_DIR = $(IMS_DIR)/Nugets
CURRENT_DATASET_DIR = $(OutputRootDir)Product/iModelSchemaEvolutionGTest/run/SeedData
NUGET_DATASETS_DIR = $(OutputRootDir)iModelSchemaEvolution/Data/SeedData
always:
    ~mkdir $(NUGET_DIR)
    ~mkdir $(IMS_DIR)
    ~mkdir $(ASSETS_DIR)
    ~mkdir $(NUGET_DATASETS_DIR)
    $(SrcRoot)bsicommon/build/CopyWithSymlinks.py $(BuildContext)Delivery/Gtest/DgnCompatibility/Assets/ $(ASSETS_DIR)
    python Tests/DgnProject/Compatibility/CompatibilityRunner/PullCompatibilityNugets.py $(NUGET_DIR) $(SrcRoot)BentleyBuild/bentleybuild $(CURRENT_DATASET_DIR)
    $(SrcRoot)bsicommon/build/CopyWithSymlinks.py $(NUGET_DIR) $(IMS_NUGETS_DIR)
    python Tests/DgnProject/Compatibility/CompatibilityRunner/CopyEXE.py $(NUGET_DIR) $(IMS_NUGETS_DIR) $(NUGET_DATASETS_DIR)
