#---------------------------------------------------------------------------------------+
#
#     $Source: Tests/DgnProject/Compatibility/CompatibilityRunner/SaveDatasets.mke $
#
#  $Copyright: (c) 2018 Bentley Systems, Incorporated. All rights reserved. $
#
#---------------------------------------------------------------------------------------+
%include mdl.mki
%include $(SrcRoot)DgnPlatform/Tests/DgnProject/Compatibility/CompatibilityRunner/common.mki

CacheDir = $(OutBuildDir)iModelSchemaEvolutionDatasets/
ContextDir = $(BuildContext)iModelSchemaEvolutionDatasets/

# Tests only write their side effects into the Product/ directory structure.
# Further, test runner parts do not re-run tests of a log file is cached in the build/ directory structure.
# We must thus make a hard copy of the output we need to survive a <bb b -r>.

COPYDIR_INPUT= $(NEWFILES_DIR)
COPYDIR_OUTPUT = $(CacheDir)

always:
    ~mkdir $(ContextDir)

%include $(SrcRoot)bsicommon/build/copyDir.mki

%if !exists($(CacheDir))
    %error This part must be run at least once after a full execution of the DgnPlatform GTest suite.
%endif

always:
    python $(SrcRoot)bsicommon/build/CopyWithSymlinks.py $(CacheDir) $(ContextDir)
