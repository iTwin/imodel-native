#---------------------------------------------------------------------------------------+
#
#     $Source: Tests/DgnProject/Compatibility/CompatibilityRunner/PrepareNugetPackaging.mke $
#
#  $Copyright: (c) 2018 Bentley Systems, Incorporated. All rights reserved. $
#
#---------------------------------------------------------------------------------------+
%include mdl.mki
%include $(SrcRoot)DgnPlatform/Tests/DgnProject/Compatibility/CompatibilityRunner/common.mki

# 1) Symlink the test files to be packaged to the build context, where
#    the respective part will pick up for packaging
#    (The test files are first copied from the run folder into the build folder, because the run folder
#    will be deleted in the next step)
# 2) Delete the run folder, to avoid the test results are packaged into the test runner nuget


%if !exists($(NEWFILES_DIR))
    %error This part must be run at least once after a full execution of the iModelEvolution GTest suite.
%endif

CacheDir = $(OutBuildDir)IModelEvolutionTests/TestFilesForNugetPackage
ContextDir = $(BuildContext)IModelEvolutionTestFilesForNugetPackage/

always:
    ~mkdir $(CacheDir)

COPYDIR_INPUT= $(NEWFILES_DIR)
COPYDIR_OUTPUT = $(CacheDir)

%include $(SrcRoot)bsicommon/build/copyDir.mki


always:
    ~mkdir $(ContextDir)
    python $(SrcRoot)bsicommon/build/CopyWithSymlinks.py $(CacheDir) $(ContextDir)
    $(rmdirRecursiveCmd) $(CURRENTTESTRUNNER_RUN_DIR)
