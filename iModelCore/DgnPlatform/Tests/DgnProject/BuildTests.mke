#----------------------------------------------------------------------------------------
#
#  $Source: Tests/DgnProject/BuildTests.mke $
#
#  $Copyright: (c) 2015 Bentley Systems, Incorporated. All rights reserved. $
#
#----------------------------------------------------------------------------------------
NO_DEFAULT_CLANG_WARNINGS=1

%include mdl.mki

%ifndef TestDir
    %error must define TestDir
%endif

baseDir = $(_MakeFilePath)

tempInclude = $(OutputRootDir)build/DgnPlatform/UnitTests/include/
cIncs + -I$(tempInclude)

# backdoor: Allow published tests (and all tests) to include ScopedDgnHost.h (which is not in the published api) at a predictable location
$(tempInclude)DgnPlatform/DgnHandlers/ScopedDgnHost.h : $(BuildContext)PublicAPI/DgnPlatform/DgnHandlers/UnitTests/ScopedDgnHost.h
    $(msg)
    $(LinkFirstDepToFirstTarget)

# Compile and Link the unit tests
BEGTEST_NAME  = $(TestDir)DgnPlatform
BEGTEST_INPUT = $(baseDir)$(TestDir)/
BEGTEST_IGNORE= $(baseDir)ignore_list.txt
BEGTEST_OUTPUT=$(OutputRootDir)build/DgnPlatform/UnitTests/
o = $(BEGTEST_OUTPUT)$(BEGTEST_NAME)/

%ifdef UsePublishedApi
    BEGTEST_API = $(BuildContext)SubParts/PublishedApi/DgnProject/
%endif

%include $(SrcRoot)bsicommon/sharedmki/DetectAndCompileUnitTests.mki

# Deliver 
$(BuildContext)Delivery/UnitTests/Objects/$(TestDir) : ${o}
    $(LinkFirstDepToFirstTargetAsDirectory)
