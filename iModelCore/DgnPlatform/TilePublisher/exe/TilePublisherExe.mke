#----------------------------------------------------------------------------------------
#
#  $Source: TilePublisher/exe/TilePublisherExe.mke $
#
#  $Copyright: (c) 2017 Bentley Systems, Incorporated. All rights reserved. $
#
#----------------------------------------------------------------------------------------

%include mdl.mki

#----------------------------------------------------------------------------------------
#   Set up dirs
#----------------------------------------------------------------------------------------
SrcDir              = $(_MakeFilePath)
SubpartLibs         = $(BuildContext)SubParts/Libs/
o                   = $(OutputRootDir)Build/TilePublisher/
appName             = TilePublisher

always:
    ~mkdir $(o)

#----------------------------------------------------------------------------------------
#   Include TilePublisher.h
#----------------------------------------------------------------------------------------
libInclude = $(OutputRootDir)build/TilePublisher/
cIncs + -I$(libInclude)

#----------------------------------------------------------------------------------------
#   Compile and link
#----------------------------------------------------------------------------------------
MultiCompileDepends = $(_MakeFileSpec)
%include MultiCppCompileRule.mki

$(o)main$(oext) : $(SrcDir)main.cpp ${MultiCompileDepends}

%include MultiCppCompileGo.mki

EXE_NO_SIGN         = 1
EXE_DEST            = $(o)
EXE_NAME            = $(appName)
EXE_OBJS            = $(MultiCompileObjectList)

%ifdef __unix

%include $(SharedMki)rollUpSubPartsLibsThin.mki
EXE_OBJS + $(THIN_ARCHIVE_PATH)

%else

EXE_LOPT1           = -entry:wmainCRTStartup

LINKER_LIBRARIES    = $(SubpartLibs)Bentley.lib \
                      $(SubpartLibs)BeSQLite.lib          \
                      $(SubpartLibs)BeSQLiteEC.lib        \
                      $(SubpartLibs)BeLibXml2.lib         \
                      $(SubpartLibs)BentleyGeom.lib       \
                      $(SubpartLibs)DgnPlatform.lib       \
                      $(SubpartLibs)ECObjects.lib         \
                      $(SubpartLibs)Units.lib             \
                      $(SubpartLibs)BeJsonCpp.lib         \
                      $(SubpartLibs)BaseGeoCoord.lib      \
                      $(SubpartLibs)ThreeMx.lib           \
                      $(SubpartLibs)PointCloud.lib        \
                      $(SubPartLibs)Raster.lib            \
                      $(SubpartLibs)BeFolly.lib           \
                      $(SubpartLibs)TilePublisher.lib     \
                      gdi32.lib                           \
                      user32.lib                          \

%endif

%include $(SharedMki)linktool.mki

