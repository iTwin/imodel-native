<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">

    <!-- Bind my own PublicAPI and VendorAPI into BuildContext. Note that this part does not cause any sub-part PublicAPIs to be bound. Also deliver my notices. -->
    <Part Name="PublicAPI" BentleyBuildMakeFile="ECDb.prewire.mke">
        <Bindings>
            <PublicAPI Domain="ECDb" />
        </Bindings>
    </Part>

    <Part Name="ECDb">
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="ECDbLibrary" />
        <SubPart PartName="PublishedApi" />
        <SubPart PartName="ECDbPrepareDocGeneration" />
    </Part>

    <!-- NOTE: Graphite uses "G" as an ApiNumber (library suffix) to disambiguate from Vancouver libraries -->
    <Part Name="ECDbLibrary" BentleyBuildMakeFile="ECDb/ECDb.mke" ApiNumber="G">
        <SubPart PartName="PublicAPI" />
        <SubPart PartName="BeSQLite"        PartFile="BeSQLite"  Repository="BESQLite"/>
        <SubPart PartName="ECObjectsNative" PartFile="ecobjects" Repository="ecobjects" />
        <SubPart PartName="GeomlibsSerialization" PartFile="geomlibs" Repository="geomlibs" />
        <SubPart PartName="BeJsonCpp"       PartFile="BeJsonCpp" Repository="Libsrc-JsonCpp"/>
        <SubPart PartName="rapidjson"       PartFile="rapidjson" Repository="Libsrc-RapidJson"/>
        <Bindings>
            <Libs>Delivery/$(libprefix)BeSQLiteEC$(libext)</Libs>
            <Assemblies ProductDirectoryName="BentleyNativeAssemblies">Delivery/$(libprefix)BeSQLiteEC$(ApiNumber)$(shlibext)</Assemblies>
            <Files ProductDirectoryName="VendorNotices" Required="true">Delivery/openoffice-notice.txt</Files>
            <Files ProductDirectoryName="ECSchemas" ProductSubDirectory="ECSchemas/ECDb" SubPartDirectory="ECSchemas/ECDb">
                ECSchemas/ECDb/*.ecschema.xml
            </Files>
        </Bindings>
    </Part>

   
    <Part Name="ECDbPrepareDocGeneration" BentleyBuildMakeFile="ECDb/docs/preparedocgeneration.mke">
        <SubPart PartName="PublishedApi" />
        <SubPart PartName="ECDbExtractCodeSamples" />
        <SubPart PartName="ECDbBuildCodeSamples" />
        <SubPart PartName="StandardSchemas" PartFile="ECStandards"  Repository="ECStandards"/>
        <Bindings>
            <Directory SourceName="Docs/Source/ECDb" SubPartDirectory="Docs/Source/ECDb"/>
            <Directory SourceName="Docs/Images/ECDb" SubPartDirectory="Docs/Images/ECDb"/>
            <Directory SourceName="Docs/Files/ECDb" SubPartDirectory="Docs/Files/ECDb"/>
        </Bindings>
    </Part>

    <Part Name="ECDbExtractCodeSamples" BentleyBuildMakeFile="${SrcBsiCommon}build/Extractions.mke" BMakeOptions="-dEXTRACTIONS_SOURCE_DIR=$(SrcRoot)ECDb/ECDb/docs/samplecode -dEXTRACTIONS_OUTPUT_BUILD_SUBDIR=ECDb/docs/extractedsamplecode -dEXTRACTIONS_NO_PROVENANCE">
        <SubPart PartName="ECDbLibrary" />
        <SubPart PartName="PublishedApi" />
    </Part>

    <Part Name="ECDbBuildCodeSamples" BentleyBuildMakeFile="${SrcBsiCommon}build/BuildSampleCode.mke" BMakeOptions="-dBUILD_SAMPLE_CODE_SOURCE_DIR=$(SrcRoot)ECDb/ECDb/docs/samplecode -dBUILD_SAMPLE_CODE_SUB_DIR=ecdbsamplecode -dPolicyFile=$(SrcRoot)ECDb/ECDb/ECDbPolicy.mki">
        <SubPart PartName="ECDbLibrary" />
        <SubPart PartName="PublishedApi" />
    </Part>
  
    <!-- TRICKY: There are two sets of public APIs, BeSQLite and ECDb. There is only one published API for this repository, and it must do for both. 
         To avoid that we run the publishing twice this part cares for it and symlinks the same published API once under the name of BeSQLite and
         once under the name of ECDb-->
    <Part Name="PublishedApi" BentleyBuildMakeFile="${SrcBsiCommon}sharedmki/PublishApi.mke" BMakeOptions="+dPUBLISHAPI_DELIVERY_DIR=Delivery/PublishedApi +dPUBLISHAPI_VENDORAPI=json +dPUBLISHAPI_VENDORAPI2=rapidjson">
        <SubPart PartName="ECDbLibrary" />
        <Bindings>
            <Directory SourceName="Delivery/PublishedApi"  SubPartDirectory="PublishedApi/ECDb"/>
        </Bindings>
    </Part>

    <Part Name="ECDbUnitTests" BentleyBuildMakeFile="../bsicommon/sharedmki/BuildPlatformUnitTests.mke" BMakeOptions="-dBEGTEST_INPUT=$(SrcRoot)ECDB/Tests/ -dBEGTEST_NAME=ECDb -dBEGTEST_DEPENDENCIES=$(SrcRoot)ECDB/Tests/dependencies.mki">
        <!-- Get GTest API directory -->
        <SubPart PartName="google_gtest_lib"                 PartFile="gtest"        Repository="util-gtest" />
        <!-- Get the tested API -->
        <SubPart PartName="ECDb"                             PartFile="ECDb"        Repository="ECDb" />
        <!-- Depends on/links with the following libraries  -->
        <SubPart PartName="Zlib"                             PartFile="Zlib"         Repository="Libsrc-Compress" />
        <!-- Get the test documents -->
        <SubProduct ProductName="BeTestDocuments"               PartFile="BeGTest"      Repository="BeGTest" />
    </Part>

    <!-- TRICKY: Documents are only actually published for x64,x86 but we must do other processing for other platforms and other cases so no platforms can be excluded! -->
    <Part Name="UnitTests_Documents" BentleyBuildMakeFile="${SrcBsiCommon}sharedmki/PublishDocuments.mke" BMakeOptions="-dUNIT_TESTS_NAME=ECDbUnitTests -dUNIT_TESTS_DOCUMENTS_DIR=${SrcRoot}/DgnPlatformTest/DgnDbUnitTests/ -dUNIT_TESTS_DOCUMENTS_PREBUILTS_SUBDIR=DgnDb -dUNIT_TESTS_PUBLISH_CONFIG=${SrcRoot}/ECDb/Tests/UnitTestPublisherConfiguration.xml">
        <!--<SubPart PartName="LinkDgnDbPublisherIntoToolContext" PartFile="BeGTest" Repository="BeGTest" LibType="Dynamic"/>-->
        <SubPart PartName="DgnDbUnitTestsData"/>
        <Bindings>
            <Directory SourceName="Delivery/UnitTests/Documents" SubPartDirectory="Documents/DgnDb" ProductDirectoryName="UnitTests_Documents_DgnDb" />
            <!-- Note: for BTest, use pre-published documents -->
        </Bindings>
    </Part>

    <Part Name="DgnDbUnitTestsData" OnlyPlatforms="x64,x86">
        <RequiredRepository>DgnDbUnitTestsData</RequiredRepository>
    </Part>

    <Part Name="UnitTests" BentleyBuildMakeFile="Tests/BuildTests.mke">
        <SubPart PartName="ECDb"                             PartFile="ECDb"        Repository="ECDb" />
        <SubPart PartName="Zlib"                             PartFile="Zlib"         Repository="Libsrc-Compress" />
        <SubProduct ProductName="BeTestDocuments"               PartFile="BeGTest"      Repository="BeGTest" />
        <SubPart PartName="PerformanceTestingHelper"        PartFile="BeSQLite"         Repository="BeSQLite"/>
        <Bindings>
            <Directory ProductDirectoryName="UnitTestsLinkables" ProductSubDirectory="ECDb" SourceName="Delivery/UnitTests/Linkables"/>
            <Files ProductDirectoryName="UnitTestsIgnoreList" ProductSubDirectory="ECDb">Delivery/UnitTests/ignore_list.txt</Files>
            <Directory ProductDirectoryName="UnitTestsDocumentsDgnDb" SourceName="Delivery/UnitTests/Documents"/>
        </Bindings>
    </Part>

    <!-- //////////////////////////////////////////////////////////////////////////// -->
    <!-- // ECSqlConsole                                                           // -->
    <!-- //////////////////////////////////////////////////////////////////////////// -->

    <Product Name="ECSqlConsole" SaveProduct="true">
        <SubPart PartName="ECSqlConsoleExe" />
        <Directories DirectoryListName="ECSqlConsoleDirList" />
    </Product>

    <Part Name="ECSqlConsoleExe" BentleyBuildMakeFile="ECSqlConsole/ECSqlConsole.mke">
        <SubPart PartName="ECDb"/>
        <Bindings>
            <Files ProductDirectoryName="ECSqlConsole">Delivery/ECSqlConsole$(exeext)
                                                       Delivery/logging.config.xml</Files>
        </Bindings>
    </Part>

    <ProductDirectoryList ListName="ECSqlConsoleDirList" >
        <ProductDirectory Name="PublicAPI"                          Deliver="false"/>
        <ProductDirectory Name="PublicAPI"                          Deliver="false" LibType="static"/>
        <ProductDirectory Name="VendorAPI"                          Deliver="false"/>
        <ProductDirectory Name="VendorAPI"                          Deliver="false" LibType="static"/>
        <ProductDirectory Name="Libs"                               Deliver="false"/>
        <ProductDirectory Name="Libs"                               Deliver="false" LibType="static"/>
        <ProductDirectory Name="BentleyLibs"                        Deliver="false"/>
        <ProductDirectory Name="LoggingManagedAssemblies"           Deliver="false"/>
        <ProductDirectory Name="LoggingOptionalManagedAssemblies"   Deliver="false"/>
        <ProductDirectory Name="LoggingWorkspaceData"               Deliver="false"/>
        <ProductDirectory Name="MergeModules"                       Deliver="false"/>
        
        <ProductDirectory Name="ECSqlConsole"                       Path=""/>
        <ProductDirectory Name="bentleynativeassemblies"            Path=""/>
        <ProductDirectory Name="ecobjectsnativeassemblies"          Path=""/>
        <ProductDirectory Name="ecschemas"                          Path=""/>
        <ProductDirectory Name="geomnativeassemblies"               Path=""/>
        <ProductDirectory Name="loggingnativeassemblies"            Path=""/>
        <ProductDirectory Name="VendorNotices"                      Path="Notices"/>
        <ProductDirectory Name="VendorNotices"                      Path="Notices" LibType="static"/>
    </ProductDirectoryList>

    <!-- *********************************************************************************************** -->
    <!-- a temporary part and product that shows how to gather test material into a test material product -->
    <ProductDirectoryList ListName="SwwTestsMaterialProductDir">
        <ProductDirectory Name="BentleyNativeAssemblies"            Path="Assemblies"/>
        <ProductDirectory Name="LoggingNativeAssemblies"            Path="Assemblies"/>
        <ProductDirectory Name="GeomNativeAssemblies"               Path="Assemblies"/>
        <ProductDirectory Name="ECObjectsNativeAssemblies"          Path="Assemblies"/>
        <ProductDirectory Name="Libs"                               Path="Libs"/>
        <ProductDirectory Name="BentleyLibs"                        Path="Libs"/>
        <ProductDirectory Name="UnitTestsLinkables"                 Path="Linkables"/>
        <ProductDirectory Name="UnitTestsAssets"                    Path="Assets"/>
        <ProductDirectory Name="UnitTestsIgnoreList"                Path="Assets/Ignore"/>
        <ProductDirectory Name="UnitTestsDocumentsDgnDb"            Path="Assets/BeTestDocuments/DgnDb"/>
        <ProductDirectory Name="ECSchemas"                          Path="Assets"/>
        <ProductDirectory Name="sqlang"                             Path="Assets/sqlang"/>
        <ProductDirectory Name="DgnPlatformFont"                    Path="Assets/fonts"/>
        <ProductDirectory Name="DgnPlatformLastResortFonts"         Path="Assets"/>
        <ProductDirectory Name="BeIcu4cData"                        Path="Assets"/>

        <ProductDirectory Name="PublicAPI" Deliver="false"/>
        <ProductDirectory Name="VendorAPI" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" LibType="static" />
        <ProductDirectory Name="Libs" Deliver="false" LibType="static"/>
    </ProductDirectoryList>

    <Product Name="SwwTestsMaterialProduct">
        <Directories DirectoryListName="SwwTestsMaterialProductDir"/>
        <SubPart PartName="UnitTests" Repository="Bentley" PartFile="Bentley"/>
        <SubPart PartName="UnitTests" Repository="BeSQLite" PartFile="BeSQLite"/>
        <SubPart PartName="UnitTests" Repository="ECDb" PartFile="ECDb"/>
    </Product>

    <!-- *********************************************************************************************** -->
    <!-- a temporary part and product that shows how to generate a gtest program from a test material product -->
    <ProductDirectoryList ListName="SwwTestsGtestProductDir">
        <ProductDirectory Name="GtestNativeAssemblies" Path=""/>
        <ProductDirectory Name="BentleyNativeAssemblies" Path=""/>
        <ProductDirectory Name="LoggingNativeAssemblies" Path=""/>
        <ProductDirectory Name="GtestDgnPlatformAssetsDirectory" Path="DgnPlatformAssetsDirectory"/>

        <ProductDirectory Name="UnitTestsLinkables" Deliver="false"/>
        <ProductDirectory Name="UnitTestsIgnoreList" Deliver="false"/>
        <ProductDirectory Name="Libs" Deliver="false"/>
        <ProductDirectory Name="Libs" Deliver="false" LibType="static"/>
        <ProductDirectory Name="PublicAPI" Deliver="false"/>
        <ProductDirectory Name="VendorAPI" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" />
        <ProductDirectory Name="VendorNotices" Deliver="false" LibType="static" />
    </ProductDirectoryList>

    <Product Name="SwwTestsGtestProduct">
        <Directories DirectoryListName="SwwTestsGtestProductDir"/>
        <SubPart PartName="SwwTestsGtest"/>
    </Product>

    <Part Name="SwwTestsGtest" BentleyBuildMakeFile="../begtest/buildGtest.mke" BentleyBuildMakeOptions="-dBEGTEST_NAME=SwwTests -dBEGTEST_MATERIAL_PRODUCT_DIR=SwwTestsMaterialProduct">
        <SubProduct ProductName="SwwTestsMaterialProduct"/>
        <SubPart PartName="google_gtest_lib"                PartFile="gtest"            Repository="util-gtest" />
        <SubPart PartName="google_gmock_lib"                PartFile="gmock"            Repository="util-gmock" />
        <SubPart PartName="LoggingNative"                   PartFile="LoggingSDK"       Repository="loggingsdk" />
        <SubPart PartName="BeSQLite"                        PartFile="BeSQLite"         Repository="BeSQLite" />
        <Bindings>
            <Files ProductDirectoryName="GtestNativeAssemblies">Delivery/BuildGtest/Assemblies/*</Files>
            <Directory ProductDirectoryName="GtestDgnPlatformAssetsDirectory" SourceName="Delivery/BuildGtest/DgnPlatformAssetsDirectory" />
        </Bindings>
    </Part>
</BuildContext>
