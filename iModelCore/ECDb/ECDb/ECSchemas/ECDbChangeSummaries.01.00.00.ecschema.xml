<ECSchema schemaName="ECDbChangeSummaries" alias="change" version="01.00.00" description="ECDb Change Summaries" displayLabel="ECDb Change Summaries" xmlns="http://www.bentley.com/schemas/Bentley.ECXML.3.1">
    <ECSchemaReference name="ECDbMap" version="02.00.00" alias="ecdbmap"/>
      
    <ECEntityClass typeName="Summary" displayLabel="Summary" modifier="Sealed">
        <ECCustomAttributes>
            <ClassMap xmlns="ECDbMap.02.00">
                <MapStrategy>OwnTable</MapStrategy>
            </ClassMap>
        </ECCustomAttributes>
    </ECEntityClass>

    <ECEnumeration typeName="Operation" backingTypeName="int" isStrict="true">
        <ECEnumerator value="1" displayLabel="Insert"/>
        <ECEnumerator value="2" displayLabel="Update"/>
        <ECEnumerator value="3" displayLabel="Delete"/>
    </ECEnumeration>

    <ECEntityClass typeName="Instance" displayLabel="Instance Change" modifier="Sealed" description="Represents an instance change in a change summary">
        <ECCustomAttributes>
            <ClassMap xmlns="ECDbMap.02.00">
                <MapStrategy>OwnTable</MapStrategy>
            </ClassMap>
            <DbIndexList xmlns="ECDbMap.02.00">
                <Indexes>
                    <DbIndex>
                        <Name>uix_change_Instance_IdOfChangedInstance_ClassIdOfChangedInstance</Name>
                        <IsUnique>True</IsUnique>
                        <Properties>
                            <string>IdOfChangedInstance</string>
                            <string>ClassIdOfChangedInstance</string>
                        </Properties>
                    </DbIndex>
                </Indexes>
            </DbIndexList>
        </ECCustomAttributes>
        <ECProperty propertyName="IdOfChangedInstance" typeName="long" />
        <ECProperty propertyName="ClassIdOfChangedInstance" typeName="long" />
        <ECProperty propertyName="Operation" typeName="Operation"/>
        <ECProperty propertyName="IsIndirect" typeName="bool" description="Change happened due to a foreign key action or trigger"/>
        <ECProperty propertyName="TableName" typeName="string"/>
        <ECNavigationProperty propertyName="Summary" relationshipName="SummaryContainsInstanceChanges" direction="backward" />
    </ECEntityClass>
    
    <ECEntityClass typeName="PropertyValue" displayLabel="Property Value Change" modifier="Sealed" description="Represents an property value change of an instance change in a change summary">
        <ECCustomAttributes>
            <ClassMap xmlns="ECDbMap.02.00">
                <MapStrategy>OwnTable</MapStrategy>
            </ClassMap>
            <DbIndexList xmlns="ECDbMap.02.00">
                <Indexes>
                    <DbIndex>
                        <Name>uix_change_PropertyValue_InstanceId_AccessString</Name>
                        <IsUnique>True</IsUnique>
                        <Properties>
                            <string>Instance.Id</string>
                            <string>AccessString</string>
                        </Properties>
                    </DbIndex>		
                </Indexes>
            </DbIndexList>            
        </ECCustomAttributes>	
        <ECProperty propertyName="AccessString" typeName="string"/>
        <ECProperty propertyName="RawOldValue" typeName="binary" description="Untyped old value"/>
        <ECProperty propertyName="RawNewValue" typeName="binary" description="Untyped new value"/>
        <ECNavigationProperty propertyName="Instance" relationshipName="InstanceChangeOwnsPropertyValueChanges" direction="backward"/>
    </ECEntityClass>
    
    <ECRelationshipClass typeName="SummaryContainsInstanceChanges" modifier="Sealed" strength="embedding">
        <Source multiplicity="(1..1)" roleLabel="has" polymorphic="false">
            <Class class="Summary"/>
        </Source>
        <Target multiplicity="(0..*)" roleLabel="is contained in" polymorphic="false">
            <Class class="Instance"/>
        </Target>
    </ECRelationshipClass>
    
    <ECRelationshipClass typeName="InstanceChangeOwnsPropertyValueChanges" modifier="Sealed" strength="embedding">
        <Source multiplicity="(1..1)" roleLabel="owns" polymorphic="false">
            <Class class="Instance"/>
        </Source>
        <Target multiplicity="(0..*)" roleLabel="is contained in" polymorphic="false">
            <Class class="PropertyValue"/>
        </Target>
    </ECRelationshipClass>
</ECSchema>
