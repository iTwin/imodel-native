<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../bsicommon/build/PartFile.xsd">

    <!-- The delivers the "Napi/napi.h" source files. -->
    <Part Name="VendorAPI" BentleyBuildMakeFile="prewire.mke" >
        <Bindings>
            <VendorAPI Domain="Napi"/>
        </Bindings>
    </Part>

    <!-- on Windows, builds napi.lib and all three napi.dll (stub, node, and electron), on other platforms builds stub .a and (for non-static builds) .so  -->
    <Part Name="napi-stub-build" BentleyBuildMakeFile="node-addon-lib.mke">
        <SubPart PartName="VendorAPI"/>
    </Part>

    <!-- only on Windows, binds the napi.lib file needed for linking -->
    <Part Name="napi-lib-win" OnlyPlatforms="x64,winrt*">
        <SubPart PartName="napi-stub-build" />
        <Bindings>
            <Libs>Delivery/$(stlibprefix)napi$(stlibext)</Libs>
        </Bindings>
    </Part>

    <!-- only on non-Windows, binds the stub .a file  -->
    <Part Name="napi-lib-nonwin" ExcludePlatforms="x64,winrt*">
        <SubPart PartName="napi-stub-build" />
        <Bindings>
            <Libs>Delivery/$(stlibprefix)napi$(stlibext)</Libs>
        </Bindings>
    </Part>

    <Part Name="napi-lib">
        <SubPart PartName="napi-lib-win" />
        <SubPart PartName="napi-lib-nonwin" />
    </Part>

    <!-- bind the Node version of napi.dll on Windows only -->
    <Part Name="napi-dll-win" OnlyPlatforms="x64,winrt*">
        <SubPart PartName="napi-stub-build" />
        <Bindings>
            <Files ProductDirectoryName="Assemblies" ProductSubDirectory="Node" SubPartDirectory="Node">Delivery/Node/napi.dll</Files>
            <Files ProductDirectoryName="Assemblies" ProductSubDirectory="Electron" SubPartDirectory="Electron">Delivery/Electron/napi.dll</Files>
        </Bindings>
    </Part>

    <!-- Only Tests and parts that DON'T want to run JavaScript should use this part. It binds the stub .dll/.a file -->
    <Part Name="napi-stub">
        <SubPart PartName="napi-lib"/>
        <Bindings>
            <Assemblies>Delivery/$(shlibprefix)napi$(shlibext)</Assemblies>
        </Bindings>
    </Part>

</BuildContext>
