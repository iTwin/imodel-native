#----------------------------------------------------------------------------------------
#
#  $Source: ScalableMeshHandler/handler.mke $
#
#  $Copyright: (c) 2016 Bentley Systems, Incorporated. All rights reserved. $
#
#----------------------------------------------------------------------------------------
%include  mdl.mki

baseDir             = $(_MakeFilePath)
appName             = ScalableMeshHandler
o                   = $(OutputRootDir)build/$(appName)/


#----------------------------------------------------------------------
#       Create output directories
#----------------------------------------------------------------------
always:
    !~@mkdir $(o)

#----------------------------------------------------------------------
#   Symlink APIs
#----------------------------------------------------------------------
always:
   @CreateSymLinks.py -d"$(BuildContext)PublicAPI/ScalableMeshHandler=$(_MakeFilePath)/PublicAPI"

#----------------------------------------------------------------------
#       Inform user of compile options
#----------------------------------------------------------------------
always:
        |  Compiler options: $(cDefs)$(cDefsPost) $(copt) $(cIncs) $(PublicApiIncludes) $(CCompOpts)
        |  -------- --------

#----------------------------------------------------------------------
#   Build precompiled header
#----------------------------------------------------------------------
CCompOpts + -DNOMINMAX -D__SCM_HANDLERS_BUILD__

MultiCompileDepends=$(_MakeFileSpec) 
%include MultiCppCompileRule.mki


$(o)ScalableMeshModel$(oext) : $(baseDir)ScalableMeshHandler/ScalableMeshModel.cpp ${MultiCompileDepends}

$(o)ScalableMeshProgressiveDisplay$(oext) : $(baseDir)ScalableMeshHandler/ScalableMeshProgressiveDisplay.cpp ${MultiCompileDepends}

$(o)QvCachedNodeManager$(oext) : $(baseDir)ScalableMeshHandler/QvCachedNodeManager.cpp ${MultiCompileDepends}

%include MultiCppCompileGo.mki

# dlmlink.mki common options.
DLM_OBJECT_FILES            = $(MultiCompileObjectList)
DLM_DEST                    = $(o)
DLM_SYMB_DEST               = $(o)
DLM_EXPORT_DEST             = $(o)
DLM_OBJECT_DEST             = $(o)
DLM_NOENTRY                 = 1
DLM_NAME                    = $(appName)
CCompPDBName                = $(appName)



LINKER_LIBRARIES_DELAYLOADED  = \
    $(ContextSubpartsLibs)DgnPlatform.lib \
    $(ContextSubpartsLibs)ScalableMesh.lib \
    $(ContextSubpartsLibs)BaseGeoCoord.lib 

LINKER_LIBRARIES            = \
    $(ContextSubpartsLibs)$(libprefix)ImagePP$(libext) \
    $(ContextSubpartsLibs)$(libprefix)BentleyGeom$(libext) \
    $(ContextSubpartsLibs)$(libprefix)TerrainModelCore$(libext) \
    $(ContextSubpartsLibs)$(libprefix)TerrainModelFormats$(libext)

%include $(sharedMki)LinkLibrary.mki

