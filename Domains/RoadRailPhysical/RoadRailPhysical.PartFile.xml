<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">

    <Part Name="RoadRailPhysical" BentleyBuildMakeFile="RoadRailPhysical.mke">
        <SubPart PartName="PublicAPI"/>
        <SubPart PartName="RoadRailAlignment"  PartFile="Domains/RoadRailAlignment/RoadRailAlignment"  Repository="imodel02" />
        <Bindings>
            <Libs Required="false">Delivery/$(libprefix)RoadRailPhysical$(libext)</Libs>
            <Assemblies Required="false">Delivery/$(shlibprefix)RoadRailPhysical$(shlibext)</Assemblies>
        </Bindings>
    </Part>

    <Part Name="PublicAPI" BentleyBuildMakeFile="RoadRailPhysical.prewire.mke">
        <SubPart PartName="RoadRailPhysicalSchema" PartFile="BisSchemasIModelCore" Repository="BisSchemas"/>
        <Bindings>
            <PublicAPI Domain="RoadRailPhysical"/>
        </Bindings>
    </Part>

    <Part Name="RoadRailPhysicalPublishedApi" BentleyBuildMakeFile="${SrcRoot}bsicommon/sharedmki/PublishApi.mke"
          BMakeOptions="+dPUBLISHAPI_DELIVERY_DIR=Delivery/PublishedApi +dPUBLISHAPI_VENDORAPI2=rapidjson">
        <SubPart PartName="RoadRailPhysical"/>
        <Bindings>
            <Directory SourceName="Delivery/PublishedApi" SubPartDirectory="PublishedApi/RoadRailPhysical"/>
        </Bindings>
    </Part>

    <Part Name="RoadRailPhysicalExtractions" DeferType="BuildDocs" BentleyBuildMakeFile="docs/RoadRailPhysicalExtractions.mke">
        <SubPart PartName="RoadRailPhysicalPublishedApi" />
        <Bindings>
            <Directory SourceName="Dox/Extractions/RoadRailPhysical" SubPartDirectory="Dox/Extractions/RoadRailPhysical" />
        </Bindings>
    </Part>

    <!-- ********************************************************************************************** -->
    <!-- Unit tests -->
    <!-- ********************************************************************************************** -->
    <Part Name="PrewireForUnitTests" BentleyBuildMakeFile="Tests/prewire.mke">
        <Bindings>
            <Files ProductDirectoryName="UnitTests-IgnoreList"  ProductSubDirectory="RoadRailPhysical" SubPartDirectory="UnitTests/RoadRailPhysical"> Delivery/UnitTests/ignore_list.txt</Files>
        </Bindings>
    </Part>

    <Part Name="BackdoorForUnitTests" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Backdoor">
        <SubPart PartName="RoadRailPhysical"/>
        <SubPart PartName="PrewireForUnitTests" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    ProductSubDirectory="RoadRailPhysical/Backdoor" SourceName="Delivery/UnitTests/Objects/Backdoor"/>
        </Bindings>
    </Part>

    <Part Name="UnitTests-NonPublished" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=NonPublished">
        <SubPart PartName="BackdoorForUnitTests" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    ProductSubDirectory="RoadRailPhysical/NonPublished" SourceName="Delivery/UnitTests/Objects/NonPublished"/>
        </Bindings>
    </Part>

    <Part Name="UnitTests-Published" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Published">
        <SubPart PartName="BackdoorForUnitTests" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    ProductSubDirectory="RoadRailPhysical/Published" SourceName="Delivery/UnitTests/Objects/Published"/>
        </Bindings>
    </Part>

    <!-- Define the collection of all unit tests. -->
    <Part Name="Tests">
        <!-- Specify the unit tests to include in the test suite: -->
        <SubPart PartName="UnitTests-NonPublished"/>
        <SubPart PartName="UnitTests-Published"/>
    </Part>

    <Product Name="RoadRailPhysical-Tests">
        <!-- *** TRICKY: Must depend on a part in begtest repository, in order to use a productdirectorylist from there. -->
        <SubPart Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest" PartName="Base" />
        <SubPart PartName="Tests"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <!-- Lay out the Tests test product according to the standard BeGTest layout: -->
        <Directories Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest" DirectoryListName="CollectionProduct"/>
        <Directories DirectoryListName="Tests"/>
    </Product>

    <ProductDirectoryList ListName="Tests">
        <ProductDirectory Name="ApplicationRoot" Path=""/>
    </ProductDirectoryList>

    <!-- Build a gtest exe to run the tests -->
    <Product Name="Gtest-RoadRailPhysical-Tests">
        <Directories DirectoryListName="GtestProduct" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
        <SubPart PartName="Gtest"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
    </Product>

    <Part Name="Gtest" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/gtest/buildGTest.mke" DeferType="BuildUnitTests" BentleyBuildMakeOptions="-dTEST_NAME=RoadRailPhysicalTests -dTEST_COLLECTION_PRODUCT=RoadRailPhysical-Tests -dTEST_FRAMEWORK_SQLANG=RoadRailPhysical_en.sqlang.db3" OnlyPlatforms="x86,x64,MacOs*,Linux*">
        <SubProduct ProductName="RoadRailPhysical-Tests"/>
        <SubPart PartName="Gtest-Tools" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
        <Bindings>
            <Files ProductDirectoryName="Gtest-NativeAssemblies">Delivery/Gtest/RoadRailPhysicalTests/Assemblies/*</Files>
            <Directory ProductDirectoryName="Gtest-Assets" SourceName="Delivery/Gtest/RoadRailPhysicalTests/Assets" />
        </Bindings>
    </Part>

    <Part Name="RunGtest" DeferType="RunUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/gtest/RunGTest.mke" BentleyBuildMakeOptions="-dGTEST_PRODUCT=Gtest-RoadRailPhysical-Tests -dGTEST_NAME=RoadRailPhysicalTests -dGTEST_SHOW_PROGRESS" OnlyPlatforms="x86,x64,MacOs*,Linux*">
        <SubProduct ProductName="Gtest-RoadRailPhysical-Tests" />
        <SubPart PartName="Gtest-Tools" Repository="imodel02" PartFile="iModelCore/BeGTest/BeGTest"/>
    </Part>

    <!-- This part runs RoadRailPhysicalTests on platforms that support it. -->
    <Part Name="RoadRailPhysical-Tested">
        <SubPart PartName="RunGtest" />
    </Part>

</BuildContext>