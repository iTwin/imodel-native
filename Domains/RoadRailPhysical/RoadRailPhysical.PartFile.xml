<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">

    <Part Name="RoadRailPhysical" BentleyBuildMakeFile="RoadRailPhysical.mke">
        <SubPart PartName="PublicAPI"/>
        <SubPart PartName="RoadRailAlignment"  PartFile="RoadRailAlignment"  Repository="DgnDomains-RoadRailAlignment" />
        <Bindings>
            <Libs Required="false">Delivery/$(libprefix)RoadRailPhysical$(libext)</Libs>
            <Assemblies Required="false">Delivery/$(shlibprefix)RoadRailPhysical$(shlibext)</Assemblies>
        </Bindings>
    </Part>

    <Part Name="PublicAPI" BentleyBuildMakeFile="RoadRailPhysical.prewire.mke">
        <SubPart PartName="RoadRailPhysicalSchema" PartFile="BisSchemas" Repository="BisSchemas"/>
        <Bindings>
            <PublicAPI Domain="RoadRailPhysical"/>
        </Bindings>
    </Part>

    <Part Name="RoadRailPhysicalPublishedApi" BentleyBuildMakeFile="${SrcRoot}bsicommon/sharedmki/PublishApi.mke"
          BMakeOptions="+dPUBLISHAPI_DELIVERY_DIR=Delivery/PublishedApi +dPUBLISHAPI_VENDORAPI2=rapidjson">
        <SubPart PartName="RoadRailPhysical"/>
        <Bindings>
            <Directory SourceName="Delivery/PublishedApi" SubPartDirectory="PublishedApi/RoadRailPhysical"/>
        </Bindings>
    </Part>

    <Part Name="RoadRailPhysicalExtractions" DeferType="BuildDocs" BentleyBuildMakeFile="docs/RoadRailPhysicalExtractions.mke">
        <SubPart PartName="RoadRailPhysicalPublishedApi" />
        <Bindings>
            <Directory SourceName="Dox/Extractions/RoadRailPhysical" SubPartDirectory="Dox/Extractions/RoadRailPhysical" />
        </Bindings>
    </Part>

    <!-- ********************************************************************************************** -->
    <!-- Unit tests -->
    <!-- ********************************************************************************************** -->
    <Part Name="PrewireForUnitTests" BentleyBuildMakeFile="Tests/prewire.mke">
        <Bindings>
            <Files ProductDirectoryName="UnitTests-IgnoreList"  ProductSubDirectory="RoadRailPhysical" SubPartDirectory="UnitTests/RoadRailPhysical"> Delivery/UnitTests/ignore_list.txt</Files>
        </Bindings>
    </Part>

    <Part Name="BackdoorForUnitTests" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Backdoor">
        <SubPart PartName="RoadRailPhysical"/>
        <SubPart PartName="PrewireForUnitTests" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    ProductSubDirectory="RoadRailPhysical/Backdoor" SourceName="Delivery/UnitTests/Objects/Backdoor"/>
        </Bindings>
    </Part>

    <Part Name="UnitTests-NonPublished" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=NonPublished">
        <SubPart PartName="BackdoorForUnitTests" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    ProductSubDirectory="RoadRailPhysical/NonPublished" SourceName="Delivery/UnitTests/Objects/NonPublished"/>
        </Bindings>
    </Part>

    <Part Name="UnitTests-Published" BentleyBuildMakeFile="Tests/BuildTests.mke" BentleyBuildMakeOptions="-dTestDir=Published">
        <SubPart PartName="BackdoorForUnitTests" />
        <Bindings>
            <Directory ProductDirectoryName="UnitTests-Objects"    ProductSubDirectory="RoadRailPhysical/Published" SourceName="Delivery/UnitTests/Objects/Published"/>
        </Bindings>
    </Part>

    <!-- Define the collection of all unit tests. -->
    <Part Name="Tests">
        <!-- Specify the unit tests to include in the test suite: -->
        <SubPart PartName="UnitTests-NonPublished"/>
        <SubPart PartName="UnitTests-Published"/>
    </Part>

    <Product Name="RoadRailPhysical-Tests">
        <!-- *** TRICKY: Must depend on a part in begtest repository, in order to use a productdirectorylist from there. -->
        <!-- <SubPart Repository="BeGTest" PartFile="BeGTest" PartName="Base" /> -->
        <SubPart PartName="iModelBridgeFwk" PartFile="NativeNugets/NativeNugets" Repository="BsiCommon"/>
        <SubPart PartName="Tests"/>
        <!-- Lay out the Tests test product according to the standard BeGTest layout: -->
        <!-- <Directories Repository="BeGTest" PartFile="BeGTest" DirectoryListName="CollectionProduct"/> -->
        <Directories DirectoryListName="CollectionProduct"/>
        <Directories DirectoryListName="Tests"/>
    </Product>

  <ProductDirectoryList ListName="CollectionProduct">
    <ProductDirectory Name="Assemblies"            Path="Assemblies"/>
    <ProductDirectory Name="Assemblies"            Deliver="false" LibType="static"/>
    <ProductDirectory Name="DataCaptureAssemblies"              Path="Assemblies"/>
    <ProductDirectory Name="DataCaptureAssemblies"              Deliver="false" LibType="static"/>
    <ProductDirectory Name="Libs"                               Path="Libs"/>
    <ProductDirectory Name="Libs"                               Path="Libs" LibType="static"/>
    <ProductDirectory Name="BeStaticLibDir"                     Path="Libs"/>
    <ProductDirectory Name="BeStaticLibDir"                     Path="Libs" LibType="static"/>
    <ProductDirectory Name="BeJsonCppStaticLibDir"              Path="Libs"/>
    <ProductDirectory Name="BeJsonCppStaticLibDir"              Path="Libs" LibType="static"/>
    <ProductDirectory Name="UnitTests-Objects"                  Path="Objects"/>
    <ProductDirectory Name="UnitTests-Objects"                  Path="Objects" LibType="static"/>
    <ProductDirectory Name="Assets"                             Path="Assets"/>
    <ProductDirectory Name="Assets"                             Path="Assets"  LibType="static"/>
    <ProductDirectory Name="UnitTests-Assets"                   Path="Assets"/>
    <ProductDirectory Name="UnitTests-Assets"                   Path="Assets" LibType="static"/>
    <ProductDirectory Name="UnitTests-IgnoreList"               Path="Assets/Ignore"/>
    <ProductDirectory Name="UnitTests-IgnoreList"               Path="Assets/Ignore" LibType="static"/>
    <ProductDirectory Name="UnitTests-Documents-DgnDb"          Path="Assets/Documents/DgnDb"/>
    <ProductDirectory Name="UnitTests-Documents-DgnDb"          Path="Assets/Documents/DgnDb" LibType="static"/>
    <ProductDirectory Name="UnitTests-ECDbTestData"             Path="Assets/Documents/ECDb" />
    <ProductDirectory Name="UnitTests-ECDbTestData"             Path="Assets/Documents/ECDb" LibType="static"/>
    <ProductDirectory Name="UnitTests-GeomLibsTestData"         Path="Assets/Documents/GeomLibsTestData"/>
    <ProductDirectory Name="UnitTests-GeomLibsTestData"         Path="Assets/Documents/GeomLibsTestData" LibType="static"/>

    <ProductDirectory Name="UnitTests-BeSQLiteTestData"         Path="Assets/BeSQLiteTestData"/>
    <ProductDirectory Name="UnitTests-BeSQLiteTestData"         Path="Assets/BeSQLiteTestData" LibType="static"/>
    <ProductDirectory Name="ECObjectsTestSeedData"              Path="Assets/SeedData"/>
    <ProductDirectory Name="ECObjectsTestSeedData"              Path="Assets/SeedData" LibType="static"/>
    <ProductDirectory Name="ECObjectsTestSeedDataPK"            Path="Assets/SeedData/ur-PK"/>
    <ProductDirectory Name="ECObjectsTestSeedDataPK"            Path="Assets/SeedData/ur-PK" LibType="static"/>
    <ProductDirectory Name="ECObjectsTestSeedDataGB"            Path="Assets/SeedData/en-GB"/>
    <ProductDirectory Name="ECObjectsTestSeedDataGB"            Path="Assets/SeedData/en-GB" LibType="static"/>
    <ProductDirectory Name="ECObjectsTestSeedDataIT"            Path="Assets/SeedData/it"/>
    <ProductDirectory Name="ECObjectsTestSeedDataIT"            Path="Assets/SeedData/it" LibType="static"/>
    <ProductDirectory Name="ECObjectsTestSeedDataV3Conversion"  Path="Assets/SeedData/V3Conversion" />
    <ProductDirectory Name="ECObjectsTestSeedDataV3Conversion"  Path="Assets/SeedData/V3Conversion" LibType="static"/>
    <ProductDirectory Name="ECObjectsTestSeedDataECJson"        Path="Assets/SeedData/ECJson"/>
    <ProductDirectory Name="ECObjectsTestSeedDataECJson"        Path="Assets/SeedData/ECJson" LibType="static"/>

    <ProductDirectory Name="WSClientTestAssets"                 Path="Assets/WSClientTestAssets"/>
    <ProductDirectory Name="WSClientTestAssets"                 Path="Assets/WSClientTestAssets" LibType="static"/>

    <ProductDirectory Name="DgnDisplayTestData"                 Path="Assets/DgnDisplayTestData"/>
    <ProductDirectory Name="DgnDisplayTestData"                 Path="Assets/DgnDisplayTestData" LibType="static"/>

    <ProductDirectory Name="PlantDomainSchemasDir" Path="Assets/ECSchemas/Domain"/>

    <ProductDirectory Name="VendorNotices" Deliver="false" />
    <ProductDirectory Name="VendorNotices" Deliver="false" LibType="static" />
    <ProductDirectory Name="DgnClientFxSampleCode" Deliver="false"/>
    <ProductDirectory Name="DgnClientFxSampleCode" Deliver="false" LibType="static"/>
    <ProductDirectory Name="MavenDependencies" Deliver="false" LibType="static" />
    <ProductDirectory Name="cpprestsdkAssemblies" Deliver="false"/>
    <ProductDirectory Name="wastorageAssemblies" Deliver="false"/>
    <ProductDirectory Name="PlantDomainAssembliesDir" Deliver="false"/>
    <ProductDirectory Name="sqlang" Path="Assets/sqlang"/>
    <ProductDirectory Name="sqlang" LibType="static" Path="Assets/sqlang"/>
    <ProductDirectory Name="AndroidSO" LibType="static" Deliver="false"/>
    <ProductDirectory Name="PublisherLoggingConfigXml" Deliver="false"/>
    <ProductDirectory Name="PublisherLoggingConfigXml" Deliver="false" LibType="static"/>

    <ProductDirectory Name="TestingProjects-Documents-DgnDb" Path="Assets/Documents/DgnClientFxTestData"/>
    <ProductDirectory Name="TestingProjects-Documents-DgnDb" Path="Assets/Documents/DgnClientFxTestData" LibType="static"/>
    <ProductDirectory Name="TestingProjects_Documents_DgnDb" Deliver="false"/>
    <ProductDirectory Name="TestingProjects_Documents_DgnDb" Deliver="false" LibType="static"/>

  </ProductDirectoryList>

    <ProductDirectoryList ListName="Tests">
        <ProductDirectory Name="ApplicationRoot" Path=""/>
    </ProductDirectoryList>

    <!-- Build a gtest exe to run the tests -->
    <Product Name="Gtest-RoadRailPhysical-Tests">
        <!-- <Directories DirectoryListName="GtestProduct" Repository="BeGTest" PartFile="BeGTest"/> -->
        <Directories DirectoryListName="GtestProduct"/>
        <SubPart PartName="iModelBridgeFwk" PartFile="NativeNugets/NativeNugets" Repository="BsiCommon"/>
        <SubPart PartName="Gtest"/>
    </Product>

  <ProductDirectoryList ListName="GtestProduct">
    <ProductDirectory Name="Assemblies" Path=""/>
    <ProductDirectory Name="Assemblies" Path="" LibType="Static"/>
    <ProductDirectory Name="Assets" Path="Assets"/>
    <ProductDirectory Name="Assets" Path="Assets" LibType="static"/>
    <ProductDirectory Name="VendorNotices" Deliver="false" />
    <ProductDirectory Name="VendorNotices" Deliver="false" LibType="static" />
  </ProductDirectoryList>

    <Part Name="Gtest" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/gtest/buildGTest.mke" DeferType="BuildUnitTests" BentleyBuildMakeOptions="-dTEST_NAME=RoadRailPhysicalTests -dTEST_COLLECTION_PRODUCT=RoadRailPhysical-Tests -dTEST_FRAMEWORK_SQLANG=RoadRailPhysical_en.sqlang.db3" OnlyPlatforms="x86,x64,MacOs*,Linux*">
        <SubProduct ProductName="RoadRailPhysical-Tests"/>
        <!-- <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/> -->
        <SubPart PartName="iModelBridgeFwk" PartFile="NativeNugets/NativeNugets" Repository="BsiCommon"/>
        <Bindings>
            <Files ProductDirectoryName="Gtest-NativeAssemblies">Delivery/Gtest/RoadRailPhysicalTests/Assemblies/*</Files>
            <Directory ProductDirectoryName="Gtest-Assets" SourceName="Delivery/Gtest/RoadRailPhysicalTests/Assets" />
        </Bindings>
    </Part>

    <Part Name="RunGtest" DeferType="RunUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/gtest/RunGTest.mke" BentleyBuildMakeOptions="-dGTEST_PRODUCT=Gtest-RoadRailPhysical-Tests -dGTEST_NAME=RoadRailPhysicalTests -dGTEST_SHOW_PROGRESS" OnlyPlatforms="x86,x64,MacOs*,Linux*">
        <SubProduct ProductName="Gtest-RoadRailPhysical-Tests" />
        <!-- <SubPart PartName="Gtest-Tools" Repository="BeGTest" PartFile="BeGTest"/> -->
        <SubPart PartName="iModelBridgeFwk" PartFile="NativeNugets/NativeNugets" Repository="BsiCommon"/>
    </Part>

    <!-- This part runs RoadRailPhysicalTests on platforms that support it. -->
    <Part Name="RoadRailPhysical-Tested">
        <SubPart PartName="RunGtest" />
    </Part>

</BuildContext>