<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">
  
    <Part Name="DwgBridgePRG" PrgOutputDir="DwgBridge">
        <SubProduct ProductName="RealDwgBridge"/>
        <!-- In an effort to reduce CI Pipeline build time, OpenDwgBridge is moved into dev build, until it is needed again -->
        <SubNuGetProduct NuGetProductName="RealDwgBridgeSdkNuget"/>
        <SubPart PartName="RunDwgImporterTests" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter"/>
    </Part>

    <Part Name="DwgBridge.Dev" PrgOutputDir="DwgBridge">
        <SubPart PartName="DwgBridgePRG"/>
        <SubProduct ProductName="OpenDwgBridge"/>
        <SubNuGetProduct NuGetProductName="OpenDwgBridgeSdkNuget"/>
    </Part>


    <!-- A product installer for DwgBridge using OpenDWG -->
    <Product Name="OpenDwgBridge" SaveProduct="true" BuildInstallSet="true">
        <SubPart PartName="OpenDwgImportExe" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter"/>
        <SubPart PartName="iModelBridgeFwkExe" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge"/>
        <SubPart PartName="MakePackages" PartFile="iModelBridgeCore/DgnDbSync/bridge-addon"/>
        <SubPart PartName="Eula" PartFile="Eula" Repository="Miscdev-Eula"/>
        <SubPart PartName="InstallFrameworkBase" PartFile="InstallFramework" Repository="InstallFramework"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <SubPart PartName="OpenDwgInstallFiles" />

        <Directories DirectoryListName="OpenDwgConverterDirList" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter"/>
        <Directories DirectoryListName="DwgAppCommonDirList"  PartFile="iModelBridgeCore/DgnDbSync/DwgConverter"/>

        <InstallerWixFile SourceFile="installers\OpenDwgImporter"/>
        <WixBundleFile    SourceFile="installers\OpenDwgBundle"/>
    </Product>

    <Part Name="OpenDwgInstallFiles" BMakeFile="installers/OpenDwgInstallerFiles.prewire.mke" >
        <Bindings>
            <Files BindToWixBuild="true">
                OpenDwgInstallerFiles\OpenDwgBundle.bundle.wxs
                OpenDwgInstallerFiles\OpenDwgRegistryFrag.wxs
                OpenDwgInstallerFiles\OpenDwgInstaller.mki
                OpenDwgInstallerFiles\BundleOpenDwgInstaller.mki
            </Files>
        </Bindings>
    </Part>


    <!-- An SDK zip delivery for DwgBridge using OpenDWG -->
    <NuGetProduct Name="OpenDwgBridgeSdkNuget" OnlyPlatforms="x64" Description="An iModelBridge-DWG extension SDK based on ODA-Drawing toolkit">
        <SubPart PartName="OpenDwgImportDLL" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="OpenDwgBridgeDLL" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="OpenDwgDb" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="Docs" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="CodeSamples" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="DwgImporterHeaderDelivery" />
        <Directories DirectoryListName="OpenDwgBridgeSdkDirList"/>
        <Directories DirectoryListName="DwgSdkCommonDirList"/>
    </NuGetProduct>

    <ProductDirectoryList ListName="OpenDwgBridgeSdkDirList">
        <ProductDirectory Name="ApplicationRoot"    Path="DwgImporterSDK"/>
        <ProductDirectory Name="OpenDwgDbLibs"      RelativeTo="ApplicationRoot" Path="Libs"/>
        <ProductDirectory Name="OpenDwgDbAssemblies" RelativeTo="ApplicationRoot" Path="Dlls"/>
        <ProductDirectory Name="OpenDwgImportAssemblies" RelativeTo="ApplicationRoot" Path="Dlls"/>
        <ProductDirectory Name="RealDwgDbLibs"      Deliver="false"/>
        <ProductDirectory Name="RealDwgDbAssemblies" Deliver="false"/>
        <ProductDirectory Name="RealDwgImportAssemblies" Deliver="false"/>
    </ProductDirectoryList>


    <!-- A product installer for DwgBridge using RealDWG -->
    <Product Name="RealDwgBridge" SaveProduct="true" BuildInstallSet="true">
        <SubPart PartName="RealDwgImportExe" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter"/>
        <SubPart PartName="iModelBridgeFwkExe" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge"/>
        <SubPart PartName="MakePackages" PartFile="iModelBridgeCore/DgnDbSync/bridge-addon"/>
        <SubPart PartName="Redistribute" PartFile="${SrcRoot}bsicommon/CvsPartFiles/realdwg" Repository="bin-realdwg" />
        <SubPart PartName="Eula" PartFile="Eula" Repository="Miscdev-Eula"/>
        <SubPart PartName="InstallFrameworkBase" PartFile="InstallFramework" Repository="InstallFramework"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <SubPart PartName="RealDwgInstallFiles" />

        <Directories DirectoryListName="RealDwgConverterDirList"  PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="DwgAppCommonDirList"  PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>

        <InstallerWixFile SourceFile="installers\RealDwgImporter"/>
        <WixBundleFile    SourceFile="installers\RealDwgBundle"/>
    </Product>

    <Part Name="RealDwgInstallFiles" BMakeFile="installers/RealDwgInstallerFiles.prewire.mke" >
        <Bindings>
            <Files BindToWixBuild="true">
                RealDwgInstallerFiles\RealDwgBundle.bundle.wxs
                RealDwgInstallerFiles\DwgMergeModuleFrag.wxs
                RealDwgInstallerFiles\DwgRegistryFrag.wxs
                RealDwgInstallerFiles\RealDwgInstaller.mki
                RealDwgInstallerFiles\BundleRealDwgInstaller.mki
            </Files>
        </Bindings>
    </Part>


    <!-- An SDK zip delivery for DwgBridge using RealDWG -->
    <NuGetProduct Name="RealDwgBridgeSdkNuget" OnlyPlatforms="x64" Description="An iModelBridge-DWG extension SDK based on RealDWG toolkit">
        <SubPart PartName="RealDwgImportDLL" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="RealDwgBridgeDLL" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="RealDwgDb" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="Docs" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="CodeSamples" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="DwgImporterHeaderDelivery" />
        <Directories DirectoryListName="RealDwgBridgeSdkDirList"/>
        <Directories DirectoryListName="DwgSdkCommonDirList"/>
    </NuGetProduct>

    <Part Name="DwgImporterHeaderDelivery">
        <SubPart PartName="PublicAPI" PartFile="iModelBridgeCore/DgnDbSync/DwgConverter" Repository="imodel02"/>
        <Bindings>
            <Directory SourceName="PublicAPI/Dwg" ProductDirectoryName="DwgImportHeaders"/>
        </Bindings>
    </Part>

    <ProductDirectoryList ListName="RealDwgBridgeSdkDirList">
        <ProductDirectory Name="ApplicationRoot"        Path="DwgImporterSDK"/>
        <ProductDirectory Name="RealDwgDbLibs"          RelativeTo="ApplicationRoot" Path="Libs"/>
        <ProductDirectory Name="RealDwgDbAssemblies"    RelativeTo="ApplicationRoot" Path="Dlls"/>
        <ProductDirectory Name="RealDwgImportAssemblies" RelativeTo="ApplicationRoot" Path="Dlls"/>
        <ProductDirectory Name="OpenDwgDbLibs"          Deliver="false"/>
        <ProductDirectory Name="OpenDwgDbAssemblies"    Deliver="false"/>
        <ProductDirectory Name="OpenDwgImportAssemblies" Deliver="false"/>
    </ProductDirectoryList>

    <ProductDirectoryList ListName="DwgSdkCommonDirList">
        <ProductDirectory Name="ApplicationRoot"        Path="DwgImporterSDK"/>
        <ProductDirectory Name="DwgImportHeaders"       RelativeTo="ApplicationRoot" Path="PublicAPI/Dwg"/>
        <ProductDirectory Name="DwgImporterDocs"        RelativeTo="ApplicationRoot" Path="Docs"/>
        <ProductDirectory Name="SampleXData"            RelativeTo="ApplicationRoot" Path="Samples/XData"/>
        <ProductDirectory Name="SampleListProp"         RelativeTo="ApplicationRoot" Path="Samples/ListProperty"/>
        <!-- dependent list -->
        <ProductDirectory Name="Assets"                 RelativeTo="ApplicationRoot" Path="Assets" LibType="dynamic"/>
        <ProductDirectory Name="Assets"                 RelativeTo="ApplicationRoot" Path="Assets" LibType="static"/>
        <ProductDirectory Name="VendorNotices"          RelativeTo="ApplicationRoot" Path="Notices" LibType="dynamic"/>
        <ProductDirectory Name="VendorNotices"          RelativeTo="ApplicationRoot" Path="Notices" LibType="Static"/>
        <ProductDirectory Name="BentleyEulaDelivery"    RelativeTo="ApplicationRoot" Path="Notices"/>
        <ProductDirectory Name="PublicAPI"              RelativeTo="ApplicationRoot" Path="PublicAPI" LibType="dynamic"/>
        <ProductDirectory Name="PublicAPI"              RelativeTo="ApplicationRoot" Path="PublicAPI" LibType="static"/>
        <ProductDirectory Name="Libs"                   RelativeTo="ApplicationRoot" Path="Libs" LibType="dynamic"/>
        <ProductDirectory Name="Libs"                   RelativeTo="ApplicationRoot" Path="Libs" LibType="static"/>
        <ProductDirectory Name="Assemblies"             RelativeTo="ApplicationRoot" Path="Dlls" LibType="dynamic"/>
        <ProductDirectory Name="Assemblies"             RelativeTo="ApplicationRoot" Path="Dlls" LibType="static"/>
        <!-- exclude list -->
        <ProductDirectory Name="RealDwgAssemblies"      Deliver="false"/>
        <ProductDirectory Name="RealDwgAssembliesEnUS"  Deliver="false"/>
        <ProductDirectory Name="ShxFonts"               Deliver="false"/>
        <ProductDirectory Name="MergeModules"           Deliver="false"/>
        <ProductDirectory Name="DgnV8Dlls"              Deliver="false"/>
    </ProductDirectoryList>

</BuildContext>
