<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">
  
    <Part Name="DwgBridgePRG" PrgOutputDir="DwgBridge">
        <SubProduct ProductName="RealDwgBridge"/>
        <!-- In an effort to reduce CI Pipeline build time, OpenDwgBridge is moved into dev build, until it is needed again -->
        <SubNuGetProduct NuGetProductName="RealDwgBridgeSdkNuget"/>
        <SubPart PartName="RunDwgImporterTests" PartFile="Bridges/Dwg/DwgConverter/DwgConverter"/>
        <SubProduct ProductName="DwgBridgeTests"/>
    </Part>

    <Part Name="DwgBridge.Dev" PrgOutputDir="DwgBridge">
        <SubPart PartName="DwgBridgePRG"/>
        <SubProduct ProductName="OpenDwgBridge"/>
        <SubNuGetProduct NuGetProductName="OpenDwgBridgeSdkNuget"/>
    </Part>


    <!-- A product installer for DwgBridge using OpenDWG -->
    <Product Name="OpenDwgBridge" SaveProduct="true" BuildInstallSet="true">
        <SubPart PartName="OpenDwgImportExe" PartFile="Bridges/Dwg/DwgConverter/DwgConverter"/>
        <SubPart PartName="iModelBridgeFwkExe" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge"/>
        <SubPart PartName="MakePackages" PartFile="iModelBridgeCore/DgnDbSync/bridge-addon"/>
        <SubPart PartName="Eula" PartFile="Eula" Repository="Miscdev-Eula"/>
        <SubPart PartName="InstallFrameworkBase" PartFile="InstallFramework" Repository="InstallFramework"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <SubPart PartName="OpenDwgInstallFiles" />

        <Directories DirectoryListName="OpenDwgConverterDirList" PartFile="Bridges/Dwg/DwgConverter/DwgConverter"/>
        <Directories DirectoryListName="DwgAppCommonDirList"  PartFile="Bridges/Dwg/DwgConverter/DwgConverter"/>

        <InstallerWixFile SourceFile="installers\OpenDwgImporter"/>
        <WixBundleFile    SourceFile="installers\OpenDwgBundle"/>
    </Product>

    <Part Name="OpenDwgInstallFiles" BMakeFile="installers/OpenDwgInstallerFiles.prewire.mke" >
        <Bindings>
            <Files BindToWixBuild="true">
                OpenDwgInstallerFiles\OpenDwgBundle.bundle.wxs
                OpenDwgInstallerFiles\OpenDwgRegistryFrag.wxs
                OpenDwgInstallerFiles\OpenDwgInstaller.mki
                OpenDwgInstallerFiles\BundleOpenDwgInstaller.mki
            </Files>
        </Bindings>
    </Part>


    <!-- An SDK zip delivery for DwgBridge using OpenDWG -->
    <NuGetProduct Name="OpenDwgBridgeSdkNuget" OnlyPlatforms="x64" Description="An iModelBridge-DWG extension SDK based on ODA-Drawing toolkit">
        <SubPart PartName="OpenDwgImportDLL" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="OpenDwgBridgeDLL" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="OpenDwgDb" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="Docs" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="Docs" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge" Repository="imodel02"/>
        <SubPart PartName="CodeSamples" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="DwgResources" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="iModelBridgeFwkLib" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge" Repository="imodel02"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api" Repository="imodel02"/>
        <SubPart PartName="DwgImporterHeaderDelivery"/>
        <SubPart PartName="NodeApiHeaderDelivery"/>
        <Directories DirectoryListName="OpenDwgBridgeSdkDirList"/>
        <Directories DirectoryListName="DwgSdkCommonDirList"/>
    </NuGetProduct>

    <ProductDirectoryList ListName="OpenDwgBridgeSdkDirList">
        <ProductDirectory Name="ApplicationRoot"    Path="DwgImporterSDK"/>
        <ProductDirectory Name="OpenDwgDbLibs"      RelativeTo="ApplicationRoot" Path="Libs"/>
        <ProductDirectory Name="OpenDwgDbAssemblies" RelativeTo="ApplicationRoot" Path="Dlls"/>
        <ProductDirectory Name="OpenDwgImportAssemblies" RelativeTo="ApplicationRoot" Path="Dlls"/>
        <ProductDirectory Name="RealDwgDbLibs"      Deliver="false"/>
        <ProductDirectory Name="RealDwgDbAssemblies" Deliver="false"/>
        <ProductDirectory Name="RealDwgImportAssemblies" Deliver="false"/>
    </ProductDirectoryList>


    <!-- A product installer for DwgBridge using RealDWG -->
    <Product Name="RealDwgBridge" SaveProduct="true" BuildInstallSet="true">
        <SubPart PartName="RealDwgImportExe" PartFile="Bridges/Dwg/DwgConverter/DwgConverter"/>
        <SubPart PartName="iModelBridgeFwkExe" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge"/>
        <SubPart PartName="MakePackages" PartFile="iModelBridgeCore/DgnDbSync/bridge-addon"/>
        <SubPart PartName="Redistribute" PartFile="${SrcRoot}bsicommon/CvsPartFiles/realdwg" Repository="bin-realdwg" />
        <SubPart PartName="Eula" PartFile="Eula" Repository="Miscdev-Eula"/>
        <SubPart PartName="InstallFrameworkBase" PartFile="InstallFramework" Repository="InstallFramework"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <SubPart PartName="RealDwgInstallFiles" />

        <Directories DirectoryListName="RealDwgConverterDirList"  PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="DwgAppCommonDirList"  PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>

        <InstallerWixFile SourceFile="installers\RealDwgImporter"/>
        <WixBundleFile    SourceFile="installers\RealDwgBundle"/>
    </Product>

    <Part Name="RealDwgInstallFiles" BMakeFile="installers/RealDwgInstallerFiles.prewire.mke" >
        <Bindings>
            <Files BindToWixBuild="true">
                RealDwgInstallerFiles\RealDwgBundle.bundle.wxs
                RealDwgInstallerFiles\DwgMergeModuleFrag.wxs
                RealDwgInstallerFiles\DwgRegistryFrag.wxs
                RealDwgInstallerFiles\RealDwgInstaller.mki
                RealDwgInstallerFiles\BundleRealDwgInstaller.mki
            </Files>
        </Bindings>
    </Part>


    <!-- An SDK zip delivery for DwgBridge using RealDWG -->
    <NuGetProduct Name="RealDwgBridgeSdkNuget" OnlyPlatforms="x64" Description="An iModelBridge-DWG extension SDK based on RealDWG toolkit">
        <SubPart PartName="RealDwgImportDLL" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="RealDwgBridgeDLL" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="RealDwgDb" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="Docs" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="Docs" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge" Repository="imodel02"/>
        <SubPart PartName="CodeSamples" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="DwgResources" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="iModelBridgeFwkLib" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge" Repository="imodel02"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api" Repository="imodel02"/>
        <SubPart PartName="DwgImporterHeaderDelivery"/>
        <SubPart PartName="NodeApiHeaderDelivery"/>
        <Directories DirectoryListName="RealDwgBridgeSdkDirList"/>
        <Directories DirectoryListName="DwgSdkCommonDirList"/>
    </NuGetProduct>

    <Part Name="DwgImporterHeaderDelivery">
        <SubPart PartName="PublicAPI" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Bindings>
            <Directory SourceName="PublicAPI/Dwg" ProductDirectoryName="DwgImportHeaders"/>
        </Bindings>
    </Part>
    <Part Name="NodeApiHeaderDelivery">
        <SubPart PartName="VendorAPI" PartFile="node-addon-api/node-addon-api" Repository="imodel02"/>
        <Bindings>
            <Directory SourceName="VendorAPI/Napi" ProductDirectoryName="NodeAddonHeaders"/>
        </Bindings>
    </Part>

    <ProductDirectoryList ListName="RealDwgBridgeSdkDirList">
        <ProductDirectory Name="ApplicationRoot"        Path="DwgImporterSDK"/>
        <ProductDirectory Name="RealDwgDbLibs"          RelativeTo="ApplicationRoot" Path="Libs"/>
        <ProductDirectory Name="RealDwgDbAssemblies"    RelativeTo="ApplicationRoot" Path="Dlls"/>
        <ProductDirectory Name="RealDwgImportAssemblies" RelativeTo="ApplicationRoot" Path="Dlls"/>
        <ProductDirectory Name="OpenDwgDbLibs"          Deliver="false"/>
        <ProductDirectory Name="OpenDwgDbAssemblies"    Deliver="false"/>
        <ProductDirectory Name="OpenDwgImportAssemblies" Deliver="false"/>
    </ProductDirectoryList>

    <ProductDirectoryList ListName="DwgSdkCommonDirList">
        <ProductDirectory Name="ApplicationRoot"        Path="DwgImporterSDK"/>
        <ProductDirectory Name="DwgImportHeaders"       RelativeTo="ApplicationRoot" Path="PublicAPI/Dwg"/>
        <ProductDirectory Name="DwgImporterDocs"        RelativeTo="ApplicationRoot" Path="Docs/DwgBridge"/>
        <ProductDirectory Name="iModelBridgeDoc"        RelativeTo="ApplicationRoot" Path="Docs/iModelBridge"/>
        <ProductDirectory Name="SampleXData"            RelativeTo="ApplicationRoot" Path="Samples/XData"/>
        <ProductDirectory Name="SampleListProp"         RelativeTo="ApplicationRoot" Path="Samples/ListProperty"/>
        <!-- dependent list -->
        <ProductDirectory Name="Assets"                 RelativeTo="ApplicationRoot" Path="Assets" LibType="dynamic"/>
        <ProductDirectory Name="Assets"                 RelativeTo="ApplicationRoot" Path="Assets" LibType="static"/>
        <ProductDirectory Name="VendorNotices"          RelativeTo="ApplicationRoot" Path="Notices" LibType="dynamic"/>
        <ProductDirectory Name="VendorNotices"          RelativeTo="ApplicationRoot" Path="Notices" LibType="Static"/>
        <ProductDirectory Name="BentleyEulaDelivery"    RelativeTo="ApplicationRoot" Path="Notices"/>
        <ProductDirectory Name="NodeAddonHeaders"       RelativeTo="ApplicationRoot" Path="PublicAPI/Napi"/>
        <ProductDirectory Name="PublicAPI"              RelativeTo="ApplicationRoot" Path="PublicAPI" LibType="dynamic"/>
        <ProductDirectory Name="PublicAPI"              RelativeTo="ApplicationRoot" Path="PublicAPI" LibType="static"/>
        <ProductDirectory Name="Libs"                   RelativeTo="ApplicationRoot" Path="Libs" LibType="dynamic"/>
        <ProductDirectory Name="Libs"                   RelativeTo="ApplicationRoot" Path="Libs" LibType="static"/>
        <ProductDirectory Name="Assemblies"             RelativeTo="ApplicationRoot" Path="Dlls" LibType="dynamic"/>
        <ProductDirectory Name="Assemblies"             RelativeTo="ApplicationRoot" Path="Dlls" LibType="static"/>
        <ProductDirectory Name="PublisherLoggingConfigXml" RelativeTo="ApplicationRoot" Path="Dlls"/>
        <!-- exclude list -->
        <ProductDirectory Name="RealDwgAssemblies"      Deliver="false"/>
        <ProductDirectory Name="RealDwgAssembliesEnUS"  Deliver="false"/>
        <ProductDirectory Name="ShxFonts"               Deliver="false"/>
        <ProductDirectory Name="MergeModules"           Deliver="false"/>
        <ProductDirectory Name="DgnV8Dlls"              Deliver="false"/>
        <ProductDirectory Name="VendorAPI"              Deliver="false"/>
    </ProductDirectoryList>


    <!-- iModelBridge tests for RealDWG bridge -->
    <Product Name="DwgBridgeTests">
        <SubProduct ProductName="iModelBridgeFwk" Repository="imodel02" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge"/>
        <SubPart PartName="DwgBridgeTestsExe"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <Directories DirectoryListName="RealDwgConverterDirList"  PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="DwgAppCommonDirList"  PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="Tests" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="TestDirList"/>
    </Product>

    <Part Name="RunDwgBridgeTests" DeferType="RunUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/gtest/RunGtest.mke" BentleyBuildMakeOptions="-dGTEST_PRODUCT=DwgBridgeTests -dGTEST_NAME=DwgBridgeTests">
        <SubProduct ProductName="DwgBridgeTests"/>
        <Bindings>
            <Files Required="false" SubPartDirectory="Gtest/Logs">Delivery/Gtest/Logs/DwgBridgeTests.log</Files>
        </Bindings>
    </Part>

    <Part Name="DwgBridgeTestsExe" DeferType="BuildUnitTests" BentleyBuildMakeFile="Tests/DwgBridgeTests.mke">
        <SubPart PartName="DgnDbTestUtils" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="DgnPlatformSqlang" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="DgnPlatformUnitTestHelpers" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="RealDwgImportExe" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="google_gtest_lib" PartFile="iModelCore/util/gtest/gtest" Repository="imodel02"/>
        <SubPart PartName="Gtest-Tools" PartFile="iModelCore/BeGTest/BeGTest" Repository="imodel02"/>
        <SubPart PartName="iModelBridgeFwkLib" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge" Repository="imodel02"/>
        <Bindings>
            <Files ProductDirectoryName="DwgImporterTestsExe">Delivery/DwgBridgeTests.exe</Files>
            <Files ProductDirectoryName="DwgImporterTestsExe">Delivery/DwgBridgeTests.logging.config.xml</Files>
            <Files ProductDirectoryName="Assets" ProductSubDirectory="sqlang">Delivery/DwgBridgeTests_en-US.sqlang.db3</Files>
            <Files ProductDirectoryName="Assets" ProductSubDirectory="Ignore">Delivery/ignore_list.txt</Files>
            <Directory SourceName="Delivery/DwgBridgeTestData"  SubPartDirectory="TestData"  ProductDirectoryName="ImportTestData" Required="false"/>
        </Bindings>
    </Part>

    <ProductDirectoryList ListName="TestDirList">
        <ProductDirectory Name="ApplicationRoot"        Path=""/>
        <ProductDirectory Name="UnitTests-Assets"       RelativeTo="ApplicationRoot" Path="Assets" LibType="dynamic"/>
        <ProductDirectory Name="UnitTests-Assets"       RelativeTo="ApplicationRoot" Path="Assets" LibType="static"/>
        <ProductDirectory Name="UnitTests-Objects"      Deliver="false"/>
        <ProductDirectory Name="UnitTests-IgnoreList"   Deliver="false"/>
    </ProductDirectoryList>

</BuildContext>
