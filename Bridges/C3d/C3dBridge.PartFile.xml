<?xml version="1.0" encoding="utf-8"?>

<BuildContext xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../bsicommon/build/PartFile.xsd">
  
    <Part Name="C3dBridgePRG" PrgOutputDir="C3dBridge">
        <SubProduct ProductName="C3dBridge"/>
        <SubPart PartName="RunC3dImporterTests"/>
        <SubProduct ProductName="C3dBridgeTests"/>
    </Part>

    <Product Name="C3dBridge" SaveProduct="true" BuildInstallSet="true">
        <SubPart PartName="C3dImporterDLL"/>
        <SubPart PartName="C3dBridgeApps"/>
        <SubPart PartName="C3dBridgeInstaller"/>

        <Directories DirectoryListName="C3dBridgeDirList"/>
        <Directories DirectoryListName="OpenDwgConverterDirList"  PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="DwgAppCommonDirList"  PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>

        <InstallerWixFile SourceFile="installers\C3dBridge"/>
    </Product>

    <Part Name="C3dImporterDLL" BentleyBuildMakeFile="C3dImporter.mke" BentleyBuildMakeOptions="+dDWGTOOLKIT=OpenDwg +dVendorVersion=200515" ApiNumber="205M02" OnlyPlatforms="x64" ExcludeLibType="Static" >
        <SubPart PartName="Teigha" PartFile="${SrcRoot}bsicommon/CvsPartFiles/teigha" Repository="bin-teigha"/>
        <SubPart PartName="OpenDwgImportDll" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="OpenDwgBridgeDll" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="DwgResources" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="iModelBridgeFwkExe" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge" Repository="imodel02"/>
        <SubPart PartName="LinearReferencing" PartFile="Domains/LinearReferencing/LinearReferencing" Repository="imodel02"/>
        <SubPart PartName="RoadRailAlignment" PartFile="Domains/RoadRailAlignment/RoadRailAlignment" Repository="imodel02"/>
        <SubPart PartName="RoadRailPhysical" PartFile="Domains/RoadRailPhysical/RoadRailPhysical" Repository="imodel02"/>
        <SubPart PartName="Eula" PartFile="Eula" Repository="Miscdev-Eula"/>
        <SubPart PartName="InstallFrameworkBase" PartFile="InstallFramework" Repository="InstallFramework"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <Bindings>
            <Assemblies ProductDirectoryName="C3dBridgeAssemblies">Delivery/$(shlibprefix)C3dImporter$(ApiNumber)$(shlibext)</Assemblies>
            <Libs Required="false">Delivery/$(libprefix)C3dImporter$(libext)</Libs>
            <Files ProductDirectoryName="Assets" ProductSubDirectory="ECSchemas/Application" SubPartDirectory="ECSchemas/Application">Delivery/C3dSchema.01.00.00.ecschema.xml</Files>
        </Bindings>
    </Part>

    <Part Name="C3dBridgeApps" BentleyBuildMakeFile="Apps/C3dBridgeApps.mke" BentleyBuildMakeOptions="+dDWGTOOLKIT=OpenDwg +dVendorVersion=200515" ApiNumber="M02" OnlyPlatforms="x64" ExcludeLibType="Static" >
        <SubPart PartName="iModelBridgeLibrary"  PartFile="iModelBridgeCore/DgnDbSync/iModelBridge" Repository="imodel02"/>
        <SubPart PartName="OpenDwgBridgeDLL" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <SubPart PartName="C3dImporterDLL" />
        <!-- Need to pull ShxFonts from RealDWG -->
        <SubPart PartName="RealDwg" PartFile="${SrcRoot}bsicommon/CvsPartFiles/realdwg" Repository="bin-realdwg" />
        <Bindings>
            <Assemblies ProductDirectoryName="C3dBridgeAssemblies">Delivery/C3dBridge$(ApiNumber)$(shlibext)</Assemblies>
            <Files ProductDirectoryName="C3dBridgeAssemblies">Delivery/C3dImporter.exe</Files>
        </Bindings>
    </Part>

    <Part Name="C3dBridgeInstaller" BMakeFile="installers/C3dBridgeInstaller.prewire.mke" >
        <Bindings>
            <Files BindToWixBuild="true">
                C3dBridgeInstallFiles\C3dBridgeInstaller.mki
                C3dBridgeInstallFiles\C3dBridgeRegistryFrag.wxs
            </Files>
        </Bindings>
    </Part>

    <ProductDirectoryList ListName="C3dBridgeDirList">
        <ProductDirectory Name="ApplicationRoot"        Path=""/>
        <ProductDirectory Name="C3dBridgeAssemblies"    RelativeTo="ApplicationRoot" LibType="dynamic"/>
        <ProductDirectory Name="ShxFonts"               RelativeTo="ApplicationRoot" Deliver="true"  Path="Fonts"/>
    </ProductDirectoryList>


    <!-- Smoke tests for the importer -->
    <Product Name="C3dImporterTests" OnlyPlatforms="x64">
        <SubPart PartName="C3dImporterTestsExe"/>
        <Directories DirectoryListName="OpenDwgConverterDirList" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="DwgAppCommonDirList" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="C3dBridgeDirList"/>
        <Directories DirectoryListName="TestsCommonDirList"  PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="TestDirList"/>
    </Product>

    <Part Name="C3dImporterTestsExe" DeferType="BuildUnitTests" BentleyBuildMakeFile="Tests/C3dImporterTests.mke" OnlyPlatforms="x64">
        <SubPart PartName="google_gtest_lib"    PartFile="iModelCore/util/gtest/gtest"  Repository="imodel02"/>
        <SubPart PartName="Gtest-Tools"         PartFile="iModelCore/BeGTest/BeGTest"   Repository="imodel02"/>
        <SubPart PartName="DgnPlatformSqlang"   PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="napi-stub"           PartFile="node-addon-api/node-addon-api"/>
        <SubPart PartName="C3dBridgeApps"/>
        <Bindings>
            <Files ProductDirectoryName="C3dImporterTestsExe">Delivery/ImporterTests/C3dImporterTests.exe</Files>
            <Files ProductDirectoryName="Assets" Required="false">Delivery/ImporterTests/C3dImporterTests.logging.config.xml</Files>
            <Files ProductDirectoryName="Assets" ProductSubDirectory="sqlang">Delivery/ImporterTests/C3dImporterTests_en-US.sqlang.db3</Files>
            <Files ProductDirectoryName="Assets" ProductSubDirectory="Ignore">Delivery/ImporterTests/ignore_list.txt</Files>
            <Directory SourceName="Delivery/ImporterTests/TestData" ProductDirectoryName="ImportTestData" Required="false"/>
        </Bindings>
    </Part>

    <Part Name="RunC3dImporterTests" DeferType="RunUnitTests" BentleyBuildMakeFile="$(BuildContext)/SubParts/BeGTest/gtest/RunGtest.mke" BentleyBuildMakeOptions="-dGTEST_PRODUCT=C3dImporterTests -dGTEST_NAME=C3dImporterTests +dGTEST_LOGFILE_NAME=C3dImporterTests.log" OnlyPlatforms="x64" ExcludeLibType="Static">
        <SubProduct ProductName="C3dImporterTests" />
        <Bindings>
          <Files Required="false" SubPartDirectory="Gtest/Logs">Delivery/Gtest/Logs/C3dImporterTests.log</Files>
        </Bindings>
    </Part>


    <!-- Smoke tests for the iModelBridge -->
    <Product Name="C3dBridgeTests" OnlyPlatforms="x64">
        <SubProduct ProductName="iModelBridgeFwk" Repository="imodel02" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge"/>
        <SubPart PartName="C3dBridgeTestsExe"/>
        <SubPart PartName="napi-stub" PartFile="node-addon-api/node-addon-api"/>
        <Directories DirectoryListName="OpenDwgConverterDirList" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="DwgAppCommonDirList" PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="C3dBridgeDirList"/>
        <Directories DirectoryListName="TestsCommonDirList"  PartFile="Bridges/Dwg/DwgConverter/DwgConverter" Repository="imodel02"/>
        <Directories DirectoryListName="TestDirList"/>
    </Product>

    <Part Name="C3dBridgeTestsExe" DeferType="BuildUnitTests" BentleyBuildMakeFile="Tests/C3dBridgeTests.mke" OnlyPlatforms="x64">
        <SubPart PartName="DgnDbTestUtils" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="DgnPlatformSqlang" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="DgnPlatformUnitTestHelpers" PartFile="iModelCore/DgnPlatform/DgnPlatform" Repository="imodel02"/>
        <SubPart PartName="google_gtest_lib" PartFile="iModelCore/util/gtest/gtest" Repository="imodel02"/>
        <SubPart PartName="Gtest-Tools" PartFile="iModelCore/BeGTest/BeGTest" Repository="imodel02"/>
        <SubPart PartName="iModelBridgeFwkLib" PartFile="iModelBridgeCore/DgnDbSync/iModelBridge" Repository="imodel02"/>
        <SubPart PartName="C3dBridgeApps"/>
        <Bindings>
            <Files ProductDirectoryName="C3dImporterTestsExe">Delivery/BridgeTests/C3dBridgeTests.exe</Files>
            <Files ProductDirectoryName="C3dImporterTestsExe">Delivery/BridgeTests/C3dBridgeTests.logging.config.xml</Files>
            <Files ProductDirectoryName="Assets" ProductSubDirectory="sqlang">Delivery/BridgeTests/C3dBridgeTests_en-US.sqlang.db3</Files>
            <Files ProductDirectoryName="Assets" ProductSubDirectory="Ignore">Delivery/BridgeTests/ignore_list.txt</Files>
            <Directory SourceName="Delivery/BridgeTests/TestData" ProductDirectoryName="ImportTestData" Required="false"/>
        </Bindings>
    </Part>

    <ProductDirectoryList ListName="TestDirList">
        <ProductDirectory Name="ApplicationRoot"        Path=""/>
        <ProductDirectory Name="C3dImporterTestsExe"    Path=""/>
        <ProductDirectory Name="UnitTests-Assets"       RelativeTo="ApplicationRoot" Path="Assets" LibType="dynamic"/>
        <ProductDirectory Name="UnitTests-Assets"       RelativeTo="ApplicationRoot" Path="Assets" LibType="static"/>
        <ProductDirectory Name="BridgeTestData"         RelativeTo="ApplicationRoot" Path="TestData" LibType="dynamic"/>
        <ProductDirectory Name="BridgeTestData"         RelativeTo="ApplicationRoot" Path="TestData" LibType="static"/>
        <ProductDirectory Name="UnitTests-Objects"      Deliver="false"/>
        <ProductDirectory Name="UnitTests-IgnoreList"   Deliver="false"/>
    </ProductDirectoryList>

</BuildContext>
